 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 1 - 5/8/2024 17:23:58


       1/       0 :                     ; ---------------------------------------------------------------------------
       2/       0 :                     
       3/       0 :                     	cpu z80
       4/       0 :                     
       5/       0 :                     DrumHeader	macro ptr,trans,vol,mod,inst ;	(sizeof=0x6)
       6/       0 :                     		dw ptr			; offset
       7/       0 :                     		db trans
       8/       0 :                     		db vol
       9/       0 :                     		db mod
      10/       0 :                     		db inst
      11/       0 :                     		endm
      12/       0 :                     
      13/       0 :                     ;
      14/       0 :                     ; +-------------------------------------------------------------------------+
      15/       0 :                     ; |   This file	has been generated by The Interactive Disassembler (IDA)    |
      16/       0 :                     ; |	      Copyright	(c) 2011 Hex-Rays, <support@hex-rays.com>	    |
      17/       0 :                     ; |			 License info: 48-327F-7274-B7			    |
      18/       0 :                     ; |			       ESET spol. s r.o.			    |
      19/       0 :                     ; +-------------------------------------------------------------------------+
      20/       0 :                     ;
      21/       0 :                     ; Input	MD5   :	0567AD62FB3820E3EEFDB43FAFF3F1F6
      22/       0 :                     ; Input	CRC32 :	D2E0B190
      23/       0 :                     
      24/       0 :                     ; ---------------------------------------------------------------------------
      25/       0 :                     ; File Name   :	D:\VStudio-Programme\VC2010\SMPSPlay\SMPS_Lib\Z80Drvs\FM\Type1\Flicky (W) [!].bin
      26/       0 :                     ; Format      :	Binary file
      27/       0 :                     ; Base Address:	0000h Range: 0000h - 1C00h Loaded length: 1C00h
      28/       0 :                     ;
      29/       0 :                     ; Note:	Sega Channel BIOS (J) uses the exactly same driver revision.
      30/       0 :                     ;	Differences (a few pointers and	FM drums) are noted.
      31/       0 :                     
      32/       0 :                     ; Processor	  : z80	[]
      33/       0 :                     ; Target assembler: Zilog Macro	Assembler
      34/       0 :                     
      35/       0 :                     ; ===========================================================================
      36/       0 :                     
      37/       0 :                     ; Segment type:	Regular
      38/       0 : F3                  		di
      39/       1 : F3                  		di
      40/       2 : ED 56               		im	1
      41/       4 : 18 4D               		jr	InitDriver
      42/       6 :                     ; ---------------------------------------------------------------------------
      43/       6 :                     		align 8
      44/       8 :                     
      45/       8 :                     ; =============== S U B	R O U T	I N E =======================================
      46/       8 :                     
      47/       8 :                     
      48/       8 :                     WaitForYM:				; CODE XREF: WaitForYM+5j WriteFMI+3p	...
      49/       8 : 3A 00 40            		ld	a, (4000h)
      50/       B : CB 7F               		bit	7, a
      51/       D : 20 F9               		jr	nz, WaitForYM
      52/       F : C9                  		ret
      53/      10 :                     ; End of function WaitForYM
      54/      10 :                     
      55/      10 :                     
      56/      10 :                     ; =============== S U B	R O U T	I N E =======================================
      57/      10 :                     
      58/      10 :                     
      59/      10 :                     WriteFMMain:				; CODE XREF: SendFMFreq+Fp
      60/      10 :                     					; SendFMFreq+13p ...
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 2 - 5/8/2024 17:23:58


      61/      10 :                     
      62/      10 :                     ; FUNCTION CHUNK AT 04A2 SIZE 00000010 BYTES
      63/      10 :                     ; FUNCTION CHUNK AT 04B6 SIZE 0000000A BYTES
      64/      10 :                     
      65/      10 : DD CB 01 7E         		bit	7, (ix+1)
      66/      14 : C0                  		ret	nz
      67/      15 : C3 A2 04            		jp	WriteFMIorII
      68/      18 :                     ; End of function WriteFMMain
      69/      18 :                     
      70/      18 :                     
      71/      18 :                     ; =============== S U B	R O U T	I N E =======================================
      72/      18 :                     
      73/      18 :                     
      74/      18 :                     WriteFMI:				; CODE XREF: RefreshTimerA+9p
      75/      18 :                     					; RefreshTimerA+15p ...
      76/      18 :                     
      77/      18 :                     ; FUNCTION CHUNK AT 04B2 SIZE 00000004 BYTES
      78/      18 :                     
      79/      18 : 32 00 40            		ld	(4000h), a
      80/      1B : CF                  		rst	WaitForYM
      81/      1C : 79                  		ld	a, c
      82/      1D : C3 B2 04            		jp	loc_4B2
      83/      20 :                     ; End of function WriteFMI
      84/      20 :                     
      85/      20 :                     
      86/      20 :                     ; =============== S U B	R O U T	I N E =======================================
      87/      20 :                     
      88/      20 :                     
      89/      20 :                     GetListOfs:				; CODE XREF: DoFMVolEnv+8p
      90/      20 :                     					; GetListOfsAB:loc_5F3p ...
      91/      20 : 2A 02 1C            		ld	hl, (word_1C02)	; get Pointer List Offset from 1C02/03
      92/      23 : C3 7A 04            		jp	GetPtrListOfs
      93/      26 :                     ; End of function GetListOfs
      94/      26 :                     
      95/      26 :                     ; ---------------------------------------------------------------------------
      96/      26 :                     		align 8
      97/      28 :                     
      98/      28 :                     ; =============== S U B	R O U T	I N E =======================================
      99/      28 :                     
     100/      28 :                     
     101/      28 :                     ReadPtrTable:				; CODE XREF: TrkUpdate_Proc+39p
     102/      28 :                     					; TrkUpdate_Proc+55p ...
     103/      28 : 4F                  		ld	c, a
     104/      29 : 06 00               		ld	b, 0
     105/      2B : 09                  		add	hl, bc
     106/      2C : 09                  		add	hl, bc
     107/      2D : 00                  		nop
     108/      2E : 00                  		nop
     109/      2F : 00                  		nop
     110/      30 :                     ; End of function ReadPtrTable
     111/      30 :                     
     112/      30 :                     
     113/      30 :                     ; =============== S U B	R O U T	I N E =======================================
     114/      30 :                     
     115/      30 :                     
     116/      30 :                     ReadPtrFromHL:				; CODE XREF: GetPtrListOfs+4p
     117/      30 :                     					; PlaySoundID+5Dp ...
     118/      30 : 7E                  		ld	a, (hl)
     119/      31 : 23                  		inc	hl
     120/      32 : 66                  		ld	h, (hl)
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 3 - 5/8/2024 17:23:58


     121/      33 : 6F                  		ld	l, a
     122/      34 : C9                  		ret
     123/      35 :                     ; End of function ReadPtrFromHL
     124/      35 :                     
     125/      35 :                     ; ---------------------------------------------------------------------------
     126/      35 :                     		align 8
     127/      38 :                     
     128/      38 :                     VInt:					; where	is the DI??
     129/      38 : F5                  		push	af
     130/      39 : C5                  		push	bc		; save some registers
     131/      3A : D5                  		push	de
     132/      3B : E5                  		push	hl
     133/      3C : 21 FF 1F            		ld	hl, byte_1FFF	; HL = Skip Update counter
     134/      3F : 7E                  		ld	a, (hl)
     135/      40 : B7                  		or	a		; Counter == 0?
     136/      41 : 28 03               		jr	z, loc_46	; yes -	update sound
     137/      43 : 35                  		dec	(hl)		; no - decrement
     138/      44 : 18 07               		jr	loc_4D		; and don't do anything else
     139/      46 :                     ; ---------------------------------------------------------------------------
     140/      46 :                     
     141/      46 :                     loc_46:					; CODE XREF: RAM:0041j
     142/      46 : 3A 07 1C            		ld	a, (byte_1C07)	; 1C07 - Timing	Mode
     143/      49 : B7                  		or	a
     144/      4A : CC E5 00            		call	z, UpdateAll	; update only when 1C07	== 00
     145/      4D :                     
     146/      4D :                     loc_4D:					; CODE XREF: RAM:0044j
     147/      4D : E1                  		pop	hl		; restore the registers
     148/      4E : D1                  		pop	de
     149/      4F : C1                  		pop	bc
     150/      50 : F1                  		pop	af
     151/      51 : FB                  		ei
     152/      52 : C9                  		ret
     153/      53 :                     ; ---------------------------------------------------------------------------
     154/      53 :                     
     155/      53 :                     InitDriver:				; CODE XREF: RAM:0004j
     156/      53 : 31 FD 1F            		ld	sp, unk_1FFD
     157/      56 : 3E 03               		ld	a, 3
     158/      58 : 32 FF 1F            		ld	(byte_1FFF), a	; make it skip 3 updates
     159/      5B :                     
     160/      5B :                     loc_5B:					; CODE XREF: RAM:0060j
     161/      5B : FB                  		ei			; enable VInt
     162/      5C : 3A FF 1F            		ld	a, (byte_1FFF)
     163/      5F : B7                  		or	a		; wait for 3 VInts
     164/      60 : C2 5B 00            		jp	nz, loc_5B
     165/      63 : CD 01 08            		call	StopAllSound
     166/      66 : CD 26 07            		call	SetupBank
     167/      69 : CD B9 00            		call	RefreshTimerA
     168/      6C : CD D3 00            		call	RefreshTimerB
     169/      6F :                     
     170/      6F :                     loc_6F:					; CODE XREF: RAM:0077j	RAM:0085j ...
     171/      6F : FB                  		ei
     172/      70 : CD 99 08            		call	DoSoundQueue
     173/      73 : 3A 07 1C            		ld	a, (byte_1C07)	; 1C07 - Timing	Mode
     174/      76 : B7                  		or	a
     175/      77 : 28 F6               		jr	z, loc_6F	; Timing Mode 00, update on VInt
     176/      79 : F3                  		di
     177/      7A : F2 AA 00            		jp	p, TimerB_Update ; Timing Mode 40 - Update on YM2612 Timer A
     178/      7D :                     
     179/      7D :                     TimerAB_Update:				; Timing Mode 80
     180/      7D : CD 99 08            		call	DoSoundQueue
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 4 - 5/8/2024 17:23:58


     181/      80 : 3A 00 40            		ld	a, (4000h)	; Music	Update on YM2612 Timer A
     182/      83 : E6 03               		and	3		; SFX Update on	YM2612 Timer B
     183/      85 : 28 E8               		jr	z, loc_6F	; none of the YM2612 Timers expired - jump back
     184/      87 : CB 4F               		bit	1, a
     185/      89 : 28 10               		jr	z, loc_9B	; Timer	B not yet expired - try	Timer A
     186/      8B : CD D3 00            		call	RefreshTimerB	; Timer	B expired - update SFX
     187/      8E : 21 9B 00            		ld	hl, loc_9B	; make it jump to the Timer A update check when
     188/      91 : E5                  		push	hl		; returning from UpdateSFXTracks
     189/      92 : CD 39 07            		call	DoPause
     190/      95 : CD 0B 05            		call	PlaySoundID
     191/      98 : C3 0F 01            		jp	UpdateSFXTracks
     192/      9B :                     ; ---------------------------------------------------------------------------
     193/      9B :                     
     194/      9B :                     loc_9B:					; CODE XREF: RAM:0089j
     195/      9B :                     					; DATA XREF: RAM:008Eo
     196/      9B : 3A 00 40            		ld	a, (4000h)
     197/      9E : CB 47               		bit	0, a
     198/      A0 : 28 CD               		jr	z, loc_6F
     199/      A2 : CD B9 00            		call	RefreshTimerA	; Timer	A expires - update Music
     200/      A5 : CD E5 00            		call	UpdateAll
     201/      A8 : 18 C5               		jr	loc_6F
     202/      AA :                     ; ---------------------------------------------------------------------------
     203/      AA :                     
     204/      AA :                     TimerB_Update:				; CODE XREF: RAM:007Aj
     205/      AA : 3A 00 40            		ld	a, (4000h)
     206/      AD :                     
     207/      AD :                     loc_AD:
     208/      AD : CB 4F               		bit	1, a
     209/      AF : 28 BE               		jr	z, loc_6F
     210/      B1 : CD D3 00            		call	RefreshTimerB	; update everything when Timer B expires
     211/      B4 : CD E5 00            		call	UpdateAll
     212/      B7 : 18 B6               		jr	loc_6F
     213/      B9 :                     
     214/      B9 :                     ; =============== S U B	R O U T	I N E =======================================
     215/      B9 :                     
     216/      B9 :                     
     217/      B9 :                     RefreshTimerA:				; CODE XREF: RAM:0069p	RAM:00A2p
     218/      B9 : 2A 04 1C            		ld	hl, (word_1C04)
     219/      BC : 7D                  		ld	a, l
     220/      BD : E6 03               		and	3
     221/      BF : 4F                  		ld	c, a
     222/      C0 : 3E 25               		ld	a, 25h
     223/      C2 : DF                  		rst	WriteFMI	; write	Timer A	LSB
     224/      C3 : CB 3C               		srl	h
     225/      C5 : CB 1D               		rr	l
     226/      C7 : CB 3C               		srl	h
     227/      C9 : CB 1D               		rr	l
     228/      CB : 4D                  		ld	c, l
     229/      CC : 3E 24               		ld	a, 24h
     230/      CE : DF                  		rst	WriteFMI	; write	Timer A	MSB
     231/      CF : 3E 1F               		ld	a, 1Fh
     232/      D1 : 18 09               		jr	ResetYMTimer
     233/      D3 :                     ; End of function RefreshTimerA
     234/      D3 :                     
     235/      D3 :                     
     236/      D3 :                     ; =============== S U B	R O U T	I N E =======================================
     237/      D3 :                     
     238/      D3 :                     
     239/      D3 :                     RefreshTimerB:				; CODE XREF: RAM:006Cp	RAM:008Bp ...
     240/      D3 : 3A 06 1C            		ld	a, (byte_1C06)
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 5 - 5/8/2024 17:23:58


     241/      D6 : 4F                  		ld	c, a
     242/      D7 : 3E 26               		ld	a, 26h
     243/      D9 : DF                  		rst	WriteFMI	; write	Timer B
     244/      DA : 3E 2F               		ld	a, 2Fh
     245/      DC :                     
     246/      DC :                     ResetYMTimer:				; CODE XREF: RefreshTimerA+18j
     247/      DC : 21 12 1C            		ld	hl, byte_1C12
     248/      DF : B6                  		or	(hl)
     249/      E0 : 4F                  		ld	c, a
     250/      E1 : 3E 27               		ld	a, 27h
     251/      E3 : DF                  		rst	WriteFMI	; Reset	Timer
     252/      E4 : C9                  		ret
     253/      E5 :                     ; End of function RefreshTimerB
     254/      E5 :                     
     255/      E5 :                     
     256/      E5 :                     ; =============== S U B	R O U T	I N E =======================================
     257/      E5 :                     
     258/      E5 :                     
     259/      E5 :                     UpdateAll:				; CODE XREF: RAM:004Ap	RAM:00A5p ...
     260/      E5 : CD 39 07            		call	DoPause
     261/      E8 : CD 80 08            		call	DoTempo
     262/      EB : CD B5 07            		call	DoFading
     263/      EE : CD 0B 05            		call	PlaySoundID
     264/      F1 : 3A 07 1C            		ld	a, (byte_1C07)	; 1C07 - Timing	Mode
     265/      F4 : B7                  		or	a
     266/      F5 : F4 0F 01            		call	p, UpdateSFXTracks ; 1C07 < 80 - update	SFX (SFX use Music Timing)
     267/      F8 : AF                  		xor	a
     268/      F9 : 32 19 1C            		ld	(byte_1C19), a	; 00 - Music Mode
     269/      FC : DD 21 40 1C         		ld	ix, byte_1C40	; 1C40 - Music Track Drum
     270/     100 : DD CB 00 7E         		bit	7, (ix+0)
     271/     104 : C4 A2 09            		call	nz, DrumUpdateTrack
     272/     107 : 06 09               		ld	b, 9		; 9 Music Tracks (10 minus Drum	Track)
     273/     109 : DD 21 70 1C         		ld	ix, byte_1C70	; 1C70 - Music Track FM1
     274/     10D : 18 19               		jr	TrkUpdateLoop
     275/     10F :                     ; End of function UpdateAll
     276/     10F :                     
     277/     10F :                     
     278/     10F :                     ; =============== S U B	R O U T	I N E =======================================
     279/     10F :                     
     280/     10F :                     
     281/     10F :                     UpdateSFXTracks:			; CODE XREF: RAM:0098j	UpdateAll+10p
     282/     10F : 3E 01               		ld	a, 1
     283/     111 : 32 19 1C            		ld	(byte_1C19), a	; 01 - SFX Mode
     284/     114 : DD 21 80 1E         		ld	ix, byte_1E80	; 1E80 - SFX Tracks
     285/     118 : 06 06               		ld	b, 6		; 6 SFX	tracks
     286/     11A : CD 28 01            		call	TrkUpdateLoop
     287/     11D : 3E 80               		ld	a, 80h
     288/     11F : 32 19 1C            		ld	(byte_1C19), a	; 80 - Special SFX Mode
     289/     122 : 06 02               		ld	b, 2		; 2 special SFX	tracks
     290/     124 : DD 21 20 1E         		ld	ix, byte_1E20	; 1E20 - Special SFX Tracks
     291/     128 :                     ; End of function UpdateSFXTracks
     292/     128 :                     
     293/     128 :                     
     294/     128 :                     ; =============== S U B	R O U T	I N E =======================================
     295/     128 :                     
     296/     128 :                     
     297/     128 :                     TrkUpdateLoop:				; CODE XREF: UpdateAll+28j
     298/     128 :                     					; UpdateSFXTracks+Bp ...
     299/     128 : C5                  		push	bc
     300/     129 : DD CB 00 7E         		bit	7, (ix+0)	; 'in use' flag set?
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 6 - 5/8/2024 17:23:58


     301/     12D : C4 39 01            		call	nz, UpdateTrack
     302/     130 : 11 30 00            		ld	de, 30h		; next track
     303/     133 : DD 19               		add	ix, de
     304/     135 : C1                  		pop	bc
     305/     136 : 10 F0               		djnz	TrkUpdateLoop
     306/     138 : C9                  		ret
     307/     139 :                     ; End of function TrkUpdateLoop
     308/     139 :                     
     309/     139 :                     
     310/     139 :                     ; =============== S U B	R O U T	I N E =======================================
     311/     139 :                     
     312/     139 :                     
     313/     139 :                     UpdateTrack:				; CODE XREF: TrkUpdateLoop+5p
     314/     139 :                     
     315/     139 :                     ; FUNCTION CHUNK AT 040D SIZE 00000017 BYTES
     316/     139 :                     ; FUNCTION CHUNK AT 0F1E SIZE 00000076 BYTES
     317/     139 :                     
     318/     139 : DD CB 01 7E         		bit	7, (ix+1)
     319/     13D : C2 1E 0F            		jp	nz, UpdatePSGTrk
     320/     140 : CD 04 03            		call	TrackTimeout
     321/     143 : 20 17               		jr	nz, loc_15C
     322/     145 : CD D6 01            		call	TrkUpdate_Proc
     323/     148 : DD CB 00 66         		bit	4, (ix+0)
     324/     14C : C0                  		ret	nz
     325/     14D : CD 3A 03            		call	PrepareModulat
     326/     150 : CD 34 04            		call	DoPitchSlide
     327/     153 : CD 65 03            		call	DoModulation
     328/     156 : CD 7E 01            		call	SendFMFreq
     329/     159 : C3 0D 04            		jp	DoNoteOn
     330/     15C :                     ; ---------------------------------------------------------------------------
     331/     15C :                     
     332/     15C :                     loc_15C:				; CODE XREF: UpdateTrack+Aj
     333/     15C : CD EE 02            		call	ExecPanAnim
     334/     15F : DD CB 00 66         		bit	4, (ix+0)
     335/     163 : C0                  		ret	nz
     336/     164 : CD 0C 03            		call	DoFMVolEnv
     337/     167 : DD 7E 1E            		ld	a, (ix+1Eh)
     338/     16A : B7                  		or	a
     339/     16B : 28 06               		jr	z, loc_173
     340/     16D : DD 35 1E            		dec	(ix+1Eh)
     341/     170 : CA 2A 04            		jp	z, SendNoteOff
     342/     173 :                     
     343/     173 :                     loc_173:				; CODE XREF: UpdateTrack+32j
     344/     173 : CD 34 04            		call	DoPitchSlide
     345/     176 : DD CB 00 76         		bit	6, (ix+0)
     346/     17A : C0                  		ret	nz
     347/     17B : CD 65 03            		call	DoModulation
     348/     17E :                     ; End of function UpdateTrack
     349/     17E :                     
     350/     17E :                     
     351/     17E :                     ; =============== S U B	R O U T	I N E =======================================
     352/     17E :                     
     353/     17E :                     
     354/     17E :                     SendFMFreq:				; CODE XREF: UpdateTrack+1Dp
     355/     17E : DD CB 00 56         		bit	2, (ix+0)
     356/     182 : C0                  		ret	nz
     357/     183 : DD CB 00 46         		bit	0, (ix+0)
     358/     187 : C2 93 01            		jp	nz, loc_193
     359/     18A :                     
     360/     18A :                     loc_18A:				; CODE XREF: SendFMFreq+1Aj
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 7 - 5/8/2024 17:23:58


     361/     18A : 3E A4               		ld	a, 0A4h
     362/     18C : 4C                  		ld	c, h
     363/     18D : D7                  		rst	WriteFMMain
     364/     18E : 3E A0               		ld	a, 0A0h
     365/     190 : 4D                  		ld	c, l
     366/     191 : D7                  		rst	WriteFMMain
     367/     192 : C9                  		ret
     368/     193 :                     ; ---------------------------------------------------------------------------
     369/     193 :                     
     370/     193 :                     loc_193:				; CODE XREF: SendFMFreq+9j
     371/     193 : DD 7E 01            		ld	a, (ix+1)
     372/     196 : FE 02               		cp	2
     373/     198 : 20 F0               		jr	nz, loc_18A
     374/     19A : CD C6 01            		call	GetFM3FreqPtr
     375/     19D : D9                  		exx
     376/     19E : 21 C2 01            		ld	hl, SpcFM3Regs
     377/     1A1 : 06 04               		ld	b, 4
     378/     1A3 :                     
     379/     1A3 :                     loc_1A3:				; CODE XREF: SendFMFreq+40j
     380/     1A3 : 7E                  		ld	a, (hl)
     381/     1A4 : F5                  		push	af
     382/     1A5 : 23                  		inc	hl
     383/     1A6 : D9                  		exx
     384/     1A7 : EB                  		ex	de, hl
     385/     1A8 : 4E                  		ld	c, (hl)
     386/     1A9 : 23                  		inc	hl
     387/     1AA : 46                  		ld	b, (hl)
     388/     1AB : 23                  		inc	hl
     389/     1AC : EB                  		ex	de, hl
     390/     1AD : DD 6E 0D            		ld	l, (ix+0Dh)
     391/     1B0 : DD 66 0E            		ld	h, (ix+0Eh)
     392/     1B3 : 09                  		add	hl, bc
     393/     1B4 : F1                  		pop	af
     394/     1B5 : F5                  		push	af
     395/     1B6 : 4C                  		ld	c, h
     396/     1B7 : DF                  		rst	WriteFMI
     397/     1B8 : F1                  		pop	af
     398/     1B9 : D6 04               		sub	4
     399/     1BB : 4D                  		ld	c, l
     400/     1BC : DF                  		rst	WriteFMI
     401/     1BD : D9                  		exx
     402/     1BE : 10 E3               		djnz	loc_1A3
     403/     1C0 : D9                  		exx
     404/     1C1 : C9                  		ret
     405/     1C2 :                     ; End of function SendFMFreq
     406/     1C2 :                     
     407/     1C2 :                     ; ---------------------------------------------------------------------------
     408/     1C2 : AD AE AC A6         SpcFM3Regs:	db 0ADh, 0AEh, 0ACh, 0A6h ; DATA XREF: SendFMFreq+20o
     409/     1C6 :                     
     410/     1C6 :                     ; =============== S U B	R O U T	I N E =======================================
     411/     1C6 :                     
     412/     1C6 :                     
     413/     1C6 :                     GetFM3FreqPtr:				; CODE XREF: SendFMFreq+1Cp RAM:0D1Cp
     414/     1C6 : 11 2A 1C            		ld	de, byte_1C2A
     415/     1C9 : 3A 19 1C            		ld	a, (byte_1C19)
     416/     1CC : B7                  		or	a
     417/     1CD : C8                  		ret	z		; Music	Mode (00) - 1C2A
     418/     1CE : 11 1A 1C            		ld	de, byte_1C1A
     419/     1D1 : F0                  		ret	p		; Special SFX Mode (80)	- 1C1A
     420/     1D2 : 11 22 1C            		ld	de, byte_1C22
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 8 - 5/8/2024 17:23:58


     421/     1D5 : C9                  		ret			; SFX Mode (01)	- 1C22
     422/     1D6 :                     ; End of function GetFM3FreqPtr
     423/     1D6 :                     
     424/     1D6 :                     
     425/     1D6 :                     ; =============== S U B	R O U T	I N E =======================================
     426/     1D6 :                     
     427/     1D6 :                     
     428/     1D6 :                     TrkUpdate_Proc:				; CODE XREF: UpdateTrack+Cp
     429/     1D6 :                     					; UpdateTrack+DEAp
     430/     1D6 : DD 5E 03            		ld	e, (ix+3)
     431/     1D9 : DD 56 04            		ld	d, (ix+4)
     432/     1DC : DD CB 00 8E         		res	1, (ix+0)
     433/     1E0 : DD CB 00 A6         		res	4, (ix+0)
     434/     1E4 :                     
     435/     1E4 :                     loc_1E4:				; CODE XREF: RAM:0BA5j
     436/     1E4 : 1A                  		ld	a, (de)
     437/     1E5 : 13                  		inc	de
     438/     1E6 : FE E0               		cp	0E0h
     439/     1E8 : D2 98 0B            		jp	nc, cfHandler
     440/     1EB : 08                  		ex	af, af'
     441/     1EC : CD 24 04            		call	DoNoteOff
     442/     1EF : CD A8 02            		call	DoPanAnimation
     443/     1F2 : 08                  		ex	af, af'
     444/     1F3 : DD CB 00 5E         		bit	3, (ix+0)
     445/     1F7 : C2 50 02            		jp	nz, DoRawFreqMode
     446/     1FA : B7                  		or	a
     447/     1FB : F2 76 02            		jp	p, SetDuration	; 00-7F	- Delay
     448/     1FE : D6 81               		sub	81h
     449/     200 : F2 08 02            		jp	p, GetNote	; 81-DF	- Note
     450/     203 : CD C8 0F            		call	SetRest		; 80 - Rest
     451/     206 : 18 2E               		jr	loc_236
     452/     208 :                     ; ---------------------------------------------------------------------------
     453/     208 :                     
     454/     208 :                     GetNote:				; CODE XREF: TrkUpdate_Proc+2Aj
     455/     208 : DD 86 05            		add	a, (ix+5)
     456/     20B : 21 00 09            		ld	hl, PSGFreqs
     457/     20E : F5                  		push	af
     458/     20F : EF                  		rst	ReadPtrTable
     459/     210 : F1                  		pop	af
     460/     211 : DD CB 01 7E         		bit	7, (ix+1)
     461/     215 : 20 19               		jr	nz, loc_230
     462/     217 : D5                  		push	de
     463/     218 : 16 08               		ld	d, 8
     464/     21A : 1E 0C               		ld	e, 0Ch
     465/     21C : 08                  		ex	af, af'
     466/     21D : AF                  		xor	a
     467/     21E :                     
     468/     21E :                     loc_21E:				; CODE XREF: TrkUpdate_Proc+4Ej
     469/     21E : 08                  		ex	af, af'
     470/     21F : 93                  		sub	e
     471/     220 : 38 05               		jr	c, loc_227
     472/     222 : 08                  		ex	af, af'
     473/     223 : 82                  		add	a, d
     474/     224 : 18 F8               		jr	loc_21E
     475/     226 :                     ; ---------------------------------------------------------------------------
     476/     226 : 08                  		ex	af, af'
     477/     227 :                     
     478/     227 :                     loc_227:				; CODE XREF: TrkUpdate_Proc+4Aj
     479/     227 : 83                  		add	a, e
     480/     228 : 21 8A 09            		ld	hl, FMFreqs
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 9 - 5/8/2024 17:23:58


     481/     22B : EF                  		rst	ReadPtrTable
     482/     22C : 08                  		ex	af, af'
     483/     22D : B4                  		or	h
     484/     22E : 67                  		ld	h, a
     485/     22F : D1                  		pop	de
     486/     230 :                     
     487/     230 :                     loc_230:				; CODE XREF: TrkUpdate_Proc+3Fj
     488/     230 : DD 75 0D            		ld	(ix+0Dh), l
     489/     233 : DD 74 0E            		ld	(ix+0Eh), h
     490/     236 :                     
     491/     236 :                     loc_236:				; CODE XREF: TrkUpdate_Proc+30j
     492/     236 : DD CB 00 6E         		bit	5, (ix+0)
     493/     23A : 20 0D               		jr	nz, loc_249
     494/     23C : 1A                  		ld	a, (de)
     495/     23D : B7                  		or	a
     496/     23E : F2 75 02            		jp	p, loc_275
     497/     241 : DD 7E 0C            		ld	a, (ix+0Ch)
     498/     244 : DD 77 0B            		ld	(ix+0Bh), a
     499/     247 : 18 33               		jr	loc_27C
     500/     249 :                     ; ---------------------------------------------------------------------------
     501/     249 :                     
     502/     249 :                     loc_249:				; CODE XREF: TrkUpdate_Proc+64j
     503/     249 : 1A                  		ld	a, (de)
     504/     24A : 13                  		inc	de
     505/     24B : DD 77 10            		ld	(ix+10h), a
     506/     24E : 18 24               		jr	loc_274
     507/     250 :                     ; ---------------------------------------------------------------------------
     508/     250 :                     
     509/     250 :                     DoRawFreqMode:				; CODE XREF: TrkUpdate_Proc+21j
     510/     250 : 67                  		ld	h, a
     511/     251 : 1A                  		ld	a, (de)
     512/     252 : 13                  		inc	de
     513/     253 : 6F                  		ld	l, a
     514/     254 : B4                  		or	h
     515/     255 : 28 0C               		jr	z, loc_263
     516/     257 : DD 7E 05            		ld	a, (ix+5)
     517/     25A : 06 00               		ld	b, 0
     518/     25C : B7                  		or	a
     519/     25D : F2 61 02            		jp	p, loc_261
     520/     260 : 05                  		dec	b
     521/     261 :                     
     522/     261 :                     loc_261:				; CODE XREF: TrkUpdate_Proc+87j
     523/     261 : 4F                  		ld	c, a
     524/     262 : 09                  		add	hl, bc
     525/     263 :                     
     526/     263 :                     loc_263:				; CODE XREF: TrkUpdate_Proc+7Fj
     527/     263 : DD 75 0D            		ld	(ix+0Dh), l
     528/     266 : DD 74 0E            		ld	(ix+0Eh), h
     529/     269 : DD CB 00 6E         		bit	5, (ix+0)
     530/     26D : 28 05               		jr	z, loc_274
     531/     26F : 1A                  		ld	a, (de)
     532/     270 : 13                  		inc	de
     533/     271 : DD 77 10            		ld	(ix+10h), a
     534/     274 :                     
     535/     274 :                     loc_274:				; CODE XREF: TrkUpdate_Proc+78j
     536/     274 :                     					; TrkUpdate_Proc+97j
     537/     274 : 1A                  		ld	a, (de)
     538/     275 :                     
     539/     275 :                     loc_275:				; CODE XREF: TrkUpdate_Proc+68j
     540/     275 : 13                  		inc	de
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 10 - 5/8/2024 17:23:58


     541/     276 :                     
     542/     276 :                     SetDuration:				; CODE XREF: TrkUpdate_Proc+25j
     543/     276 :                     					; DrumUpdate_Proc+9Aj
     544/     276 : CD 9E 02            		call	TickMultiplier
     545/     279 : DD 77 0C            		ld	(ix+0Ch), a
     546/     27C :                     
     547/     27C :                     loc_27C:				; CODE XREF: TrkUpdate_Proc+71j
     548/     27C :                     					; DrumUpdate_Proc+A4j
     549/     27C : DD 73 03            		ld	(ix+3),	e
     550/     27F : DD 72 04            		ld	(ix+4),	d
     551/     282 : DD 7E 0C            		ld	a, (ix+0Ch)
     552/     285 : DD 77 0B            		ld	(ix+0Bh), a
     553/     288 : DD CB 00 4E         		bit	1, (ix+0)
     554/     28C : C0                  		ret	nz
     555/     28D : AF                  		xor	a
     556/     28E : DD 77 25            		ld	(ix+25h), a
     557/     291 : DD 77 22            		ld	(ix+22h), a
     558/     294 : DD 7E 1F            		ld	a, (ix+1Fh)
     559/     297 : DD 77 1E            		ld	(ix+1Eh), a
     560/     29A : DD 77 17            		ld	(ix+17h), a
     561/     29D : C9                  		ret
     562/     29E :                     ; End of function TrkUpdate_Proc
     563/     29E :                     
     564/     29E :                     
     565/     29E :                     ; =============== S U B	R O U T	I N E =======================================
     566/     29E :                     
     567/     29E :                     
     568/     29E :                     TickMultiplier:				; CODE XREF: TrkUpdate_Proc:SetDurationp
     569/     29E :                     					; RAM:cfE8_NoteStopp
     570/     29E : DD 46 02            		ld	b, (ix+2)
     571/     2A1 : 05                  		dec	b
     572/     2A2 : C8                  		ret	z
     573/     2A3 : 4F                  		ld	c, a
     574/     2A4 :                     
     575/     2A4 :                     loc_2A4:				; CODE XREF: TickMultiplier+7j
     576/     2A4 : 81                  		add	a, c
     577/     2A5 : 10 FD               		djnz	loc_2A4
     578/     2A7 : C9                  		ret
     579/     2A8 :                     ; End of function TickMultiplier
     580/     2A8 :                     
     581/     2A8 :                     
     582/     2A8 :                     ; =============== S U B	R O U T	I N E =======================================
     583/     2A8 :                     
     584/     2A8 :                     
     585/     2A8 :                     DoPanAnimation:				; CODE XREF: TrkUpdate_Proc+19p
     586/     2A8 : DD 7E 11            		ld	a, (ix+11h)
     587/     2AB : 3D                  		dec	a
     588/     2AC : F8                  		ret	m
     589/     2AD : 20 3B               		jr	nz, loc_2EA
     590/     2AF : DD CB 00 4E         		bit	1, (ix+0)
     591/     2B3 : C0                  		ret	nz
     592/     2B4 :                     
     593/     2B4 :                     loc_2B4:				; CODE XREF: ExecPanAnim+6j
     594/     2B4 : DD 35 16            		dec	(ix+16h)
     595/     2B7 : C0                  		ret	nz
     596/     2B8 : D9                  		exx
     597/     2B9 : DD 7E 15            		ld	a, (ix+15h)
     598/     2BC : DD 77 16            		ld	(ix+16h), a
     599/     2BF : DD 7E 12            		ld	a, (ix+12h)
     600/     2C2 : 21 F6 02            		ld	hl, PanAniPtrList
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 11 - 5/8/2024 17:23:58


     601/     2C5 : EF                  		rst	ReadPtrTable
     602/     2C6 : DD 5E 13            		ld	e, (ix+13h)
     603/     2C9 : DD 34 13            		inc	(ix+13h)
     604/     2CC : DD 7E 14            		ld	a, (ix+14h)
     605/     2CF : 3D                  		dec	a
     606/     2D0 : BB                  		cp	e
     607/     2D1 : 20 0E               		jr	nz, loc_2E1
     608/     2D3 : DD 35 13            		dec	(ix+13h)
     609/     2D6 : DD 7E 11            		ld	a, (ix+11h)
     610/     2D9 : FE 02               		cp	2
     611/     2DB : 28 04               		jr	z, loc_2E1
     612/     2DD : DD 36 13 00         		ld	(ix+13h), 0
     613/     2E1 :                     
     614/     2E1 :                     loc_2E1:				; CODE XREF: DoPanAnimation+29j
     615/     2E1 :                     					; DoPanAnimation+33j
     616/     2E1 : 16 00               		ld	d, 0
     617/     2E3 : 19                  		add	hl, de
     618/     2E4 : EB                  		ex	de, hl
     619/     2E5 : CD 89 0D            		call	cfE0_Pan
     620/     2E8 : D9                  		exx
     621/     2E9 : C9                  		ret
     622/     2EA :                     ; ---------------------------------------------------------------------------
     623/     2EA :                     
     624/     2EA :                     loc_2EA:				; CODE XREF: DoPanAnimation+5j
     625/     2EA : AF                  		xor	a
     626/     2EB : DD 77 13            		ld	(ix+13h), a
     627/     2EE :                     ; End of function DoPanAnimation
     628/     2EE :                     
     629/     2EE :                     
     630/     2EE :                     ; =============== S U B	R O U T	I N E =======================================
     631/     2EE :                     
     632/     2EE :                     
     633/     2EE :                     ExecPanAnim:				; CODE XREF: UpdateTrack:loc_15Cp
     634/     2EE : DD 7E 11            		ld	a, (ix+11h)
     635/     2F1 : D6 02               		sub	2
     636/     2F3 : F8                  		ret	m
     637/     2F4 : 18 BE               		jr	loc_2B4
     638/     2F6 :                     ; End of function ExecPanAnim
     639/     2F6 :                     
     640/     2F6 :                     ; ---------------------------------------------------------------------------
     641/     2F6 : FE 02 FF 02 00 03   PanAniPtrList:	dw byte_2FE, byte_2FF, byte_300, byte_301 ; DATA XREF: DoPanAnimation+1Ao
              2FC : 01 03             
     642/     2FE : C0                  byte_2FE:	db 0C0h			; DATA XREF: RAM:PanAniPtrListo
     643/     2FF : 80                  byte_2FF:	db  80h			; DATA XREF: RAM:PanAniPtrListo
     644/     300 : C0                  byte_300:	db 0C0h			; DATA XREF: RAM:PanAniPtrListo
     645/     301 : 40 80 C0            byte_301:	db  40h, 80h,0C0h	; DATA XREF: RAM:PanAniPtrListo
     646/     304 :                     
     647/     304 :                     ; =============== S U B	R O U T	I N E =======================================
     648/     304 :                     
     649/     304 :                     
     650/     304 :                     TrackTimeout:				; CODE XREF: UpdateTrack+7p
     651/     304 :                     					; DrumUpdateTrackp ...
     652/     304 : DD 7E 0B            		ld	a, (ix+0Bh)
     653/     307 : 3D                  		dec	a
     654/     308 : DD 77 0B            		ld	(ix+0Bh), a
     655/     30B : C9                  		ret
     656/     30C :                     ; End of function TrackTimeout
     657/     30C :                     
     658/     30C :                     
     659/     30C :                     ; =============== S U B	R O U T	I N E =======================================
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 12 - 5/8/2024 17:23:58


     660/     30C :                     
     661/     30C :                     
     662/     30C :                     DoFMVolEnv:				; CODE XREF: UpdateTrack+2Bp
     663/     30C : DD 7E 18            		ld	a, (ix+18h)
     664/     30F : B7                  		or	a
     665/     310 : C8                  		ret	z
     666/     311 : 3D                  		dec	a
     667/     312 : 0E 0A               		ld	c, 0Ah
     668/     314 : E7                  		rst	GetListOfs	; get List 5 (PSG/Volume envelopes)
     669/     315 : EF                  		rst	ReadPtrTable
     670/     316 : CD 97 0F            		call	DoPSGVolEnv
     671/     319 : DD 66 1D            		ld	h, (ix+1Dh)
     672/     31C : DD 6E 1C            		ld	l, (ix+1Ch)
     673/     31F : 11 DE 04            		ld	de, Volume_Ops
     674/     322 : 06 04               		ld	b, 4
     675/     324 : DD 4E 19            		ld	c, (ix+19h)
     676/     327 :                     
     677/     327 :                     loc_327:				; CODE XREF: DoFMVolEnv+2Bj
     678/     327 : F5                  		push	af
     679/     328 : CB 29               		sra	c
     680/     32A : C5                  		push	bc
     681/     32B : 30 06               		jr	nc, loc_333
     682/     32D : 86                  		add	a, (hl)
     683/     32E : E6 7F               		and	7Fh
     684/     330 : 4F                  		ld	c, a
     685/     331 : 1A                  		ld	a, (de)
     686/     332 : D7                  		rst	WriteFMMain
     687/     333 :                     
     688/     333 :                     loc_333:				; CODE XREF: DoFMVolEnv+1Fj
     689/     333 : C1                  		pop	bc
     690/     334 : 13                  		inc	de
     691/     335 : 23                  		inc	hl
     692/     336 : F1                  		pop	af
     693/     337 : 10 EE               		djnz	loc_327
     694/     339 : C9                  		ret
     695/     33A :                     ; End of function DoFMVolEnv
     696/     33A :                     
     697/     33A :                     
     698/     33A :                     ; =============== S U B	R O U T	I N E =======================================
     699/     33A :                     
     700/     33A :                     
     701/     33A :                     PrepareModulat:				; CODE XREF: UpdateTrack+14p
     702/     33A :                     					; UpdateTrack+DF2p
     703/     33A : DD CB 07 7E         		bit	7, (ix+7)
     704/     33E : C8                  		ret	z
     705/     33F : DD CB 00 4E         		bit	1, (ix+0)
     706/     343 : C0                  		ret	nz
     707/     344 : DD 5E 20            		ld	e, (ix+20h)
     708/     347 : DD 56 21            		ld	d, (ix+21h)
     709/     34A : DD E5               		push	ix
     710/     34C : E1                  		pop	hl
     711/     34D : 06 00               		ld	b, 0
     712/     34F : 0E 24               		ld	c, 24h
     713/     351 : 09                  		add	hl, bc
     714/     352 : EB                  		ex	de, hl
     715/     353 : ED A0               		ldi
     716/     355 : ED A0               		ldi
     717/     357 : ED A0               		ldi
     718/     359 : 7E                  		ld	a, (hl)
     719/     35A : CB 3F               		srl	a
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 13 - 5/8/2024 17:23:58


     720/     35C : 12                  		ld	(de), a
     721/     35D : AF                  		xor	a
     722/     35E : DD 77 22            		ld	(ix+22h), a
     723/     361 : DD 77 23            		ld	(ix+23h), a
     724/     364 : C9                  		ret
     725/     365 :                     ; End of function PrepareModulat
     726/     365 :                     
     727/     365 :                     
     728/     365 :                     ; =============== S U B	R O U T	I N E =======================================
     729/     365 :                     
     730/     365 :                     
     731/     365 :                     DoModulation:				; CODE XREF: UpdateTrack+1Ap
     732/     365 :                     					; UpdateTrack+42p ...
     733/     365 : DD 7E 07            		ld	a, (ix+7)
     734/     368 : B7                  		or	a
     735/     369 : C8                  		ret	z		; ModType 00 ->	return (modulation off)
     736/     36A : FE 80               		cp	80h
     737/     36C : 20 48               		jr	nz, DoModEnv	; ModType != 80	-> jump
     738/     36E : DD 35 24            		dec	(ix+24h)	; ModType 80 ->	manual modulation parameters
     739/     371 : C0                  		ret	nz
     740/     372 : DD 34 24            		inc	(ix+24h)
     741/     375 : E5                  		push	hl
     742/     376 : DD 6E 22            		ld	l, (ix+22h)
     743/     379 : DD 66 23            		ld	h, (ix+23h)
     744/     37C : DD 35 25            		dec	(ix+25h)
     745/     37F : 20 20               		jr	nz, loc_3A1
     746/     381 : DD 5E 20            		ld	e, (ix+20h)
     747/     384 : DD 56 21            		ld	d, (ix+21h)
     748/     387 : D5                  		push	de
     749/     388 : FD E1               		pop	iy
     750/     38A : FD 7E 01            		ld	a, (iy+1)
     751/     38D : DD 77 25            		ld	(ix+25h), a
     752/     390 : DD 7E 26            		ld	a, (ix+26h)
     753/     393 : 4F                  		ld	c, a
     754/     394 : E6 80               		and	80h
     755/     396 : 07                  		rlca
     756/     397 : ED 44               		neg
     757/     399 : 47                  		ld	b, a
     758/     39A : 09                  		add	hl, bc
     759/     39B : DD 75 22            		ld	(ix+22h), l
     760/     39E : DD 74 23            		ld	(ix+23h), h
     761/     3A1 :                     
     762/     3A1 :                     loc_3A1:				; CODE XREF: DoModulation+1Aj
     763/     3A1 : C1                  		pop	bc
     764/     3A2 : 09                  		add	hl, bc
     765/     3A3 : DD 35 27            		dec	(ix+27h)
     766/     3A6 : C0                  		ret	nz
     767/     3A7 : FD 7E 03            		ld	a, (iy+3)
     768/     3AA : DD 77 27            		ld	(ix+27h), a
     769/     3AD : DD 7E 26            		ld	a, (ix+26h)
     770/     3B0 : ED 44               		neg
     771/     3B2 : DD 77 26            		ld	(ix+26h), a
     772/     3B5 : C9                  		ret
     773/     3B6 :                     ; ---------------------------------------------------------------------------
     774/     3B6 :                     
     775/     3B6 :                     DoModEnv:				; CODE XREF: DoModulation+7j
     776/     3B6 : 3D                  		dec	a
     777/     3B7 : EB                  		ex	de, hl
     778/     3B8 : 0E 08               		ld	c, 8
     779/     3BA : 06 80               		ld	b, 80h
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 14 - 5/8/2024 17:23:58


     780/     3BC : CD E7 05            		call	GetListOfsAB	; get List 4 (Modulation Pointers)
     781/     3BF : 18 03               		jr	loc_3C4
     782/     3C1 :                     ; ---------------------------------------------------------------------------
     783/     3C1 :                     
     784/     3C1 :                     loc_3C1:				; CODE XREF: DoModulation+84j
     785/     3C1 :                     					; DoModulation+87j
     786/     3C1 : DD 77 25            		ld	(ix+25h), a
     787/     3C4 :                     
     788/     3C4 :                     loc_3C4:				; CODE XREF: DoModulation+5Aj
     789/     3C4 :                     					; DoModulation+97j
     790/     3C4 : E5                  		push	hl
     791/     3C5 : DD 4E 25            		ld	c, (ix+25h)
     792/     3C8 : CD 81 04            		call	GetEnvData	; BC = HL (base) + BC (index), A = (BC)
     793/     3CB : E1                  		pop	hl
     794/     3CC : CB 7F               		bit	7, a
     795/     3CE : CA FE 03            		jp	z, ModEnv_Positive
     796/     3D1 : FE 82               		cp	82h
     797/     3D3 : 28 12               		jr	z, ModEnv_Jump2Idx ; 82	xx - jump to byte xx
     798/     3D5 : FE 80               		cp	80h
     799/     3D7 : 28 12               		jr	z, ModEnv_Reset	; 80 - loop back to beginning
     800/     3D9 : FE 84               		cp	84h
     801/     3DB : 28 11               		jr	z, ModEnv_ChgMult ; 84 - change	Modulation Multipler
     802/     3DD : 26 FF               		ld	h, 0FFh		; make HL negative (FFxx)
     803/     3DF : 30 1F               		jr	nc, ModEnv_Next
     804/     3E1 : DD CB 00 F6         		set	6, (ix+0)
     805/     3E5 : E1                  		pop	hl
     806/     3E6 : C9                  		ret
     807/     3E7 :                     ; ---------------------------------------------------------------------------
     808/     3E7 :                     
     809/     3E7 :                     ModEnv_Jump2Idx:			; CODE XREF: DoModulation+6Ej
     810/     3E7 : 03                  		inc	bc
     811/     3E8 : 0A                  		ld	a, (bc)
     812/     3E9 : 18 D6               		jr	loc_3C1
     813/     3EB :                     ; ---------------------------------------------------------------------------
     814/     3EB :                     
     815/     3EB :                     ModEnv_Reset:				; CODE XREF: DoModulation+72j
     816/     3EB : AF                  		xor	a
     817/     3EC : 18 D3               		jr	loc_3C1
     818/     3EE :                     ; ---------------------------------------------------------------------------
     819/     3EE :                     
     820/     3EE :                     ModEnv_ChgMult:				; CODE XREF: DoModulation+76j
     821/     3EE : 03                  		inc	bc
     822/     3EF : 0A                  		ld	a, (bc)
     823/     3F0 : DD 86 22            		add	a, (ix+22h)
     824/     3F3 : DD 77 22            		ld	(ix+22h), a
     825/     3F6 : DD 34 25            		inc	(ix+25h)
     826/     3F9 : DD 34 25            		inc	(ix+25h)
     827/     3FC : 18 C6               		jr	loc_3C4
     828/     3FE :                     ; ---------------------------------------------------------------------------
     829/     3FE :                     
     830/     3FE :                     ModEnv_Positive:			; CODE XREF: DoModulation+69j
     831/     3FE : 26 00               		ld	h, 0		; make HL positive (00xx)
     832/     400 :                     
     833/     400 :                     ModEnv_Next:				; CODE XREF: DoModulation+7Aj
     834/     400 : 6F                  		ld	l, a
     835/     401 : DD 46 22            		ld	b, (ix+22h)
     836/     404 : 04                  		inc	b
     837/     405 : EB                  		ex	de, hl
     838/     406 :                     
     839/     406 :                     loc_406:				; CODE XREF: DoModulation+A2j
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 15 - 5/8/2024 17:23:58


     840/     406 : 19                  		add	hl, de
     841/     407 : 10 FD               		djnz	loc_406
     842/     409 : DD 34 25            		inc	(ix+25h)
     843/     40C : C9                  		ret
     844/     40D :                     ; End of function DoModulation
     845/     40D :                     
     846/     40D :                     ; ---------------------------------------------------------------------------
     847/     40D :                     ; START	OF FUNCTION CHUNK FOR UpdateTrack
     848/     40D :                     
     849/     40D :                     DoNoteOn:				; CODE XREF: UpdateTrack+20j
     850/     40D : DD 7E 0D            		ld	a, (ix+0Dh)
     851/     410 : DD B6 0E            		or	(ix+0Eh)
     852/     413 : C8                  		ret	z
     853/     414 : DD 7E 00            		ld	a, (ix+0)
     854/     417 : E6 06               		and	6
     855/     419 : C0                  		ret	nz
     856/     41A : DD 7E 01            		ld	a, (ix+1)
     857/     41D : F6 F0               		or	0F0h
     858/     41F : 4F                  		ld	c, a
     859/     420 : 3E 28               		ld	a, 28h
     860/     422 : DF                  		rst	WriteFMI
     861/     423 : C9                  		ret
     862/     424 :                     ; END OF FUNCTION CHUNK	FOR UpdateTrack
     863/     424 :                     
     864/     424 :                     ; =============== S U B	R O U T	I N E =======================================
     865/     424 :                     
     866/     424 :                     
     867/     424 :                     DoNoteOff:				; CODE XREF: TrkUpdate_Proc+16p
     868/     424 :                     					; PlaySoundID+18Bp ...
     869/     424 : DD 7E 00            		ld	a, (ix+0)
     870/     427 : E6 06               		and	6
     871/     429 : C0                  		ret	nz
     872/     42A :                     
     873/     42A :                     SendNoteOff:				; CODE XREF: UpdateTrack+37j RAM:0C6Ap
     874/     42A : DD 4E 01            		ld	c, (ix+1)
     875/     42D : CB 79               		bit	7, c
     876/     42F : C0                  		ret	nz
     877/     430 :                     
     878/     430 :                     FMNoteOff:				; CODE XREF: SilenceFMChn+Dj
     879/     430 : 3E 28               		ld	a, 28h
     880/     432 : DF                  		rst	WriteFMI
     881/     433 : C9                  		ret
     882/     434 :                     ; End of function DoNoteOff
     883/     434 :                     
     884/     434 :                     
     885/     434 :                     ; =============== S U B	R O U T	I N E =======================================
     886/     434 :                     
     887/     434 :                     
     888/     434 :                     DoPitchSlide:				; CODE XREF: UpdateTrack+17p
     889/     434 :                     					; UpdateTrack:loc_173p	...
     890/     434 : 06 00               		ld	b, 0
     891/     436 : DD 7E 10            		ld	a, (ix+10h)
     892/     439 : B7                  		or	a
     893/     43A : F2 3E 04            		jp	p, loc_43E
     894/     43D : 05                  		dec	b
     895/     43E :                     
     896/     43E :                     loc_43E:				; CODE XREF: DoPitchSlide+6j
     897/     43E : DD 66 0E            		ld	h, (ix+0Eh)
     898/     441 : DD 6E 0D            		ld	l, (ix+0Dh)
     899/     444 : 4F                  		ld	c, a
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 16 - 5/8/2024 17:23:58


     900/     445 : 09                  		add	hl, bc
     901/     446 : DD CB 01 7E         		bit	7, (ix+1)
     902/     44A : 20 22               		jr	nz, loc_46E
     903/     44C : EB                  		ex	de, hl
     904/     44D : 3E 07               		ld	a, 7
     905/     44F : A2                  		and	d
     906/     450 : 47                  		ld	b, a
     907/     451 : 4B                  		ld	c, e
     908/     452 : B7                  		or	a
     909/     453 : 21 83 02            		ld	hl, 283h
     910/     456 : ED 42               		sbc	hl, bc
     911/     458 : 38 06               		jr	c, loc_460
     912/     45A : 21 85 FA            		ld	hl, -57Bh
     913/     45D : 19                  		add	hl, de
     914/     45E : 18 0E               		jr	loc_46E
     915/     460 :                     ; ---------------------------------------------------------------------------
     916/     460 :                     
     917/     460 :                     loc_460:				; CODE XREF: DoPitchSlide+24j
     918/     460 : B7                  		or	a
     919/     461 : 21 08 05            		ld	hl, 508h
     920/     464 : ED 42               		sbc	hl, bc
     921/     466 : 30 05               		jr	nc, loc_46D
     922/     468 : 21 7C 05            		ld	hl, 57Ch
     923/     46B : 19                  		add	hl, de
     924/     46C : EB                  		ex	de, hl
     925/     46D :                     
     926/     46D :                     loc_46D:				; CODE XREF: DoPitchSlide+32j
     927/     46D : EB                  		ex	de, hl
     928/     46E :                     
     929/     46E :                     loc_46E:				; CODE XREF: DoPitchSlide+16j
     930/     46E :                     					; DoPitchSlide+2Aj
     931/     46E : DD CB 00 6E         		bit	5, (ix+0)
     932/     472 : C8                  		ret	z
     933/     473 : DD 74 0E            		ld	(ix+0Eh), h
     934/     476 : DD 75 0D            		ld	(ix+0Dh), l
     935/     479 : C9                  		ret
     936/     47A :                     ; End of function DoPitchSlide
     937/     47A :                     
     938/     47A :                     
     939/     47A :                     ; =============== S U B	R O U T	I N E =======================================
     940/     47A :                     
     941/     47A :                     
     942/     47A :                     GetPtrListOfs:				; CODE XREF: GetListOfs+3j
     943/     47A :                     					; GetListOfsAB+7p
     944/     47A : 06 00               		ld	b, 0
     945/     47C : 09                  		add	hl, bc
     946/     47D : 08                  		ex	af, af'
     947/     47E : F7                  		rst	ReadPtrFromHL
     948/     47F : 08                  		ex	af, af'
     949/     480 : C9                  		ret
     950/     481 :                     ; End of function GetPtrListOfs
     951/     481 :                     
     952/     481 :                     
     953/     481 :                     ; =============== S U B	R O U T	I N E =======================================
     954/     481 :                     
     955/     481 :                     ; BC = HL (base) + BC (index), A = (BC)
     956/     481 :                     
     957/     481 :                     GetEnvData:				; CODE XREF: DoModulation+63p
     958/     481 :                     					; DoPSGVolEnv+4p
     959/     481 : 06 00               		ld	b, 0
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 17 - 5/8/2024 17:23:58


     960/     483 : 09                  		add	hl, bc
     961/     484 : 4D                  		ld	c, l
     962/     485 : 44                  		ld	b, h
     963/     486 : 0A                  		ld	a, (bc)
     964/     487 : C9                  		ret
     965/     488 :                     ; End of function GetEnvData
     966/     488 :                     
     967/     488 :                     
     968/     488 :                     ; =============== S U B	R O U T	I N E =======================================
     969/     488 :                     
     970/     488 :                     
     971/     488 :                     GetFMInsPtr:				; CODE XREF: SetInsFromSong+19p
     972/     488 : 2A 37 1C            		ld	hl, (word_1C37)
     973/     48B : 3A 19 1C            		ld	a, (byte_1C19)
     974/     48E : B7                  		or	a
     975/     48F : 28 06               		jr	z, JumpToInsData ; Mode	00 (Music Mode)	- jump
     976/     491 : DD 6E 2A            		ld	l, (ix+2Ah)	; load SFX track Instrument Pointer (Trk+2A/2B)
     977/     494 : DD 66 2B            		ld	h, (ix+2Bh)
     978/     497 :                     ; End of function GetFMInsPtr
     979/     497 :                     
     980/     497 :                     
     981/     497 :                     ; =============== S U B	R O U T	I N E =======================================
     982/     497 :                     
     983/     497 :                     
     984/     497 :                     JumpToInsData:				; CODE XREF: GetFMInsPtr+7j
     985/     497 :                     					; SetInsFromSong+12p ...
     986/     497 : AF                  		xor	a
     987/     498 : B0                  		or	b
     988/     499 : 28 06               		jr	z, locret_4A1
     989/     49B : 11 19 00            		ld	de, 19h
     990/     49E :                     
     991/     49E :                     loc_49E:				; CODE XREF: JumpToInsData+8j
     992/     49E : 19                  		add	hl, de
     993/     49F : 10 FD               		djnz	loc_49E
     994/     4A1 :                     
     995/     4A1 :                     locret_4A1:				; CODE XREF: JumpToInsData+2j
     996/     4A1 : C9                  		ret
     997/     4A2 :                     ; End of function JumpToInsData
     998/     4A2 :                     
     999/     4A2 :                     ; ---------------------------------------------------------------------------
    1000/     4A2 :                     ; START	OF FUNCTION CHUNK FOR WriteFMMain
    1001/     4A2 :                     
    1002/     4A2 :                     WriteFMIorII:				; CODE XREF: WriteFMMain+5j
    1003/     4A2 : DD CB 01 56         		bit	2, (ix+1)	; is FM	4-6?
    1004/     4A6 : 20 0E               		jr	nz, WriteFMIIPart
    1005/     4A8 : DD CB 00 56         		bit	2, (ix+0)
    1006/     4AC : C0                  		ret	nz
    1007/     4AD : DD 86 01            		add	a, (ix+1)	; add Channel Bits to register value
    1008/     4B0 : DF                  		rst	WriteFMI
    1009/     4B1 : C9                  		ret
    1010/     4B2 :                     ; END OF FUNCTION CHUNK	FOR WriteFMMain
    1011/     4B2 :                     ; ---------------------------------------------------------------------------
    1012/     4B2 :                     ; START	OF FUNCTION CHUNK FOR WriteFMI
    1013/     4B2 :                     
    1014/     4B2 :                     loc_4B2:				; CODE XREF: WriteFMI+5j
    1015/     4B2 : 32 01 40            		ld	(4001h), a
    1016/     4B5 : C9                  		ret
    1017/     4B6 :                     ; END OF FUNCTION CHUNK	FOR WriteFMI
    1018/     4B6 :                     ; ---------------------------------------------------------------------------
    1019/     4B6 :                     ; START	OF FUNCTION CHUNK FOR WriteFMMain
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 18 - 5/8/2024 17:23:58


    1020/     4B6 :                     
    1021/     4B6 :                     WriteFMIIPart:				; CODE XREF: WriteFMMain+496j
    1022/     4B6 : DD CB 00 56         		bit	2, (ix+0)
    1023/     4BA : C0                  		ret	nz
    1024/     4BB : DD 86 01            		add	a, (ix+1)
    1025/     4BE : D6 04               		sub	4
    1026/     4C0 :                     ; END OF FUNCTION CHUNK	FOR WriteFMMain
    1027/     4C0 :                     
    1028/     4C0 :                     ; =============== S U B	R O U T	I N E =======================================
    1029/     4C0 :                     
    1030/     4C0 :                     
    1031/     4C0 :                     WriteFMII:				; CODE XREF: DoPause+11Bp
    1032/     4C0 : 32 02 40            		ld	(4002h), a
    1033/     4C3 : CF                  		rst	WaitForYM
    1034/     4C4 : 79                  		ld	a, c
    1035/     4C5 : 32 03 40            		ld	(4003h), a
    1036/     4C8 : C9                  		ret
    1037/     4C9 :                     ; End of function WriteFMII
    1038/     4C9 :                     
    1039/     4C9 :                     ; ---------------------------------------------------------------------------
    1040/     4C9 : B0                  FMInsOperators:	db 0B0h			; DATA XREF: SendFMInso
    1041/     4CA : 30 38 34 3C         		db  30h, 38h, 34h, 3Ch
    1042/     4CE : 50 58 54 5C         		db  50h, 58h, 54h, 5Ch
    1043/     4D2 : 60 68 64 6C         		db  60h, 68h, 64h, 6Ch
    1044/     4D6 : 70 78 74 7C         		db  70h, 78h, 74h, 7Ch
    1045/     4DA : 80 88 84 8C         		db  80h, 88h, 84h, 8Ch
    1046/     4DE : 40 48 44 4C         Volume_Ops:	db  40h, 48h, 44h, 4Ch	; DATA XREF: DoFMVolEnv+13o
    1047/     4E2 :                     					; RefreshVolume+1o
    1048/     4E2 : 90 98 94 9C         SSGEG_Ops:	db  90h, 98h, 94h, 9Ch	; DATA XREF: SendSSGEGo
    1049/     4E6 :                     
    1050/     4E6 :                     ; =============== S U B	R O U T	I N E =======================================
    1051/     4E6 :                     
    1052/     4E6 :                     
    1053/     4E6 :                     SendFMIns:				; CODE XREF: DrumUpdate_Proc+5Fp
    1054/     4E6 :                     					; SetInsFromSong:loc_D7Fp ...
    1055/     4E6 : 11 C9 04            		ld	de, FMInsOperators
    1056/     4E9 : DD 4E 0A            		ld	c, (ix+0Ah)
    1057/     4EC : 3E B4               		ld	a, 0B4h
    1058/     4EE : D7                  		rst	WriteFMMain
    1059/     4EF : CD 05 05            		call	WriteInsReg
    1060/     4F2 : DD 77 1B            		ld	(ix+1Bh), a
    1061/     4F5 : 06 14               		ld	b, 14h
    1062/     4F7 :                     
    1063/     4F7 :                     loc_4F7:				; CODE XREF: SendFMIns+14j
    1064/     4F7 : CD 05 05            		call	WriteInsReg
    1065/     4FA : 10 FB               		djnz	loc_4F7
    1066/     4FC : DD 75 1C            		ld	(ix+1Ch), l
    1067/     4FF : DD 74 1D            		ld	(ix+1Dh), h
    1068/     502 : C3 A3 0D            		jp	RefreshVolume
    1069/     505 :                     ; End of function SendFMIns
    1070/     505 :                     
    1071/     505 :                     
    1072/     505 :                     ; =============== S U B	R O U T	I N E =======================================
    1073/     505 :                     
    1074/     505 :                     
    1075/     505 :                     WriteInsReg:				; CODE XREF: SendFMIns+9p
    1076/     505 :                     					; SendFMIns:loc_4F7p
    1077/     505 : 1A                  		ld	a, (de)
    1078/     506 : 13                  		inc	de
    1079/     507 : 4E                  		ld	c, (hl)
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 19 - 5/8/2024 17:23:58


    1080/     508 : 23                  		inc	hl
    1081/     509 : D7                  		rst	WriteFMMain
    1082/     50A : C9                  		ret
    1083/     50B :                     ; End of function WriteInsReg
    1084/     50B :                     
    1085/     50B :                     
    1086/     50B :                     ; =============== S U B	R O U T	I N E =======================================
    1087/     50B :                     
    1088/     50B :                     
    1089/     50B :                     PlaySoundID:				; CODE XREF: RAM:0095p	UpdateAll+9p
    1090/     50B :                     
    1091/     50B :                     ; FUNCTION CHUNK AT 060A SIZE 00000099 BYTES
    1092/     50B :                     ; FUNCTION CHUNK AT 0E40 SIZE 0000009A BYTES
    1093/     50B :                     
    1094/     50B : 3A 09 1C            		ld	a, (byte_1C09)
    1095/     50E :                     
    1096/     50E :                     PlaySnd_JumpIn:				; CODE XREF: RAM:0C4Ep
    1097/     50E : CB 7F               		bit	7, a
    1098/     510 : CA 01 08            		jp	z, StopAllSound	; 00-7F	- Stop All
    1099/     513 : FE 90               		cp	90h
    1100/     515 : DA 57 05            		jp	c, PlayMusic	; 80-8F	- Music
    1101/     518 : FE D0               		cp	0D0h		; Note:	93h in Sega Channel BIOS (J)
    1102/     51A : DA 15 06            		jp	c, PlaySFX	; 90-CF	- SFX
    1103/     51D : FE E0               		cp	0E0h
    1104/     51F : DA 0A 06            		jp	c, PlaySpcSFX	; D0-DF	- Special SFX
    1105/     522 : FE F9               		cp	0F9h
    1106/     524 : D2 01 08            		jp	nc, StopAllSound ; F9-FF - Stop	All
    1107/     527 :                     
    1108/     527 :                     PlaySnd_Command:			; E0-F8	- Special Commands
    1109/     527 : D6 E0               		sub	0E0h
    1110/     529 : 21 2E 05            		ld	hl, CmdPtrTable
    1111/     52C : EF                  		rst	ReadPtrTable
    1112/     52D : E9                  		jp	(hl)
    1113/     52E :                     ; ---------------------------------------------------------------------------
    1114/     52E :                     CmdPtrTable:				; DATA XREF: PlaySoundID+1Eo
    1115/     52E : 92 07 01 08 69 08   		dw FadeOutMusic, StopAllSound, SilencePSG, StopSpcSFX
              534 : 36 05             
    1116/     536 :                     ; ---------------------------------------------------------------------------
    1117/     536 :                     
    1118/     536 :                     StopSpcSFX:				; DATA XREF: PlaySoundID:CmdPtrTableo
    1119/     536 : DD 21 20 1E         		ld	ix, byte_1E20	; 1F40 - Special SFX tracks
    1120/     53A : 06 02               		ld	b, 2
    1121/     53C : 3E 80               		ld	a, 80h
    1122/     53E : 32 19 1C            		ld	(byte_1C19), a	; 80 - Special SFX Mode
    1123/     541 :                     
    1124/     541 :                     loc_541:				; CODE XREF: PlaySoundID+44j
    1125/     541 : C5                  		push	bc
    1126/     542 : DD CB 00 7E         		bit	7, (ix+0)	; Track	in use?
    1127/     546 : C4 52 05            		call	nz, loc_552	; yes -	stop it
    1128/     549 : 11 30 00            		ld	de, 30h
    1129/     54C : DD 19               		add	ix, de		; next track
    1130/     54E : C1                  		pop	bc		; restore BC (C	has the	remaining number of tracks)
    1131/     54F : 10 F0               		djnz	loc_541
    1132/     551 : C9                  		ret
    1133/     552 :                     ; ---------------------------------------------------------------------------
    1134/     552 :                     
    1135/     552 :                     loc_552:				; CODE XREF: PlaySoundID+3Bp
    1136/     552 : E5                  		push	hl		; push 4 bytes onto the	stack to make StopTrack
    1137/     553 : E5                  		push	hl		; return to the	correct	routine.
    1138/     554 : C3 40 0E            		jp	cfF2_StopTrk
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 20 - 5/8/2024 17:23:58


    1139/     557 :                     ; ---------------------------------------------------------------------------
    1140/     557 :                     
    1141/     557 :                     PlayMusic:				; CODE XREF: PlaySoundID+Aj
    1142/     557 : D6 81               		sub	81h		; Sound	ID -> Music Index
    1143/     559 : F8                  		ret	m		; was 80 (dummy	command) - return
    1144/     55A : F5                  		push	af
    1145/     55B : CD 01 08            		call	StopAllSound
    1146/     55E : F1                  		pop	af
    1147/     55F : 0E 04               		ld	c, 4
    1148/     561 : 06 08               		ld	b, 8
    1149/     563 : CD E7 05            		call	GetListOfsAB	; get List 2 (Music Pointers)
    1150/     566 : E5                  		push	hl
    1151/     567 : E5                  		push	hl
    1152/     568 : F7                  		rst	ReadPtrFromHL
    1153/     569 : 22 37 1C            		ld	(word_1C37), hl	; save Instrument Pointer
    1154/     56C : E1                  		pop	hl
    1155/     56D : FD E1               		pop	iy
    1156/     56F : FD 7E 05            		ld	a, (iy+5)	; read Tempo
    1157/     572 : 32 13 1C            		ld	(byte_1C13), a	; Tempo	work counter
    1158/     575 : 32 14 1C            		ld	(byte_1C14), a	; Tempo	Reset value
    1159/     578 : 11 06 00            		ld	de, 6
    1160/     57B : 19                  		add	hl, de
    1161/     57C : 22 33 1C            		ld	(word_1C33), hl
    1162/     57F : 21 F6 05            		ld	hl, FMInitBytes
    1163/     582 : 22 35 1C            		ld	(word_1C35), hl
    1164/     585 : 11 40 1C            		ld	de, byte_1C40	; 1C40 - Music Track RAM
    1165/     588 : FD 46 02            		ld	b, (iy+2)	; load FM tracks
    1166/     58B : FD 7E 04            		ld	a, (iy+4)	; load Tick Multiplier
    1167/     58E :                     
    1168/     58E :                     loc_58E:				; CODE XREF: PlaySoundID+A2j
    1169/     58E : C5                  		push	bc
    1170/     58F : 2A 35 1C            		ld	hl, (word_1C35)
    1171/     592 : ED A0               		ldi
    1172/     594 : ED A0               		ldi
    1173/     596 : 12                  		ld	(de), a
    1174/     597 : 13                  		inc	de
    1175/     598 : 22 35 1C            		ld	(word_1C35), hl
    1176/     59B : 2A 33 1C            		ld	hl, (word_1C33)
    1177/     59E : ED A0               		ldi
    1178/     5A0 : ED A0               		ldi
    1179/     5A2 : ED A0               		ldi
    1180/     5A4 : ED A0               		ldi
    1181/     5A6 : 22 33 1C            		ld	(word_1C33), hl
    1182/     5A9 : CD DC 06            		call	FinishFMTrkInit
    1183/     5AC : C1                  		pop	bc
    1184/     5AD : 10 DF               		djnz	loc_58E
    1185/     5AF : FD 7E 03            		ld	a, (iy+3)	; load PSG tracks
    1186/     5B2 : B7                  		or	a
    1187/     5B3 : CA E1 05            		jp	z, ClearSoundID	; no PSG tracks	- skip
    1188/     5B6 : 47                  		ld	b, a
    1189/     5B7 : 21 04 06            		ld	hl, PSGInitBytes
    1190/     5BA : 22 35 1C            		ld	(word_1C35), hl
    1191/     5BD : 11 90 1D            		ld	de, byte_1D90	; 1D90 - Music Track PSG1
    1192/     5C0 : FD 7E 04            		ld	a, (iy+4)	; load Tick Multiplier
    1193/     5C3 :                     
    1194/     5C3 :                     loc_5C3:				; CODE XREF: PlaySoundID+D4j
    1195/     5C3 : C5                  		push	bc		; same as FM init loop ...
    1196/     5C4 : 2A 35 1C            		ld	hl, (word_1C35)
    1197/     5C7 : ED A0               		ldi
    1198/     5C9 : ED A0               		ldi
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 21 - 5/8/2024 17:23:58


    1199/     5CB : 12                  		ld	(de), a
    1200/     5CC : 13                  		inc	de
    1201/     5CD : 22 35 1C            		ld	(word_1C35), hl
    1202/     5D0 : 2A 33 1C            		ld	hl, (word_1C33)
    1203/     5D3 : 01 06 00            		ld	bc, 6
    1204/     5D6 : ED B0               		ldir
    1205/     5D8 : 22 33 1C            		ld	(word_1C33), hl
    1206/     5DB : CD E3 06            		call	FinishTrkInit
    1207/     5DE : C1                  		pop	bc
    1208/     5DF : 10 E2               		djnz	loc_5C3
    1209/     5E1 :                     
    1210/     5E1 :                     ClearSoundID:				; CODE XREF: PlaySoundID+A8j
    1211/     5E1 :                     					; PlaySoundID+195j ...
    1212/     5E1 : 3E 80               		ld	a, 80h
    1213/     5E3 : 32 09 1C            		ld	(byte_1C09), a
    1214/     5E6 : C9                  		ret
    1215/     5E7 :                     ; End of function PlaySoundID
    1216/     5E7 :                     
    1217/     5E7 :                     
    1218/     5E7 :                     ; =============== S U B	R O U T	I N E =======================================
    1219/     5E7 :                     
    1220/     5E7 :                     
    1221/     5E7 :                     GetListOfsAB:				; CODE XREF: DoModulation+57p
    1222/     5E7 :                     					; PlaySoundID+58p ...
    1223/     5E7 : B8                  		cp	b
    1224/     5E8 : 38 09               		jr	c, loc_5F3	; A < B	- use list collection from (1C02)
    1225/     5EA : 90                  		sub	b		; A >= B - use list collection from 8000
    1226/     5EB :                     
    1227/     5EB :                     GetListOfsROM:				; CODE XREF: SetInsFromSong+8p
    1228/     5EB : 21 00 80            		ld	hl, 8000h	; Note:	1200h in Sega Channel BIOS (J)
    1229/     5EE : CD 7A 04            		call	GetPtrListOfs
    1230/     5F1 : 18 01               		jr	loc_5F4
    1231/     5F3 :                     ; ---------------------------------------------------------------------------
    1232/     5F3 :                     
    1233/     5F3 :                     loc_5F3:				; CODE XREF: GetListOfsAB+1j
    1234/     5F3 : E7                  		rst	GetListOfs
    1235/     5F4 :                     
    1236/     5F4 :                     loc_5F4:				; CODE XREF: GetListOfsAB+Aj
    1237/     5F4 : EF                  		rst	ReadPtrTable
    1238/     5F5 : C9                  		ret
    1239/     5F6 :                     ; End of function GetListOfsAB
    1240/     5F6 :                     
    1241/     5F6 :                     ; ---------------------------------------------------------------------------
    1242/     5F6 : 80 02               FMInitBytes:	db  80h,   2		; DATA XREF: PlaySoundID+74o
    1243/     5F8 :                     					; StopAllSound+Do
    1244/     5F8 : 80 00               		db  80h,   0
    1245/     5FA : 80 01               		db  80h,   1
    1246/     5FC : 80 04               		db  80h,   4
    1247/     5FE : 80 05               		db  80h,   5
    1248/     600 : 80 06               		db  80h,   6
    1249/     602 : 80 02               		db  80h,   2
    1250/     604 : 80 80               PSGInitBytes:	db  80h, 80h		; DATA XREF: PlaySoundID+ACo
    1251/     606 : 80 A0               		db  80h,0A0h
    1252/     608 : 80 C0               		db  80h,0C0h
    1253/     60A :                     ; ---------------------------------------------------------------------------
    1254/     60A :                     ; START	OF FUNCTION CHUNK FOR PlaySoundID
    1255/     60A :                     
    1256/     60A :                     PlaySpcSFX:				; CODE XREF: PlaySoundID+14j
    1257/     60A : D6 D0               		sub	0D0h		; Sound	ID -> SFX Index
    1258/     60C : F5                  		push	af
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 22 - 5/8/2024 17:23:58


    1259/     60D : 0E 02               		ld	c, 2
    1260/     60F : E7                  		rst	GetListOfs	; get List 1 (Special SFX)
    1261/     610 : EF                  		rst	ReadPtrTable
    1262/     611 : 3E 80               		ld	a, 80h		; 80 - Special SFX Init-Mode
    1263/     613 : 18 0D               		jr	loc_622
    1264/     615 :                     ; ---------------------------------------------------------------------------
    1265/     615 :                     
    1266/     615 :                     PlaySFX:				; CODE XREF: PlaySoundID+Fj
    1267/     615 : D6 90               		sub	90h		; Sound	ID -> SFX Index
    1268/     617 : F5                  		push	af
    1269/     618 : 0E 06               		ld	c, 6
    1270/     61A : 21 08 1C            		ld	hl, unk_1C08
    1271/     61D : 46                  		ld	b, (hl)
    1272/     61E : CD E7 05            		call	GetListOfsAB	; get List 3 (Normal SFX)
    1273/     621 : AF                  		xor	a		; 00 - normal SFX Init-Mode
    1274/     622 :                     
    1275/     622 :                     loc_622:				; CODE XREF: PlaySoundID+108j
    1276/     622 : 32 19 1C            		ld	(byte_1C19), a
    1277/     625 : F1                  		pop	af
    1278/     626 : E5                  		push	hl
    1279/     627 : F7                  		rst	ReadPtrFromHL
    1280/     628 : 22 39 1C            		ld	(word_1C39), hl
    1281/     62B : AF                  		xor	a
    1282/     62C : 32 15 1C            		ld	(byte_1C15), a
    1283/     62F : E1                  		pop	hl
    1284/     630 : E5                  		push	hl
    1285/     631 : FD E1               		pop	iy
    1286/     633 : FD 7E 02            		ld	a, (iy+2)
    1287/     636 : 32 3B 1C            		ld	(byte_1C3B), a
    1288/     639 : 11 04 00            		ld	de, 4
    1289/     63C : 19                  		add	hl, de
    1290/     63D : FD 46 03            		ld	b, (iy+3)
    1291/     640 :                     
    1292/     640 :                     loc_640:				; CODE XREF: PlaySoundID+193j
    1293/     640 : C5                  		push	bc
    1294/     641 : E5                  		push	hl
    1295/     642 : 23                  		inc	hl
    1296/     643 : 4E                  		ld	c, (hl)
    1297/     644 : CD A3 06            		call	GetSFXChnPtrs
    1298/     647 : CB D6               		set	2, (hl)
    1299/     649 : DD E5               		push	ix
    1300/     64B : 3A 19 1C            		ld	a, (byte_1C19)
    1301/     64E : B7                  		or	a
    1302/     64F : 28 03               		jr	z, loc_654
    1303/     651 : E1                  		pop	hl
    1304/     652 : FD E5               		push	iy
    1305/     654 :                     
    1306/     654 :                     loc_654:				; CODE XREF: PlaySoundID+144j
    1307/     654 : D1                  		pop	de
    1308/     655 : E1                  		pop	hl
    1309/     656 : ED A0               		ldi
    1310/     658 : 1A                  		ld	a, (de)
    1311/     659 : FE 02               		cp	2
    1312/     65B : CC 2B 08            		call	z, ResetSpcFM3Mode
    1313/     65E : ED A0               		ldi
    1314/     660 : 3A 3B 1C            		ld	a, (byte_1C3B)
    1315/     663 : 12                  		ld	(de), a
    1316/     664 : 13                  		inc	de
    1317/     665 : ED A0               		ldi
    1318/     667 : ED A0               		ldi
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 23 - 5/8/2024 17:23:58


    1319/     669 : ED A0               		ldi
    1320/     66B : ED A0               		ldi
    1321/     66D : CD DC 06            		call	FinishFMTrkInit
    1322/     670 : DD CB 00 7E         		bit	7, (ix+0)
    1323/     674 : 28 0C               		jr	z, loc_682
    1324/     676 : DD 7E 01            		ld	a, (ix+1)
    1325/     679 : FD BE 01            		cp	(iy+1)
    1326/     67C : 20 04               		jr	nz, loc_682
    1327/     67E : FD CB 00 D6         		set	2, (iy+0)
    1328/     682 :                     
    1329/     682 :                     loc_682:				; CODE XREF: PlaySoundID+169j
    1330/     682 :                     					; PlaySoundID+171j
    1331/     682 : E5                  		push	hl
    1332/     683 : 2A 39 1C            		ld	hl, (word_1C39)
    1333/     686 : 3A 19 1C            		ld	a, (byte_1C19)
    1334/     689 : B7                  		or	a
    1335/     68A : 28 04               		jr	z, loc_690
    1336/     68C : FD E5               		push	iy
    1337/     68E : DD E1               		pop	ix
    1338/     690 :                     
    1339/     690 :                     loc_690:				; CODE XREF: PlaySoundID+17Fj
    1340/     690 : DD 75 2A            		ld	(ix+2Ah), l
    1341/     693 : DD 74 2B            		ld	(ix+2Bh), h
    1342/     696 : CD 24 04            		call	DoNoteOff
    1343/     699 : CD 37 08            		call	DisableSSGEG
    1344/     69C : E1                  		pop	hl
    1345/     69D : C1                  		pop	bc
    1346/     69E : 10 A0               		djnz	loc_640
    1347/     6A0 : C3 E1 05            		jp	ClearSoundID
    1348/     6A3 :                     ; END OF FUNCTION CHUNK	FOR PlaySoundID
    1349/     6A3 :                     
    1350/     6A3 :                     ; =============== S U B	R O U T	I N E =======================================
    1351/     6A3 :                     
    1352/     6A3 :                     
    1353/     6A3 :                     GetSFXChnPtrs:				; CODE XREF: PlaySoundID+139p
    1354/     6A3 :                     					; PlaySoundID+946p
    1355/     6A3 : CB 79               		bit	7, c
    1356/     6A5 : 20 05               		jr	nz, loc_6AC
    1357/     6A7 : 79                  		ld	a, c
    1358/     6A8 : D6 02               		sub	2
    1359/     6AA : 18 16               		jr	loc_6C2
    1360/     6AC :                     ; ---------------------------------------------------------------------------
    1361/     6AC :                     
    1362/     6AC :                     loc_6AC:				; CODE XREF: GetSFXChnPtrs+2j
    1363/     6AC : 3E 1F               		ld	a, 1Fh
    1364/     6AE : CD D1 0F            		call	SilencePSGChn
    1365/     6B1 : 3E FF               		ld	a, 0FFh
    1366/     6B3 : 32 11 7F            		ld	(7F11h), a
    1367/     6B6 : 79                  		ld	a, c
    1368/     6B7 : CB 3F               		srl	a
    1369/     6B9 : CB 3F               		srl	a
    1370/     6BB : CB 3F               		srl	a
    1371/     6BD : CB 3F               		srl	a
    1372/     6BF : CB 3F               		srl	a
    1373/     6C1 : 3C                  		inc	a
    1374/     6C2 :                     
    1375/     6C2 :                     loc_6C2:				; CODE XREF: GetSFXChnPtrs+7j
    1376/     6C2 : 32 32 1C            		ld	(byte_1C32), a
    1377/     6C5 : F5                  		push	af
    1378/     6C6 : 21 06 07            		ld	hl, SFXChnPtrs
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 24 - 5/8/2024 17:23:58


    1379/     6C9 : EF                  		rst	ReadPtrTable
    1380/     6CA : E5                  		push	hl
    1381/     6CB : DD E1               		pop	ix		; IX - SFX Track
    1382/     6CD : F1                  		pop	af
    1383/     6CE : F5                  		push	af
    1384/     6CF : 21 F6 06            		ld	hl, SpcSFXChnPtrs
    1385/     6D2 : EF                  		rst	ReadPtrTable
    1386/     6D3 : E5                  		push	hl
    1387/     6D4 : FD E1               		pop	iy		; IY - Special SFX Track
    1388/     6D6 : F1                  		pop	af
    1389/     6D7 : 21 16 07            		ld	hl, BGMChnPtrs
    1390/     6DA : EF                  		rst	ReadPtrTable	; HL - Music Track
    1391/     6DB : C9                  		ret
    1392/     6DC :                     ; End of function GetSFXChnPtrs
    1393/     6DC :                     
    1394/     6DC :                     
    1395/     6DC :                     ; =============== S U B	R O U T	I N E =======================================
    1396/     6DC :                     
    1397/     6DC :                     
    1398/     6DC :                     FinishFMTrkInit:			; CODE XREF: PlaySoundID+9Ep
    1399/     6DC :                     					; PlaySoundID+162p
    1400/     6DC : 08                  		ex	af, af'
    1401/     6DD : AF                  		xor	a
    1402/     6DE : 12                  		ld	(de), a
    1403/     6DF : 13                  		inc	de
    1404/     6E0 : 12                  		ld	(de), a
    1405/     6E1 : 13                  		inc	de
    1406/     6E2 : 08                  		ex	af, af'
    1407/     6E3 :                     ; End of function FinishFMTrkInit
    1408/     6E3 :                     
    1409/     6E3 :                     
    1410/     6E3 :                     ; =============== S U B	R O U T	I N E =======================================
    1411/     6E3 :                     
    1412/     6E3 :                     
    1413/     6E3 :                     FinishTrkInit:				; CODE XREF: PlaySoundID+D0p
    1414/     6E3 :                     					; DrumUpdate_Proc+42p ...
    1415/     6E3 : EB                  		ex	de, hl
    1416/     6E4 : 36 30               		ld	(hl), 30h	; set GoSub Stack Pointer (30 =	track size)
    1417/     6E6 : 23                  		inc	hl
    1418/     6E7 : 36 C0               		ld	(hl), 0C0h	; set Pan to L/R
    1419/     6E9 : 23                  		inc	hl
    1420/     6EA : 36 01               		ld	(hl), 1		; set Note Timeout to 1	(next frame)
    1421/     6EC : 06 24               		ld	b, 24h
    1422/     6EE :                     
    1423/     6EE :                     loc_6EE:				; CODE XREF: FinishTrkInit+Ej
    1424/     6EE : 23                  		inc	hl
    1425/     6EF : 36 00               		ld	(hl), 0		; fill rest of the track with 00s
    1426/     6F1 : 10 FB               		djnz	loc_6EE
    1427/     6F3 : 23                  		inc	hl
    1428/     6F4 : EB                  		ex	de, hl
    1429/     6F5 : C9                  		ret
    1430/     6F6 :                     ; End of function FinishTrkInit
    1431/     6F6 :                     
    1432/     6F6 :                     ; ---------------------------------------------------------------------------
    1433/     6F6 : 20 1E 20 1E 20 1E   SpcSFXChnPtrs:	dw 1E20h, 1E20h, 1E20h,	1E20h, 1E50h, 1E20h, 1E20h, 1E50h
              6FC : 20 1E 50 1E 20 1E 
              702 : 20 1E 50 1E       
    1434/     706 :                     					; DATA XREF: GetSFXChnPtrs+2Co
    1435/     706 : 80 1E B0 1E B0 1E   SFXChnPtrs:	dw 1E80h, 1EB0h, 1EB0h,	1EB0h, 1EE0h, 1F10h, 1F40h, 1F70h
              70C : B0 1E E0 1E 10 1F 
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 25 - 5/8/2024 17:23:58


              712 : 40 1F 70 1F       
    1436/     716 :                     					; DATA XREF: GetSFXChnPtrs+23o
    1437/     716 : 60 1D 00 1D 00 1D   BGMChnPtrs:	dw 1D60h, 1D00h, 1D00h,	1D00h, 1D30h, 1D90h, 1DC0h, 1DF0h
              71C : 00 1D 30 1D 90 1D 
              722 : C0 1D F0 1D       
    1438/     726 :                     					; DATA XREF: GetSFXChnPtrs+34o
    1439/     726 :                     
    1440/     726 :                     ; =============== S U B	R O U T	I N E =======================================
    1441/     726 :                     
    1442/     726 :                     
    1443/     726 :                     SetupBank:				; CODE XREF: RAM:0066p
    1444/     726 : 3A 01 1C            		ld	a, (byte_1C01)
    1445/     729 : 07                  		rlca
    1446/     72A : 32 00 60            		ld	(6000h), a
    1447/     72D : 06 08               		ld	b, 8
    1448/     72F : 3A 00 1C            		ld	a, (byte_1C00)
    1449/     732 :                     
    1450/     732 :                     loc_732:				; CODE XREF: SetupBank+10j
    1451/     732 : 32 00 60            		ld	(6000h), a
    1452/     735 : 0F                  		rrca
    1453/     736 : 10 FA               		djnz	loc_732
    1454/     738 : C9                  		ret
    1455/     739 :                     ; End of function SetupBank
    1456/     739 :                     
    1457/     739 :                     
    1458/     739 :                     ; =============== S U B	R O U T	I N E =======================================
    1459/     739 :                     
    1460/     739 :                     
    1461/     739 :                     DoPause:				; CODE XREF: RAM:0092p	UpdateAllp
    1462/     739 :                     
    1463/     739 :                     ; FUNCTION CHUNK AT 083E SIZE 0000002B BYTES
    1464/     739 :                     
    1465/     739 : 21 10 1C            		ld	hl, unk_1C10	; 1C10 = Pause Mode
    1466/     73C : 7E                  		ld	a, (hl)
    1467/     73D : B7                  		or	a
    1468/     73E : C8                  		ret	z		; 00 = not paused
    1469/     73F : FA 4A 07            		jp	m, UnpauseMusic	; 80-FF	- request Unpause
    1470/     742 : D1                  		pop	de
    1471/     743 : 3D                  		dec	a		; 01 - request Pause?
    1472/     744 : C0                  		ret	nz		; no, it's 02 - return
    1473/     745 : 36 02               		ld	(hl), 2		; it's 01, so set it to 02 (Pause active)
    1474/     747 : C3 3E 08            		jp	SilenceAll
    1475/     74A :                     ; ---------------------------------------------------------------------------
    1476/     74A :                     
    1477/     74A :                     UnpauseMusic:				; CODE XREF: DoPause+6j
    1478/     74A : AF                  		xor	a
    1479/     74B : 77                  		ld	(hl), a
    1480/     74C : 3A 0D 1C            		ld	a, (byte_1C0D)
    1481/     74F : B7                  		or	a
    1482/     750 : C2 01 08            		jp	nz, StopAllSound
    1483/     753 : DD 21 70 1C         		ld	ix, byte_1C70	; IX = Track of	FM 1
    1484/     757 : 06 06               		ld	b, 6
    1485/     759 :                     
    1486/     759 :                     loc_759:				; CODE XREF: DoPause+37j
    1487/     759 : 3A 11 1C            		ld	a, (byte_1C11)
    1488/     75C : B7                  		or	a
    1489/     75D : 20 06               		jr	nz, loc_765
    1490/     75F : DD CB 00 7E         		bit	7, (ix+0)
    1491/     763 : 28 06               		jr	z, loc_76B
    1492/     765 :                     
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 26 - 5/8/2024 17:23:58


    1493/     765 :                     loc_765:				; CODE XREF: DoPause+24j
    1494/     765 : DD 4E 0A            		ld	c, (ix+0Ah)
    1495/     768 : 3E B4               		ld	a, 0B4h
    1496/     76A : D7                  		rst	WriteFMMain
    1497/     76B :                     
    1498/     76B :                     loc_76B:				; CODE XREF: DoPause+2Aj
    1499/     76B : 11 30 00            		ld	de, 30h
    1500/     76E : DD 19               		add	ix, de
    1501/     770 : 10 E7               		djnz	loc_759
    1502/     772 : DD 21 20 1E         		ld	ix, byte_1E20	; IX = Special SFX Track 1
    1503/     776 : 06 08               		ld	b, 8		; 8 SFX	tracks (special	+ normal)
    1504/     778 :                     
    1505/     778 :                     loc_778:				; CODE XREF: DoPause+56j
    1506/     778 : DD CB 00 7E         		bit	7, (ix+0)
    1507/     77C : 28 0C               		jr	z, loc_78A
    1508/     77E : DD CB 01 7E         		bit	7, (ix+1)
    1509/     782 : 20 06               		jr	nz, loc_78A
    1510/     784 : DD 4E 0A            		ld	c, (ix+0Ah)
    1511/     787 : 3E B4               		ld	a, 0B4h
    1512/     789 : D7                  		rst	WriteFMMain
    1513/     78A :                     
    1514/     78A :                     loc_78A:				; CODE XREF: DoPause+43j DoPause+49j
    1515/     78A : 11 30 00            		ld	de, 30h
    1516/     78D : DD 19               		add	ix, de
    1517/     78F : 10 E7               		djnz	loc_778
    1518/     791 : C9                  		ret
    1519/     792 :                     ; End of function DoPause
    1520/     792 :                     
    1521/     792 :                     ; ---------------------------------------------------------------------------
    1522/     792 :                     
    1523/     792 :                     FadeOutMusic:				; DATA XREF: PlaySoundID:CmdPtrTableo
    1524/     792 : 3E 28               		ld	a, 28h		; Number of fading steps
    1525/     794 : 32 0D 1C            		ld	(byte_1C0D), a
    1526/     797 : 3E 06               		ld	a, 6		; Frames per Step
    1527/     799 : 32 0F 1C            		ld	(byte_1C0F), a
    1528/     79C : 32 0E 1C            		ld	(byte_1C0E), a
    1529/     79F :                     
    1530/     79F :                     ; =============== S U B	R O U T	I N E =======================================
    1531/     79F :                     
    1532/     79F :                     
    1533/     79F :                     StopDrumPSG:				; CODE XREF: DoFading+6p
    1534/     79F : AF                  		xor	a
    1535/     7A0 : 32 40 1C            		ld	(byte_1C40), a	; stop Drum Track
    1536/     7A3 : 32 60 1D            		ld	(byte_1D60), a	; stop FM6 Track
    1537/     7A6 : 32 F0 1D            		ld	(byte_1DF0), a	; stop PSG3 Track
    1538/     7A9 : 32 90 1D            		ld	(byte_1D90), a	; stop PSG1 Track
    1539/     7AC : 32 C0 1D            		ld	(byte_1DC0), a	; stop PSG2 Track
    1540/     7AF : CD 69 08            		call	SilencePSG
    1541/     7B2 : C3 E1 05            		jp	ClearSoundID
    1542/     7B5 :                     ; End of function StopDrumPSG
    1543/     7B5 :                     
    1544/     7B5 :                     
    1545/     7B5 :                     ; =============== S U B	R O U T	I N E =======================================
    1546/     7B5 :                     
    1547/     7B5 :                     
    1548/     7B5 :                     DoFading:				; CODE XREF: UpdateAll+6p
    1549/     7B5 : 21 0D 1C            		ld	hl, byte_1C0D
    1550/     7B8 : 7E                  		ld	a, (hl)		; load remaining Fading	Steps
    1551/     7B9 : B7                  		or	a
    1552/     7BA : C8                  		ret	z		; reached 0 - return
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 27 - 5/8/2024 17:23:58


    1553/     7BB : FC 9F 07            		call	m, StopDrumPSG	; 80+ -	mute Drum and PSG channels
    1554/     7BE : CB BE               		res	7, (hl)
    1555/     7C0 : 3A 0F 1C            		ld	a, (byte_1C0F)	; 1C0F - Timeout Counter
    1556/     7C3 : 3D                  		dec	a
    1557/     7C4 : 28 04               		jr	z, ApplyFading	; reached 0 - apply fading
    1558/     7C6 : 32 0F 1C            		ld	(byte_1C0F), a	; else just write back
    1559/     7C9 : C9                  		ret
    1560/     7CA :                     ; ---------------------------------------------------------------------------
    1561/     7CA :                     
    1562/     7CA :                     ApplyFading:				; CODE XREF: DoFading+Fj
    1563/     7CA : 3A 0E 1C            		ld	a, (byte_1C0E)
    1564/     7CD : 32 0F 1C            		ld	(byte_1C0F), a	; 1C0F (Counter) = 1C0E	(Initial)
    1565/     7D0 : 3A 0D 1C            		ld	a, (byte_1C0D)
    1566/     7D3 : 3D                  		dec	a
    1567/     7D4 : 32 0D 1C            		ld	(byte_1C0D), a
    1568/     7D7 : 28 28               		jr	z, StopAllSound
    1569/     7D9 : DD 21 40 1C         		ld	ix, byte_1C40	; 1C40 - Music Track RAM
    1570/     7DD : 06 06               		ld	b, 6
    1571/     7DF :                     
    1572/     7DF :                     loc_7DF:				; CODE XREF: DoFading+49j
    1573/     7DF : DD 34 06            		inc	(ix+6)
    1574/     7E2 : F2 EA 07            		jp	p, loc_7EA
    1575/     7E5 : DD 35 06            		dec	(ix+6)
    1576/     7E8 : 18 0F               		jr	loc_7F9
    1577/     7EA :                     ; ---------------------------------------------------------------------------
    1578/     7EA :                     
    1579/     7EA :                     loc_7EA:				; CODE XREF: DoFading+2Dj
    1580/     7EA : DD CB 00 7E         		bit	7, (ix+0)
    1581/     7EE : 28 09               		jr	z, loc_7F9
    1582/     7F0 : DD CB 00 56         		bit	2, (ix+0)
    1583/     7F4 : 20 03               		jr	nz, loc_7F9
    1584/     7F6 : CD A3 0D            		call	RefreshVolume
    1585/     7F9 :                     
    1586/     7F9 :                     loc_7F9:				; CODE XREF: DoFading+33j DoFading+39j ...
    1587/     7F9 : 11 30 00            		ld	de, 30h
    1588/     7FC : DD 19               		add	ix, de
    1589/     7FE : 10 DF               		djnz	loc_7DF
    1590/     800 : C9                  		ret
    1591/     801 :                     ; End of function DoFading
    1592/     801 :                     
    1593/     801 :                     
    1594/     801 :                     ; =============== S U B	R O U T	I N E =======================================
    1595/     801 :                     
    1596/     801 :                     
    1597/     801 :                     StopAllSound:				; CODE XREF: RAM:0063p	PlaySoundID+5j	...
    1598/     801 : 21 09 1C            		ld	hl, byte_1C09
    1599/     804 : 11 0A 1C            		ld	de, unk_1C0A
    1600/     807 : 01 96 03            		ld	bc, 396h
    1601/     80A : 36 00               		ld	(hl), 0
    1602/     80C : ED B0               		ldir			; clear	complete sound RAM (music + SFX)
    1603/     80E : DD 21 F6 05         		ld	ix, FMInitBytes
    1604/     812 : 06 06               		ld	b, 6		; 6 FM channels
    1605/     814 :                     
    1606/     814 :                     loc_814:				; CODE XREF: StopAllSound+1Fj
    1607/     814 : C5                  		push	bc
    1608/     815 : CD E2 08            		call	SilenceFMChn
    1609/     818 : CD 37 08            		call	DisableSSGEG
    1610/     81B : DD 23               		inc	ix
    1611/     81D : DD 23               		inc	ix
    1612/     81F : C1                  		pop	bc
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 28 - 5/8/2024 17:23:58


    1613/     820 : 10 F2               		djnz	loc_814
    1614/     822 : 06 07               		ld	b, 7		; dead instruction?
    1615/     824 : AF                  		xor	a
    1616/     825 : 32 0D 1C            		ld	(byte_1C0D), a	; clear	Fading Step Counter
    1617/     828 : CD 69 08            		call	SilencePSG
    1618/     82B :                     ; End of function StopAllSound
    1619/     82B :                     
    1620/     82B :                     
    1621/     82B :                     ; =============== S U B	R O U T	I N E =======================================
    1622/     82B :                     
    1623/     82B :                     
    1624/     82B :                     ResetSpcFM3Mode:			; CODE XREF: PlaySoundID+150p
    1625/     82B :                     					; DrumUpdate_Proc+66p
    1626/     82B : 3E 0F               		ld	a, 0Fh
    1627/     82D : 32 12 1C            		ld	(byte_1C12), a
    1628/     830 : 4F                  		ld	c, a
    1629/     831 : 3E 27               		ld	a, 27h
    1630/     833 : DF                  		rst	WriteFMI
    1631/     834 : C3 E1 05            		jp	ClearSoundID
    1632/     837 :                     ; End of function ResetSpcFM3Mode
    1633/     837 :                     
    1634/     837 :                     
    1635/     837 :                     ; =============== S U B	R O U T	I N E =======================================
    1636/     837 :                     
    1637/     837 :                     
    1638/     837 :                     DisableSSGEG:				; CODE XREF: PlaySoundID+18Ep
    1639/     837 :                     					; StopAllSound+17p
    1640/     837 : 3E 90               		ld	a, 90h
    1641/     839 : 0E 00               		ld	c, 0
    1642/     83B : C3 F6 08            		jp	SendAllFMOps
    1643/     83E :                     ; End of function DisableSSGEG
    1644/     83E :                     
    1645/     83E :                     ; ---------------------------------------------------------------------------
    1646/     83E :                     ; START	OF FUNCTION CHUNK FOR DoPause
    1647/     83E :                     
    1648/     83E :                     SilenceAll:				; CODE XREF: DoPause+Ej
    1649/     83E : CD 69 08            		call	SilencePSG
    1650/     841 : C5                  		push	bc
    1651/     842 : F5                  		push	af
    1652/     843 : 06 03               		ld	b, 3
    1653/     845 : 3E B4               		ld	a, 0B4h
    1654/     847 : 0E 00               		ld	c, 0
    1655/     849 :                     
    1656/     849 :                     loc_849:				; CODE XREF: DoPause+114j
    1657/     849 : F5                  		push	af
    1658/     84A : DF                  		rst	WriteFMI
    1659/     84B : F1                  		pop	af
    1660/     84C : 3C                  		inc	a
    1661/     84D : 10 FA               		djnz	loc_849
    1662/     84F : 06 03               		ld	b, 3
    1663/     851 : 3E B4               		ld	a, 0B4h
    1664/     853 :                     
    1665/     853 :                     loc_853:				; CODE XREF: DoPause+120j
    1666/     853 : F5                  		push	af
    1667/     854 : CD C0 04            		call	WriteFMII
    1668/     857 : F1                  		pop	af
    1669/     858 : 3C                  		inc	a
    1670/     859 : 10 F8               		djnz	loc_853
    1671/     85B : 0E 00               		ld	c, 0
    1672/     85D : 06 07               		ld	b, 7
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 29 - 5/8/2024 17:23:58


    1673/     85F : 3E 28               		ld	a, 28h
    1674/     861 :                     
    1675/     861 :                     loc_861:				; CODE XREF: DoPause+12Cj
    1676/     861 : F5                  		push	af
    1677/     862 : DF                  		rst	WriteFMI
    1678/     863 : 0C                  		inc	c
    1679/     864 : F1                  		pop	af
    1680/     865 : 10 FA               		djnz	loc_861
    1681/     867 : F1                  		pop	af
    1682/     868 : C1                  		pop	bc
    1683/     869 :                     ; END OF FUNCTION CHUNK	FOR DoPause
    1684/     869 :                     
    1685/     869 :                     ; =============== S U B	R O U T	I N E =======================================
    1686/     869 :                     
    1687/     869 :                     
    1688/     869 :                     SilencePSG:				; CODE XREF: StopDrumPSG+10p
    1689/     869 :                     					; StopAllSound+27p ...
    1690/     869 : E5                  		push	hl
    1691/     86A : C5                  		push	bc
    1692/     86B : 21 7C 08            		ld	hl, PSGMuteVals
    1693/     86E : 06 04               		ld	b, 4
    1694/     870 :                     
    1695/     870 :                     loc_870:				; CODE XREF: SilencePSG+Cj
    1696/     870 : 7E                  		ld	a, (hl)
    1697/     871 : 32 11 7F            		ld	(7F11h), a
    1698/     874 : 23                  		inc	hl
    1699/     875 : 10 F9               		djnz	loc_870
    1700/     877 : C1                  		pop	bc
    1701/     878 : E1                  		pop	hl
    1702/     879 : C3 E1 05            		jp	ClearSoundID
    1703/     87C :                     ; End of function SilencePSG
    1704/     87C :                     
    1705/     87C :                     ; ---------------------------------------------------------------------------
    1706/     87C : 9F BF DF FF         PSGMuteVals:	db 9Fh,	0BFh, 0DFh, 0FFh ; DATA	XREF: SilencePSG+2o
    1707/     880 :                     
    1708/     880 :                     ; =============== S U B	R O U T	I N E =======================================
    1709/     880 :                     
    1710/     880 :                     
    1711/     880 :                     DoTempo:				; CODE XREF: UpdateAll+3p
    1712/     880 : 21 13 1C            		ld	hl, byte_1C13	; 1C13 = Tempo Timeout
    1713/     883 : 7E                  		ld	a, (hl)
    1714/     884 : B7                  		or	a
    1715/     885 : C8                  		ret	z		; Tempo	00 = never delayed
    1716/     886 : 35                  		dec	(hl)		; subtract 1
    1717/     887 : C0                  		ret	nz		; reached 00 - continue	and delay all tracks
    1718/     888 : 3A 14 1C            		ld	a, (byte_1C14)	; load initial Tempo (1C14)
    1719/     88B : 77                  		ld	(hl), a
    1720/     88C : 21 4B 1C            		ld	hl, byte_1C4B	; 1C40 (DAC Track) + 0B	(Note Timeout)
    1721/     88F : 11 30 00            		ld	de, 30h
    1722/     892 : 06 0A               		ld	b, 0Ah		; 10 Music Tracks
    1723/     894 :                     
    1724/     894 :                     loc_894:				; CODE XREF: DoTempo+16j
    1725/     894 : 34                  		inc	(hl)		; delay	by 1 frame
    1726/     895 : 19                  		add	hl, de		; next track
    1727/     896 : 10 FC               		djnz	loc_894
    1728/     898 : C9                  		ret
    1729/     899 :                     ; End of function DoTempo
    1730/     899 :                     
    1731/     899 :                     
    1732/     899 :                     ; =============== S U B	R O U T	I N E =======================================
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 30 - 5/8/2024 17:23:58


    1733/     899 :                     
    1734/     899 :                     
    1735/     899 :                     DoSoundQueue:				; CODE XREF: RAM:0070p
    1736/     899 :                     					; RAM:TimerAB_Updatep
    1737/     899 : ED 5F               		ld	a, r
    1738/     89B : 32 17 1C            		ld	(byte_1C17), a
    1739/     89E : 11 0A 1C            		ld	de, unk_1C0A
    1740/     8A1 : CD AD 08            		call	DoOneSndQueue
    1741/     8A4 : 11 0B 1C            		ld	de, unk_1C0B
    1742/     8A7 : CD AD 08            		call	DoOneSndQueue
    1743/     8AA : 11 0C 1C            		ld	de, unk_1C0C
    1744/     8AD :                     ; End of function DoSoundQueue
    1745/     8AD :                     
    1746/     8AD :                     
    1747/     8AD :                     ; =============== S U B	R O U T	I N E =======================================
    1748/     8AD :                     
    1749/     8AD :                     
    1750/     8AD :                     DoOneSndQueue:				; CODE XREF: DoSoundQueue+8p
    1751/     8AD :                     					; DoSoundQueue+Ep
    1752/     8AD : 1A                  		ld	a, (de)
    1753/     8AE : CB 7F               		bit	7, a
    1754/     8B0 : C8                  		ret	z
    1755/     8B1 : D6 81               		sub	81h
    1756/     8B3 : 2A 02 1C            		ld	hl, (word_1C02)
    1757/     8B6 : 0E 00               		ld	c, 0
    1758/     8B8 : E7                  		rst	GetListOfs	; get List 0 (Sound Priorities)
    1759/     8B9 : 4F                  		ld	c, a
    1760/     8BA : 06 00               		ld	b, 0
    1761/     8BC : 09                  		add	hl, bc
    1762/     8BD : CB 7E               		bit	7, (hl)
    1763/     8BF : 28 0E               		jr	z, loc_8CF
    1764/     8C1 : 1A                  		ld	a, (de)
    1765/     8C2 : 32 09 1C            		ld	(byte_1C09), a
    1766/     8C5 : AF                  		xor	a
    1767/     8C6 : 21 0A 1C            		ld	hl, unk_1C0A
    1768/     8C9 : 77                  		ld	(hl), a
    1769/     8CA : 23                  		inc	hl
    1770/     8CB : 77                  		ld	(hl), a
    1771/     8CC : 23                  		inc	hl
    1772/     8CD : 77                  		ld	(hl), a
    1773/     8CE : C9                  		ret
    1774/     8CF :                     ; ---------------------------------------------------------------------------
    1775/     8CF :                     
    1776/     8CF :                     loc_8CF:				; CODE XREF: DoOneSndQueue+12j
    1777/     8CF : 3A 18 1C            		ld	a, (byte_1C18)
    1778/     8D2 : BE                  		cp	(hl)
    1779/     8D3 : 28 02               		jr	z, loc_8D7
    1780/     8D5 : 30 08               		jr	nc, loc_8DF
    1781/     8D7 :                     
    1782/     8D7 :                     loc_8D7:				; CODE XREF: DoOneSndQueue+26j
    1783/     8D7 : 1A                  		ld	a, (de)
    1784/     8D8 : 32 09 1C            		ld	(byte_1C09), a
    1785/     8DB : 7E                  		ld	a, (hl)
    1786/     8DC : 32 18 1C            		ld	(byte_1C18), a
    1787/     8DF :                     
    1788/     8DF :                     loc_8DF:				; CODE XREF: DoOneSndQueue+28j
    1789/     8DF : AF                  		xor	a
    1790/     8E0 : 12                  		ld	(de), a
    1791/     8E1 : C9                  		ret
    1792/     8E2 :                     ; End of function DoOneSndQueue
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 31 - 5/8/2024 17:23:58


    1793/     8E2 :                     
    1794/     8E2 :                     
    1795/     8E2 :                     ; =============== S U B	R O U T	I N E =======================================
    1796/     8E2 :                     
    1797/     8E2 :                     
    1798/     8E2 :                     SilenceFMChn:				; CODE XREF: StopAllSound+14p
    1799/     8E2 :                     					; RAM:cfE3_SilenceTrkp
    1800/     8E2 : CD F2 08            		call	SetMaxRelRate
    1801/     8E5 : 3E 40               		ld	a, 40h
    1802/     8E7 : 0E 7F               		ld	c, 7Fh
    1803/     8E9 : CD F6 08            		call	SendAllFMOps
    1804/     8EC : DD 4E 01            		ld	c, (ix+1)
    1805/     8EF : C3 30 04            		jp	FMNoteOff
    1806/     8F2 :                     ; End of function SilenceFMChn
    1807/     8F2 :                     
    1808/     8F2 :                     
    1809/     8F2 :                     ; =============== S U B	R O U T	I N E =======================================
    1810/     8F2 :                     
    1811/     8F2 :                     
    1812/     8F2 :                     SetMaxRelRate:				; CODE XREF: SilenceFMChnp RAM:0D53p
    1813/     8F2 : 3E 80               		ld	a, 80h
    1814/     8F4 : 0E FF               		ld	c, 0FFh
    1815/     8F6 :                     ; End of function SetMaxRelRate
    1816/     8F6 :                     
    1817/     8F6 :                     
    1818/     8F6 :                     ; =============== S U B	R O U T	I N E =======================================
    1819/     8F6 :                     
    1820/     8F6 :                     
    1821/     8F6 :                     SendAllFMOps:				; CODE XREF: DisableSSGEG+4j
    1822/     8F6 :                     					; SilenceFMChn+7p
    1823/     8F6 : 06 04               		ld	b, 4
    1824/     8F8 :                     
    1825/     8F8 :                     loc_8F8:				; CODE XREF: SendAllFMOps+7j
    1826/     8F8 : F5                  		push	af
    1827/     8F9 : D7                  		rst	WriteFMMain
    1828/     8FA : F1                  		pop	af
    1829/     8FB : C6 04               		add	a, 4
    1830/     8FD : 10 F9               		djnz	loc_8F8
    1831/     8FF : C9                  		ret
    1832/     900 :                     ; End of function SendAllFMOps
    1833/     900 :                     
    1834/     900 :                     ; ---------------------------------------------------------------------------
    1835/     900 : 56 03 26 03 F9 02   PSGFreqs:	dw  356h, 326h,	2F9h, 2CEh, 2A5h, 280h,	25Ch, 23Ah, 21Ah, 1FBh,	1DFh, 1C4h
              906 : CE 02 A5 02 80 02 
              90C : 5C 02 3A 02 1A 02 
              912 : FB 01 DF 01 C4 01 
    1836/     918 :                     					; DATA XREF: TrkUpdate_Proc+35o
    1837/     918 : AB 01 93 01 7D 01   		dw  1ABh, 193h,	17Dh, 167h, 153h, 140h,	12Eh, 11Dh, 10Dh, 0FEh,	0EFh, 0E2h
              91E : 67 01 53 01 40 01 
              924 : 2E 01 1D 01 0D 01 
              92A : FE 00 EF 00 E2 00 
    1838/     930 : D6 00 C9 00 BE 00   		dw  0D6h, 0C9h,	0BEh, 0B4h, 0A9h, 0A0h,	 97h,  8Fh,  87h,  7Fh,	 78h,  71h
              936 : B4 00 A9 00 A0 00 
              93C : 97 00 8F 00 87 00 
              942 : 7F 00 78 00 71 00 
    1839/     948 : 6B 00 65 00 5F 00   		dw   6Bh,  65h,	 5Fh,  5Ah,  55h,  50h,	 4Bh,  47h,  43h,  40h,	 3Ch,  39h
              94E : 5A 00 55 00 50 00 
              954 : 4B 00 47 00 43 00 
              95A : 40 00 3C 00 39 00 
    1840/     960 : 36 00 33 00 30 00   		dw   36h,  33h,	 30h,  2Dh,  2Bh,  28h,	 26h,  24h,  22h,  20h,	 1Fh,  1Dh
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 32 - 5/8/2024 17:23:58


              966 : 2D 00 2B 00 28 00 
              96C : 26 00 24 00 22 00 
              972 : 20 00 1F 00 1D 00 
    1841/     978 : 1B 00 1A 00 18 00   		dw   1Bh,  1Ah,	 18h,  17h,  16h,  15h,	 13h,  12h,  11h
              97E : 17 00 16 00 15 00 
              984 : 13 00 12 00 11 00 
    1842/     98A : 84 02 AB 02 D3 02   FMFreqs:	dw  284h, 2ABh,	2D3h, 2FEh, 32Dh, 35Ch,	38Fh, 3C5h, 3FFh, 43Ch,	47Ch, 4C0h
              990 : FE 02 2D 03 5C 03 
              996 : 8F 03 C5 03 FF 03 
              99C : 3C 04 7C 04 C0 04 
    1843/     9A2 :                     					; DATA XREF: TrkUpdate_Proc+52o
    1844/     9A2 :                     
    1845/     9A2 :                     ; =============== S U B	R O U T	I N E =======================================
    1846/     9A2 :                     
    1847/     9A2 :                     
    1848/     9A2 :                     DrumUpdateTrack:			; CODE XREF: UpdateAll+1Fp
    1849/     9A2 : CD 04 03            		call	TrackTimeout
    1850/     9A5 : CC A9 09            		call	z, DrumUpdate_Proc
    1851/     9A8 : C9                  		ret
    1852/     9A9 :                     ; End of function DrumUpdateTrack
    1853/     9A9 :                     
    1854/     9A9 :                     
    1855/     9A9 :                     ; =============== S U B	R O U T	I N E =======================================
    1856/     9A9 :                     
    1857/     9A9 :                     
    1858/     9A9 :                     DrumUpdate_Proc:			; CODE XREF: DrumUpdateTrack+3p
    1859/     9A9 : DD 5E 03            		ld	e, (ix+3)
    1860/     9AC : DD 56 04            		ld	d, (ix+4)
    1861/     9AF :                     
    1862/     9AF :                     loc_9AF:				; CODE XREF: DrumUpdate_Proc+B4j
    1863/     9AF : 1A                  		ld	a, (de)
    1864/     9B0 : 13                  		inc	de
    1865/     9B1 : FE E0               		cp	0E0h
    1866/     9B3 : D2 56 0A            		jp	nc, cfHandler_Drum
    1867/     9B6 : B7                  		or	a
    1868/     9B7 : FA BE 09            		jp	m, loc_9BE
    1869/     9BA : 1B                  		dec	de
    1870/     9BB : DD 7E 0D            		ld	a, (ix+0Dh)
    1871/     9BE :                     
    1872/     9BE :                     loc_9BE:				; CODE XREF: DrumUpdate_Proc+Ej
    1873/     9BE : DD 77 0D            		ld	(ix+0Dh), a
    1874/     9C1 : FE 80               		cp	80h
    1875/     9C3 : CA 40 0A            		jp	z, loc_A40
    1876/     9C6 : D5                  		push	de
    1877/     9C7 : 21 60 1D            		ld	hl, byte_1D60	; BGM Channel FM6 (actually FM3	here)
    1878/     9CA : CB 56               		bit	2, (hl)
    1879/     9CC : 20 44               		jr	nz, loc_A12
    1880/     9CE : E6 0F               		and	0Fh
    1881/     9D0 : 28 40               		jr	z, loc_A12
    1882/     9D2 : 08                  		ex	af, af'
    1883/     9D3 : CD 24 04            		call	DoNoteOff
    1884/     9D6 : 08                  		ex	af, af'
    1885/     9D7 : 11 50 0A            		ld	de, FMDrumInit
    1886/     9DA : EB                  		ex	de, hl
    1887/     9DB : ED A0               		ldi
    1888/     9DD : ED A0               		ldi
    1889/     9DF : ED A0               		ldi
    1890/     9E1 : 3D                  		dec	a
    1891/     9E2 : 21 7A 0A            		ld	hl, FMDrumTrkList
    1892/     9E5 : EF                  		rst	ReadPtrTable
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 33 - 5/8/2024 17:23:58


    1893/     9E6 : 01 06 00            		ld	bc, 6
    1894/     9E9 : ED B0               		ldir
    1895/     9EB : CD E3 06            		call	FinishTrkInit
    1896/     9EE : 21 65 1D            		ld	hl, byte_1D65
    1897/     9F1 : DD 7E 05            		ld	a, (ix+5)
    1898/     9F4 : 86                  		add	a, (hl)
    1899/     9F5 : 77                  		ld	(hl), a
    1900/     9F6 : 3A 68 1D            		ld	a, (byte_1D68)
    1901/     9F9 : 21 8E 0A            		ld	hl, FMDrumInsPtrs
    1902/     9FC : EF                  		rst	ReadPtrTable
    1903/     9FD : 3A 66 1D            		ld	a, (byte_1D66)
    1904/     A00 : DD 5E 06            		ld	e, (ix+6)
    1905/     A03 : D5                  		push	de
    1906/     A04 : 83                  		add	a, e
    1907/     A05 : DD 77 06            		ld	(ix+6),	a
    1908/     A08 : CD E6 04            		call	SendFMIns
    1909/     A0B : D1                  		pop	de
    1910/     A0C : DD 73 06            		ld	(ix+6),	e
    1911/     A0F : CD 2B 08            		call	ResetSpcFM3Mode
    1912/     A12 :                     
    1913/     A12 :                     loc_A12:				; CODE XREF: DrumUpdate_Proc+23j
    1914/     A12 :                     					; DrumUpdate_Proc+27j
    1915/     A12 : 21 F0 1D            		ld	hl, byte_1DF0
    1916/     A15 : CB 56               		bit	2, (hl)
    1917/     A17 : 20 26               		jr	nz, loc_A3F
    1918/     A19 : DD 7E 0D            		ld	a, (ix+0Dh)
    1919/     A1C : E6 70               		and	70h
    1920/     A1E : 28 1F               		jr	z, loc_A3F
    1921/     A20 : 11 53 0A            		ld	de, PSGDrumInit
    1922/     A23 : EB                  		ex	de, hl
    1923/     A24 : ED A0               		ldi
    1924/     A26 : ED A0               		ldi
    1925/     A28 : ED A0               		ldi
    1926/     A2A : CB 3F               		srl	a
    1927/     A2C : CB 3F               		srl	a
    1928/     A2E : CB 3F               		srl	a
    1929/     A30 : CB 3F               		srl	a
    1930/     A32 : 3D                  		dec	a
    1931/     A33 : 21 60 0A            		ld	hl, PSGDrumTrkList
    1932/     A36 : EF                  		rst	ReadPtrTable
    1933/     A37 : 01 06 00            		ld	bc, 6
    1934/     A3A : ED B0               		ldir
    1935/     A3C : CD E3 06            		call	FinishTrkInit
    1936/     A3F :                     
    1937/     A3F :                     loc_A3F:				; CODE XREF: DrumUpdate_Proc+6Ej
    1938/     A3F :                     					; DrumUpdate_Proc+75j
    1939/     A3F : D1                  		pop	de
    1940/     A40 :                     
    1941/     A40 :                     loc_A40:				; CODE XREF: DrumUpdate_Proc+1Aj
    1942/     A40 : 1A                  		ld	a, (de)
    1943/     A41 : 13                  		inc	de
    1944/     A42 : B7                  		or	a
    1945/     A43 : F2 76 02            		jp	p, SetDuration
    1946/     A46 : 1B                  		dec	de
    1947/     A47 : DD 7E 0C            		ld	a, (ix+0Ch)
    1948/     A4A : DD 77 0B            		ld	(ix+0Bh), a
    1949/     A4D : C3 7C 02            		jp	loc_27C
    1950/     A50 :                     ; ---------------------------------------------------------------------------
    1951/     A50 :                     FMDrumInit:				; DATA XREF: DrumUpdate_Proc+2Eo
    1952/     A50 : 80 02 01            		db  80h,   2,	1
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 34 - 5/8/2024 17:23:58


    1953/     A53 :                     PSGDrumInit:				; DATA XREF: DrumUpdate_Proc+77o
    1954/     A53 : 80 C0 01            		db  80h,0C0h,	1
    1955/     A56 :                     ; ---------------------------------------------------------------------------
    1956/     A56 :                     
    1957/     A56 :                     cfHandler_Drum:				; CODE XREF: DrumUpdate_Proc+Aj
    1958/     A56 : 21 5C 0A            		ld	hl, cfReturn_Drum
    1959/     A59 : C3 9B 0B            		jp	loc_B9B
    1960/     A5C :                     ; ---------------------------------------------------------------------------
    1961/     A5C :                     
    1962/     A5C :                     cfReturn_Drum:				; DATA XREF: DrumUpdate_Proc:cfHandler_Drumo
    1963/     A5C : 13                  		inc	de
    1964/     A5D : C3 AF 09            		jp	loc_9AF
    1965/     A60 :                     ; ---------------------------------------------------------------------------
    1966/     A60 :                     PSGDrumTrkList:				; DATA XREF: DrumUpdate_Proc+8Ao
    1967/     A60 : 64 0A 6F 0A         		dw PSGDrum90, PSGDrumA0
    1968/     A64 :                     PSGDrum90:				; DATA XREF: DrumUpdate_Proc:PSGDrumTrkListo
    1969/     A64 : (MACRO)              		DrumHeader byte_A6A, 0, 4, 0, 1
    1969/     A64 : 6A 0A                               dw byte_A6A                  ; offset
    1969/     A66 : 00                                  db 0
    1969/     A67 : 04                                  db 4
    1969/     A68 : 00                                  db 0
    1969/     A69 : 01                                  db 1
    1970/     A6A : F3 E7 C2 08 F2      byte_A6A:	db 0F3h,0E7h,0C2h, 08h,0F2h ; DATA XREF: DrumUpdate_Proc:PSGDrum90o
    1971/     A6F :                     PSGDrumA0:				; DATA XREF: DrumUpdate_Proc:PSGDrumTrkListo
    1972/     A6F : (MACRO)              		DrumHeader byte_A75, 0, 6, 0, 2
    1972/     A6F : 75 0A                               dw byte_A75                  ; offset
    1972/     A71 : 00                                  db 0
    1972/     A72 : 06                                  db 6
    1972/     A73 : 00                                  db 0
    1972/     A74 : 02                                  db 2
    1973/     A75 : F3 E7 C5 08 F2      byte_A75:	db 0F3h,0E7h,0C5h, 08h,0F2h ; DATA XREF: DrumUpdate_Proc:PSGDrumA0o
    1974/     A7A :                     FMDrumTrkList:				; DATA XREF: DrumUpdate_Proc+39o
    1975/     A7A : 9A 0A BC 0A C7 0A   		dw FMDrum81, FMDrum82, FMDrum83, FMDrum84, FMDrum85, FMDrum86
              A80 : D0 0A E4 0A 06 0B 
    1976/     A86 : DB 0A 28 0B 4A 0B   		dw FMDrum87, FMDrum88, FMDrum89, FMDrum8A
              A8C : 71 0B             
    1977/     A8E :                     FMDrumInsPtrs:				; DATA XREF: DrumUpdate_Proc+50o
    1978/     A8E : A3 0A ED 0A 0F 0B   		dw FMDrumIns00,	FMDrumIns01, FMDrumIns02, FMDrumIns03
              A94 : 31 0B             
    1979/     A96 : 58 0B 7F 0B         		dw FMDrumIns04,	FMDrumIns05
    1980/     A9A :                     FMDrum81:				; DATA XREF: DrumUpdate_Proc:FMDrumTrkListo
    1981/     A9A : (MACRO)              		DrumHeader byte_AA0, 0, 0Eh, 81h, 0
    1981/     A9A : A0 0A                               dw byte_AA0                  ; offset
    1981/     A9C : 00                                  db 0
    1981/     A9D : 0E                                  db 0Eh
    1981/     A9E : 81                                  db 81h
    1981/     A9F : 00                                  db 0
    1982/     AA0 : B9 10 F2            byte_AA0:	db 0B9h, 10h,0F2h	; DATA XREF: DrumUpdate_Proc:FMDrum81o
    1983/     AA3 :                     FMDrumIns00:				; DATA XREF: DrumUpdate_Proc:FMDrumInsPtrso
    1984/     AA3 : 3E 60 30 30 30 19   		db  3Eh, 60h, 30h, 30h,	30h, 19h, 1Fh, 1Fh, 1Fh, 15h, 11h
              AA9 : 1F 1F 1F 15 11    
    1985/     AAE : 11 0C 10 0A 06 09   		db  11h, 0Ch, 10h, 0Ah,	06h, 09h, 4Fh, 5Fh,0AFh, 8Fh, 00h
              AB4 : 4F 5F AF 8F 00    
    1986/     AB9 : 82 83 80            		db  82h, 83h, 80h
    1987/     ABC :                     FMDrum82:				; DATA XREF: DrumUpdate_Proc:FMDrumTrkListo
    1988/     ABC : (MACRO)              		DrumHeader byte_AC2, 0, 0Ch, 81h, 0
    1988/     ABC : C2 0A                               dw byte_AC2                  ; offset
    1988/     ABE : 00                                  db 0
    1988/     ABF : 0C                                  db 0Ch
    1988/     AC0 : 81                                  db 81h
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 35 - 5/8/2024 17:23:58


    1988/     AC1 : 00                                  db 0
    1989/     AC2 : E0 80 B6 0A F2      byte_AC2:	db 0E0h, 80h,0B6h, 0Ah,0F2h ; DATA XREF: DrumUpdate_Proc:FMDrum82o
    1990/     AC7 :                     FMDrum83:				; DATA XREF: DrumUpdate_Proc:FMDrumTrkListo
    1991/     AC7 : (MACRO)              		DrumHeader byte_ACD, 0, 0Ch, 81h, 0
    1991/     AC7 : CD 0A                               dw byte_ACD                  ; offset
    1991/     AC9 : 00                                  db 0
    1991/     ACA : 0C                                  db 0Ch
    1991/     ACB : 81                                  db 81h
    1991/     ACC : 00                                  db 0
    1992/     ACD : B3 0A F2            byte_ACD:	db 0B3h, 0Ah,0F2h	; DATA XREF: DrumUpdate_Proc:FMDrum83o
    1993/     AD0 :                     FMDrum84:				; DATA XREF: DrumUpdate_Proc:FMDrumTrkListo
    1994/     AD0 : (MACRO)              		DrumHeader byte_AD6, 0, 0Ch, 81h, 0
    1994/     AD0 : D6 0A                               dw byte_AD6                  ; offset
    1994/     AD2 : 00                                  db 0
    1994/     AD3 : 0C                                  db 0Ch
    1994/     AD4 : 81                                  db 81h
    1994/     AD5 : 00                                  db 0
    1995/     AD6 : E0 40 B0 0A F2      byte_AD6:	db 0E0h, 40h,0B0h, 0Ah,0F2h ; DATA XREF: DrumUpdate_Proc:FMDrum84o
    1996/     ADB :                     ; Sega Channel BIOS (J):
    1997/     ADB :                     ;byte_AD6:	db 0E0h, 40h,0ADh, 0Ah,0F2h
    1998/     ADB :                     FMDrum87:				; DATA XREF: DrumUpdate_Proc:FMDrumTrkListo
    1999/     ADB : (MACRO)              		DrumHeader byte_AE1, 0, 0Ch, 81h, 0
    1999/     ADB : E1 0A                               dw byte_AE1                  ; offset
    1999/     ADD : 00                                  db 0
    1999/     ADE : 0C                                  db 0Ch
    1999/     ADF : 81                                  db 81h
    1999/     AE0 : 00                                  db 0
    2000/     AE1 : B2 0A F2            byte_AE1:	db 0B2h, 0Ah,0F2h	; DATA XREF: DrumUpdate_Proc:FMDrum87o
    2001/     AE4 :                     FMDrum85:				; DATA XREF: DrumUpdate_Proc:FMDrumTrkListo
    2002/     AE4 : (MACRO)              		DrumHeader byte_AEA, 0, 3, 81h, 1
    2002/     AE4 : EA 0A                               dw byte_AEA                  ; offset
    2002/     AE6 : 00                                  db 0
    2002/     AE7 : 03                                  db 3
    2002/     AE8 : 81                                  db 81h
    2002/     AE9 : 01                                  db 1
    2003/     AEA : 89 08 F2            byte_AEA:	db  89h, 08h,0F2h	; DATA XREF: DrumUpdate_Proc:FMDrum85o
    2004/     AED :                     FMDrumIns01:				; DATA XREF: DrumUpdate_Proc:FMDrumInsPtrso
    2005/     AED : 72 33 30 32 31 1E   		db  72h, 33h, 30h, 32h,	31h, 1Eh, 1Bh, 1Ch, 15h, 16h, 12h
              AF3 : 1B 1C 15 16 12    
    2006/     AF8 : 17 10 10 18 1E 14   		db  17h, 10h, 10h, 18h,	1Eh, 14h, 4Fh, 5Fh, 4Fh, 4Fh, 08h
              AFE : 4F 5F 4F 4F 08    
    2007/     B03 : 00 10 80            		db  00h, 10h, 80h
    2008/     B06 :                     ; Sega Channel BIOS (J):
    2009/     B06 :                     ;byte_AEA:	db  89h, 05h,0F2h
    2010/     B06 :                     ;FMDrumIns01:
    2011/     B06 :                     ;		db  72h, 31h, 33h, 30h,	31h, 1Eh, 1Bh, 1Ch, 15h, 16h, 12h
    2012/     B06 :                     ;		db  17h, 10h, 10h, 18h,	1Eh, 14h, 4Fh, 5Fh, 4Fh, 4Fh, 08h
    2013/     B06 :                     ;		db  00h, 10h, 80h
    2014/     B06 :                     FMDrum86:				; DATA XREF: DrumUpdate_Proc:FMDrumTrkListo
    2015/     B06 : (MACRO)              		DrumHeader byte_B0C, 0, 6, 81h, 2
    2015/     B06 : 0C 0B                               dw byte_B0C                  ; offset
    2015/     B08 : 00                                  db 0
    2015/     B09 : 06                                  db 6
    2015/     B0A : 81                                  db 81h
    2015/     B0B : 02                                  db 2
    2016/     B0C : B0 16 F2            byte_B0C:	db 0B0h, 16h,0F2h	; DATA XREF: DrumUpdate_Proc:FMDrum86o
    2017/     B0F :                     FMDrumIns02:				; DATA XREF: DrumUpdate_Proc:FMDrumInsPtrso
    2018/     B0F : 72 9E 5B 42 22 96   		db  72h, 9Eh, 5Bh, 42h,	22h, 96h, 96h, 9Eh, 96h, 16h, 18h
              B15 : 96 9E 96 16 18    
    2019/     B1A : 16 18 10 17 11 18   		db  16h, 18h, 10h, 17h,	11h, 18h, 4Fh, 5Fh, 4Fh, 4Fh, 00h
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 36 - 5/8/2024 17:23:58


              B20 : 4F 5F 4F 4F 00    
    2020/     B25 : 00 10 80            		db  00h, 10h, 80h
    2021/     B28 :                     FMDrum88:				; DATA XREF: DrumUpdate_Proc:FMDrumTrkListo
    2022/     B28 : (MACRO)              		DrumHeader byte_B2E, 0, 0Eh, 0, 3
    2022/     B28 : 2E 0B                               dw byte_B2E                  ; offset
    2022/     B2A : 00                                  db 0
    2022/     B2B : 0E                                  db 0Eh
    2022/     B2C : 00                                  db 0
    2022/     B2D : 03                                  db 3
    2023/     B2E :                     ; Sega Channel BIOS (J):
    2024/     B2E :                     ;		DrumHeader byte_B2E, 0, 8, 0, 3
    2025/     B2E : B4 10 F2            byte_B2E:	db 0B4h, 10h,0F2h	; DATA XREF: DrumUpdate_Proc:FMDrum88o
    2026/     B31 :                     FMDrumIns03:				; DATA XREF: DrumUpdate_Proc:FMDrumInsPtrso
    2027/     B31 : 3C 0F 00 00 00 1F   		db  3Ch, 0Fh, 00h, 00h,	00h, 1Fh, 1Ah, 18h, 1Ch, 17h, 11h
              B37 : 1A 18 1C 17 11    
    2028/     B3C : 1A 0E 00 0F 14 10   		db  1Ah, 0Eh, 00h, 0Fh,	14h, 10h, 1Fh,0ECh,0FFh,0FFh, 07h
              B42 : 1F EC FF FF 07    
    2029/     B47 : 80 16 80            		db  80h, 16h, 80h
    2030/     B4A :                     FMDrum89:				; DATA XREF: DrumUpdate_Proc:FMDrumTrkListo
    2031/     B4A : (MACRO)              		DrumHeader byte_B50, 0F7h, 0Ah, 0, 4
    2031/     B4A : 50 0B                               dw byte_B50                  ; offset
    2031/     B4C : F7                                  db 0F7h
    2031/     B4D : 0A                                  db 0Ah
    2031/     B4E : 00                                  db 0
    2031/     B4F : 04                                  db 4
    2032/     B50 : FE 03 00 00 00 95   byte_B50:	db 0FEh, 03h, 00h, 00h,	00h, 95h, 20h,0F2h
              B56 : 20 F2             
    2033/     B58 :                     					; DATA XREF: DrumUpdate_Proc:FMDrum89o
    2034/     B58 :                     FMDrumIns04:				; DATA XREF: DrumUpdate_Proc:FMDrumInsPtrso
    2035/     B58 : 3C 0A 50 70 00 1F   		db  3Ch, 0Ah, 50h, 70h,	00h, 1Fh, 17h, 19h, 1Dh, 1Dh, 15h
              B5E : 17 19 1D 1D 15    
    2036/     B63 : 1A 17 06 18 07 19   		db  1Ah, 17h, 06h, 18h,	07h, 19h, 0Fh, 5Fh, 6Fh, 1Fh, 0Ch
              B69 : 0F 5F 6F 1F 0C    
    2037/     B6E : 95 00 8E            		db  95h, 00h, 8Eh
    2038/     B71 :                     FMDrum8A:				; DATA XREF: DrumUpdate_Proc:FMDrumTrkListo
    2039/     B71 : (MACRO)              		DrumHeader byte_B77, 0, 7, 0, 7
    2039/     B71 : 77 0B                               dw byte_B77                  ; offset
    2039/     B73 : 00                                  db 0
    2039/     B74 : 07                                  db 7
    2039/     B75 : 00                                  db 0
    2039/     B76 : 07                                  db 7
    2040/     B77 : FE 00 03 00 03 D1   byte_B77:	db 0FEh, 00h, 03h, 00h,	03h,0D1h, 08h,0F2h
              B7D : 08 F2             
    2041/     B7F :                     					; DATA XREF: DrumUpdate_Proc:FMDrum8Ao
    2042/     B7F :                     FMDrumIns05:				; DATA XREF: DrumUpdate_Proc:FMDrumInsPtrso
    2043/     B7F : 3D 00 0F 0F 0F 1F   		db  3Dh, 00h, 0Fh, 0Fh,	0Fh, 1Fh, 9Fh, 9Fh, 9Fh, 1Fh, 1Fh
              B85 : 9F 9F 9F 1F 1F    
    2044/     B8A : 1F 1F 00 0E 10 0F   		db  1Fh, 1Fh, 00h, 0Eh,	10h, 0Fh, 0Fh, 4Fh, 4Fh, 4Fh, 00h
              B90 : 0F 4F 4F 4F 00    
    2045/     B95 : 90 90 85            		db  90h, 90h, 85h
    2046/     B98 :                     ; ---------------------------------------------------------------------------
    2047/     B98 :                     
    2048/     B98 :                     cfHandler:				; CODE XREF: TrkUpdate_Proc+12j
    2049/     B98 : 21 A4 0B            		ld	hl, cfReturn
    2050/     B9B :                     
    2051/     B9B :                     loc_B9B:				; CODE XREF: DrumUpdate_Proc+B0j
    2052/     B9B : E5                  		push	hl
    2053/     B9C : D6 E0               		sub	0E0h
    2054/     B9E : 21 AF 0B            		ld	hl, cfPtrTable
    2055/     BA1 : EF                  		rst	ReadPtrTable
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 37 - 5/8/2024 17:23:58


    2056/     BA2 : 1A                  		ld	a, (de)
    2057/     BA3 : E9                  		jp	(hl)
    2058/     BA4 :                     ; End of function DrumUpdate_Proc
    2059/     BA4 :                     
    2060/     BA4 :                     ; ---------------------------------------------------------------------------
    2061/     BA4 :                     
    2062/     BA4 :                     cfReturn:				; DATA XREF: DrumUpdate_Proc:cfHandlero
    2063/     BA4 : 13                  		inc	de
    2064/     BA5 : C3 E4 01            		jp	loc_1E4
    2065/     BA8 :                     ; ---------------------------------------------------------------------------
    2066/     BA8 :                     
    2067/     BA8 :                     cfMetaCoordFlag:			; DATA XREF: RAM:cfPtrTableo
    2068/     BA8 : 21 EF 0B            		ld	hl, cfMetaPtrTable
    2069/     BAB : EF                  		rst	ReadPtrTable
    2070/     BAC : 13                  		inc	de
    2071/     BAD : 1A                  		ld	a, (de)
    2072/     BAE : E9                  		jp	(hl)
    2073/     BAF :                     ; ---------------------------------------------------------------------------
    2074/     BAF : 89 0D 9D 0C B2 0C   cfPtrTable:	dw cfE0_Pan, cfE1_Detune, cfE2_SetComm,	cfE3_SilenceTrk
              BB5 : E7 0C             
    2075/     BB7 :                     					; DATA XREF: DrumUpdate_Proc+1F5o
    2076/     BB7 : F7 0C C2 0D CA 0D   		dw cfE4_PanAnim, cfE5_ChgPFMVol, cfE6_ChgFMVol,	cfE7_Hold
              BBD : 0A 0D             
    2077/     BBF : ED 0C 9A 0D 2B 0C   		dw cfE8_NoteStop, cfE9_SetLFO, cfEA_SetUpdRate,	cfEB_ChgUpdRate
              BC5 : 38 0C             
    2078/     BC7 : B6 0C C9 0C CE 0C   		dw cfEC_ChgPSGVol, cfED_FMChnWrite, cfEE_FM1Write, cfEF_SetIns
              BCD : 4D 0D             
    2079/     BCF : D9 0C 0A 0E 40 0E   		dw cfF0_ModSetup, cfF1_ModTypePFM, cfF2_StopTrk, cfF3_PSGNoise
              BD5 : E2 0D             
    2080/     BD7 : 12 0E 01 0E 16 0E   		dw cfF4_ModType, cfF5_SetPSGIns, cfF6_GoTo, cfF7_Loop
              BDD : 07 0F             
    2081/     BDF : DA 0E F4 0E DE 0D   		dw cfF8_GoSub, cfF9_Return, cfFA_TickMult, cfFB_ChgTransp
              BE5 : D7 0D             
    2082/     BE7 : 1C 0E 32 0E 10 0D   		dw cfFC_PitchSlide, cfFD_RawFrqMode, cfFE_SpcFM3Mode, cfMetaCoordFlag
              BED : A8 0B             
    2083/     BEF : 27 0C AA 0C 4C 0C   cfMetaPtrTable:	dw cf00_TimingMode, cf01_SetTempo, cf02_PlaySnd, cf03_MusPause
              BF5 : 54 0C             
    2084/     BF7 :                     					; DATA XREF: RAM:cfMetaCoordFlago
    2085/     BF7 : 8F 0C 18 0C FF 0B   		dw cf04_CopyMem, cf05_TickMulAll, cf06_SSGEG, cf07_FMVolEnv
              BFD : A1 0C             
    2086/     BFF :                     ; ---------------------------------------------------------------------------
    2087/     BFF :                     
    2088/     BFF :                     cf06_SSGEG:				; DATA XREF: RAM:cfMetaPtrTableo
    2089/     BFF : DD 36 18 80         		ld	(ix+18h), 80h
    2090/     C03 : DD 73 19            		ld	(ix+19h), e
    2091/     C06 : DD 72 1A            		ld	(ix+1Ah), d
    2092/     C09 :                     
    2093/     C09 :                     ; =============== S U B	R O U T	I N E =======================================
    2094/     C09 :                     
    2095/     C09 :                     
    2096/     C09 :                     SendSSGEG:				; CODE XREF: PlaySoundID:loc_EC0p
    2097/     C09 : 21 E2 04            		ld	hl, SSGEG_Ops
    2098/     C0C : 06 04               		ld	b, 4
    2099/     C0E :                     
    2100/     C0E :                     loc_C0E:				; CODE XREF: SendSSGEG+Bj
    2101/     C0E : 1A                  		ld	a, (de)
    2102/     C0F : 13                  		inc	de
    2103/     C10 : 4F                  		ld	c, a
    2104/     C11 : 7E                  		ld	a, (hl)
    2105/     C12 : 23                  		inc	hl
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 38 - 5/8/2024 17:23:58


    2106/     C13 : D7                  		rst	WriteFMMain
    2107/     C14 : 10 F8               		djnz	loc_C0E
    2108/     C16 : 1B                  		dec	de
    2109/     C17 : C9                  		ret
    2110/     C18 :                     ; End of function SendSSGEG
    2111/     C18 :                     
    2112/     C18 :                     ; ---------------------------------------------------------------------------
    2113/     C18 :                     
    2114/     C18 :                     cf05_TickMulAll:			; DATA XREF: RAM:cfMetaPtrTableo
    2115/     C18 : D9                  		exx
    2116/     C19 : 06 0A               		ld	b, 0Ah
    2117/     C1B : 11 30 00            		ld	de, 30h
    2118/     C1E : 21 42 1C            		ld	hl, byte_1C42
    2119/     C21 :                     
    2120/     C21 :                     loc_C21:				; CODE XREF: RAM:0C23j
    2121/     C21 : 77                  		ld	(hl), a
    2122/     C22 : 19                  		add	hl, de
    2123/     C23 : 10 FC               		djnz	loc_C21
    2124/     C25 : D9                  		exx
    2125/     C26 : C9                  		ret
    2126/     C27 :                     ; ---------------------------------------------------------------------------
    2127/     C27 :                     
    2128/     C27 :                     cf00_TimingMode:			; DATA XREF: RAM:cfMetaPtrTableo
    2129/     C27 : 32 07 1C            		ld	(byte_1C07), a	; set 1C07, the	Timing Mode
    2130/     C2A : C9                  		ret
    2131/     C2B :                     ; ---------------------------------------------------------------------------
    2132/     C2B :                     
    2133/     C2B :                     cfEA_SetUpdRate:			; DATA XREF: RAM:cfPtrTableo
    2134/     C2B : 21 04 1C            		ld	hl, word_1C04	; 1C04/1C05 = YM2612 Timer A value (Music Tempo)
    2135/     C2E : EB                  		ex	de, hl		; (sound driver	update rate)
    2136/     C2F : ED A0               		ldi
    2137/     C31 : ED A0               		ldi
    2138/     C33 : ED A0               		ldi			; 1C06 = YM2612	Timer B	value (SFX Tempo)
    2139/     C35 : EB                  		ex	de, hl
    2140/     C36 : 1B                  		dec	de
    2141/     C37 : C9                  		ret
    2142/     C38 :                     ; ---------------------------------------------------------------------------
    2143/     C38 :                     
    2144/     C38 :                     cfEB_ChgUpdRate:			; DATA XREF: RAM:cfPtrTableo
    2145/     C38 : EB                  		ex	de, hl
    2146/     C39 : 4E                  		ld	c, (hl)
    2147/     C3A : 23                  		inc	hl
    2148/     C3B : 46                  		ld	b, (hl)
    2149/     C3C : 23                  		inc	hl
    2150/     C3D : EB                  		ex	de, hl
    2151/     C3E : 2A 04 1C            		ld	hl, (word_1C04)
    2152/     C41 : 09                  		add	hl, bc		; add 2-byte value to 1C04/1C05	Timer A
    2153/     C42 : 22 04 1C            		ld	(word_1C04), hl
    2154/     C45 : 1A                  		ld	a, (de)
    2155/     C46 : 21 06 1C            		ld	hl, byte_1C06
    2156/     C49 : 86                  		add	a, (hl)		; add 1-byte value to 1C06 Timer B
    2157/     C4A : 77                  		ld	(hl), a
    2158/     C4B : C9                  		ret
    2159/     C4C :                     ; ---------------------------------------------------------------------------
    2160/     C4C :                     
    2161/     C4C :                     cf02_PlaySnd:				; DATA XREF: RAM:cfMetaPtrTableo
    2162/     C4C : DD E5               		push	ix
    2163/     C4E : CD 0E 05            		call	PlaySnd_JumpIn	; play Sound ID	from parameter A
    2164/     C51 : DD E1               		pop	ix
    2165/     C53 : C9                  		ret
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 39 - 5/8/2024 17:23:58


    2166/     C54 :                     ; ---------------------------------------------------------------------------
    2167/     C54 :                     
    2168/     C54 :                     cf03_MusPause:				; DATA XREF: RAM:cfMetaPtrTableo
    2169/     C54 : 32 11 1C            		ld	(byte_1C11), a	; 1C11 - Music is paused
    2170/     C57 : B7                  		or	a
    2171/     C58 : 28 1D               		jr	z, loc_C77	; 00 - unpause,	so jump
    2172/     C5A : DD E5               		push	ix		; 01-FF	- pause	music
    2173/     C5C : D5                  		push	de
    2174/     C5D : DD 21 40 1C         		ld	ix, byte_1C40	; 1C40 - Music Tracks
    2175/     C61 : 06 0A               		ld	b, 0Ah		; 10 music tracks
    2176/     C63 : 11 30 00            		ld	de, 30h
    2177/     C66 :                     
    2178/     C66 :                     loc_C66:				; CODE XREF: RAM:0C6Fj
    2179/     C66 : DD CB 00 BE         		res	7, (ix+0)	; disable channel
    2180/     C6A : CD 2A 04            		call	SendNoteOff	; turn FM note off
    2181/     C6D : DD 19               		add	ix, de
    2182/     C6F : 10 F5               		djnz	loc_C66
    2183/     C71 : D1                  		pop	de
    2184/     C72 : DD E1               		pop	ix
    2185/     C74 : C3 69 08            		jp	SilencePSG
    2186/     C77 :                     ; ---------------------------------------------------------------------------
    2187/     C77 :                     
    2188/     C77 :                     loc_C77:				; CODE XREF: RAM:0C58j
    2189/     C77 : DD E5               		push	ix
    2190/     C79 : D5                  		push	de
    2191/     C7A : DD 21 40 1C         		ld	ix, byte_1C40	; 1C40 - Music Tracks
    2192/     C7E : 06 0A               		ld	b, 0Ah		; 10 music tracks
    2193/     C80 : 11 30 00            		ld	de, 30h
    2194/     C83 :                     
    2195/     C83 :                     loc_C83:				; CODE XREF: RAM:0C89j
    2196/     C83 : DD CB 00 FE         		set	7, (ix+0)	; re-enable channel
    2197/     C87 : DD 19               		add	ix, de
    2198/     C89 : 10 F8               		djnz	loc_C83
    2199/     C8B : D1                  		pop	de
    2200/     C8C : DD E1               		pop	ix
    2201/     C8E : C9                  		ret
    2202/     C8F :                     ; ---------------------------------------------------------------------------
    2203/     C8F :                     
    2204/     C8F :                     cf04_CopyMem:				; DATA XREF: RAM:cfMetaPtrTableo
    2205/     C8F : EB                  		ex	de, hl
    2206/     C90 : 5E                  		ld	e, (hl)
    2207/     C91 : 23                  		inc	hl
    2208/     C92 : 56                  		ld	d, (hl)
    2209/     C93 : 23                  		inc	hl
    2210/     C94 : 4E                  		ld	c, (hl)
    2211/     C95 : 06 00               		ld	b, 0
    2212/     C97 : 23                  		inc	hl
    2213/     C98 : EB                  		ex	de, hl
    2214/     C99 : ED B0               		ldir
    2215/     C9B : 1B                  		dec	de
    2216/     C9C : C9                  		ret
    2217/     C9D :                     ; ---------------------------------------------------------------------------
    2218/     C9D :                     
    2219/     C9D :                     cfE1_Detune:				; DATA XREF: RAM:cfPtrTableo
    2220/     C9D : DD 77 10            		ld	(ix+10h), a
    2221/     CA0 : C9                  		ret
    2222/     CA1 :                     ; ---------------------------------------------------------------------------
    2223/     CA1 :                     
    2224/     CA1 :                     cf07_FMVolEnv:				; DATA XREF: RAM:cfMetaPtrTableo
    2225/     CA1 : DD 77 18            		ld	(ix+18h), a
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 40 - 5/8/2024 17:23:58


    2226/     CA4 : 13                  		inc	de
    2227/     CA5 : 1A                  		ld	a, (de)
    2228/     CA6 : DD 77 19            		ld	(ix+19h), a
    2229/     CA9 : C9                  		ret
    2230/     CAA :                     ; ---------------------------------------------------------------------------
    2231/     CAA :                     
    2232/     CAA :                     cf01_SetTempo:				; DATA XREF: RAM:cfMetaPtrTableo
    2233/     CAA : 21 14 1C            		ld	hl, byte_1C14	; 1C14 - Tempo Value (frame-based timing)
    2234/     CAD : 86                  		add	a, (hl)
    2235/     CAE : 77                  		ld	(hl), a		; set 1C14 (Initial Tempo)
    2236/     CAF : 2B                  		dec	hl
    2237/     CB0 : 77                  		ld	(hl), a		; set 1C13 (Tempo Timeout)
    2238/     CB1 : C9                  		ret
    2239/     CB2 :                     ; ---------------------------------------------------------------------------
    2240/     CB2 :                     
    2241/     CB2 :                     cfE2_SetComm:				; DATA XREF: RAM:cfPtrTableo
    2242/     CB2 : 32 16 1C            		ld	(byte_1C16), a
    2243/     CB5 : C9                  		ret
    2244/     CB6 :                     ; ---------------------------------------------------------------------------
    2245/     CB6 :                     
    2246/     CB6 :                     cfEC_ChgPSGVol:				; DATA XREF: RAM:cfPtrTableo
    2247/     CB6 : DD CB 01 7E         		bit	7, (ix+1)
    2248/     CBA : C8                  		ret	z
    2249/     CBB : DD CB 00 A6         		res	4, (ix+0)
    2250/     CBF : DD 35 17            		dec	(ix+17h)
    2251/     CC2 : DD 86 06            		add	a, (ix+6)
    2252/     CC5 : DD 77 06            		ld	(ix+6),	a
    2253/     CC8 : C9                  		ret
    2254/     CC9 :                     ; ---------------------------------------------------------------------------
    2255/     CC9 :                     
    2256/     CC9 :                     cfED_FMChnWrite:			; DATA XREF: RAM:cfPtrTableo
    2257/     CC9 : CD D3 0C            		call	ReadFMCommand
    2258/     CCC : D7                  		rst	WriteFMMain
    2259/     CCD : C9                  		ret
    2260/     CCE :                     ; ---------------------------------------------------------------------------
    2261/     CCE :                     
    2262/     CCE :                     cfEE_FM1Write:				; DATA XREF: RAM:cfPtrTableo
    2263/     CCE : CD D3 0C            		call	ReadFMCommand
    2264/     CD1 : DF                  		rst	WriteFMI
    2265/     CD2 : C9                  		ret
    2266/     CD3 :                     
    2267/     CD3 :                     ; =============== S U B	R O U T	I N E =======================================
    2268/     CD3 :                     
    2269/     CD3 :                     
    2270/     CD3 :                     ReadFMCommand:				; CODE XREF: RAM:cfED_FMChnWritep
    2271/     CD3 :                     					; RAM:cfEE_FM1Writep
    2272/     CD3 : EB                  		ex	de, hl
    2273/     CD4 : 7E                  		ld	a, (hl)
    2274/     CD5 : 23                  		inc	hl
    2275/     CD6 : 4E                  		ld	c, (hl)
    2276/     CD7 : EB                  		ex	de, hl
    2277/     CD8 : C9                  		ret
    2278/     CD9 :                     ; End of function ReadFMCommand
    2279/     CD9 :                     
    2280/     CD9 :                     ; ---------------------------------------------------------------------------
    2281/     CD9 :                     
    2282/     CD9 :                     cfF0_ModSetup:				; DATA XREF: RAM:cfPtrTableo
    2283/     CD9 : DD 73 20            		ld	(ix+20h), e
    2284/     CDC : DD 72 21            		ld	(ix+21h), d
    2285/     CDF : DD 36 07 80         		ld	(ix+7),	80h
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 41 - 5/8/2024 17:23:58


    2286/     CE3 : 13                  		inc	de
    2287/     CE4 : 13                  		inc	de
    2288/     CE5 : 13                  		inc	de
    2289/     CE6 : C9                  		ret
    2290/     CE7 :                     ; ---------------------------------------------------------------------------
    2291/     CE7 :                     
    2292/     CE7 :                     cfE3_SilenceTrk:			; DATA XREF: RAM:cfPtrTableo
    2293/     CE7 : CD E2 08            		call	SilenceFMChn
    2294/     CEA : C3 40 0E            		jp	cfF2_StopTrk
    2295/     CED :                     ; ---------------------------------------------------------------------------
    2296/     CED :                     
    2297/     CED :                     cfE8_NoteStop:				; DATA XREF: RAM:cfPtrTableo
    2298/     CED : CD 9E 02            		call	TickMultiplier
    2299/     CF0 : DD 77 1E            		ld	(ix+1Eh), a
    2300/     CF3 : DD 77 1F            		ld	(ix+1Fh), a
    2301/     CF6 : C9                  		ret
    2302/     CF7 :                     ; ---------------------------------------------------------------------------
    2303/     CF7 :                     
    2304/     CF7 :                     cfE4_PanAnim:				; DATA XREF: RAM:cfPtrTableo
    2305/     CF7 : DD E5               		push	ix
    2306/     CF9 : E1                  		pop	hl
    2307/     CFA : 01 11 00            		ld	bc, 11h
    2308/     CFD : 09                  		add	hl, bc
    2309/     CFE : EB                  		ex	de, hl
    2310/     CFF : 01 05 00            		ld	bc, 5
    2311/     D02 : ED B0               		ldir
    2312/     D04 : 3E 01               		ld	a, 1
    2313/     D06 : 12                  		ld	(de), a
    2314/     D07 : EB                  		ex	de, hl
    2315/     D08 : 1B                  		dec	de
    2316/     D09 : C9                  		ret
    2317/     D0A :                     ; ---------------------------------------------------------------------------
    2318/     D0A :                     
    2319/     D0A :                     cfE7_Hold:				; DATA XREF: RAM:cfPtrTableo
    2320/     D0A : DD CB 00 CE         		set	1, (ix+0)
    2321/     D0E : 1B                  		dec	de
    2322/     D0F : C9                  		ret
    2323/     D10 :                     ; ---------------------------------------------------------------------------
    2324/     D10 :                     
    2325/     D10 :                     cfFE_SpcFM3Mode:			; DATA XREF: RAM:cfPtrTableo
    2326/     D10 : DD 7E 01            		ld	a, (ix+1)
    2327/     D13 : FE 02               		cp	2
    2328/     D15 : 20 2A               		jr	nz, SpcFM3_skip
    2329/     D17 : DD CB 00 C6         		set	0, (ix+0)
    2330/     D1B : D9                  		exx
    2331/     D1C : CD C6 01            		call	GetFM3FreqPtr
    2332/     D1F : 06 04               		ld	b, 4
    2333/     D21 :                     
    2334/     D21 :                     loc_D21:				; CODE XREF: RAM:0D33j
    2335/     D21 : C5                  		push	bc
    2336/     D22 : D9                  		exx
    2337/     D23 : 1A                  		ld	a, (de)
    2338/     D24 : 13                  		inc	de
    2339/     D25 : D9                  		exx
    2340/     D26 : 21 45 0D            		ld	hl, FM3_FreqVals
    2341/     D29 : 87                  		add	a, a
    2342/     D2A : 4F                  		ld	c, a
    2343/     D2B : 06 00               		ld	b, 0
    2344/     D2D : 09                  		add	hl, bc
    2345/     D2E : ED A0               		ldi
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 42 - 5/8/2024 17:23:58


    2346/     D30 : ED A0               		ldi
    2347/     D32 : C1                  		pop	bc
    2348/     D33 : 10 EC               		djnz	loc_D21
    2349/     D35 : D9                  		exx
    2350/     D36 : 1B                  		dec	de
    2351/     D37 : 3E 4F               		ld	a, 4Fh		; enable Special FM3 Mode
    2352/     D39 :                     
    2353/     D39 :                     ; =============== S U B	R O U T	I N E =======================================
    2354/     D39 :                     
    2355/     D39 :                     
    2356/     D39 :                     SendFM3SpcMode:				; CODE XREF: PlaySoundID:loc_E9Dp
    2357/     D39 : 32 12 1C            		ld	(byte_1C12), a
    2358/     D3C : 4F                  		ld	c, a
    2359/     D3D : 3E 27               		ld	a, 27h
    2360/     D3F : DF                  		rst	WriteFMI
    2361/     D40 : C9                  		ret
    2362/     D41 :                     ; End of function SendFM3SpcMode
    2363/     D41 :                     
    2364/     D41 :                     ; ---------------------------------------------------------------------------
    2365/     D41 :                     
    2366/     D41 :                     SpcFM3_skip:				; CODE XREF: RAM:0D15j
    2367/     D41 : 13                  		inc	de
    2368/     D42 : 13                  		inc	de
    2369/     D43 : 13                  		inc	de
    2370/     D44 : C9                  		ret
    2371/     D45 :                     ; ---------------------------------------------------------------------------
    2372/     D45 : 00 00 32 01 8A 01   FM3_FreqVals:	dw 0, 132h, 18Ah, 1E4h	; DATA XREF: RAM:0D26o
              D4B : E4 01             
    2373/     D4D :                     					; Note:	The 3rd	frequency is different from other SMPS drivers.
    2374/     D4D :                     					;	(18Ah instead of 18Eh)
    2375/     D4D :                     ; ---------------------------------------------------------------------------
    2376/     D4D :                     
    2377/     D4D :                     cfEF_SetIns:				; DATA XREF: RAM:cfPtrTableo
    2378/     D4D : DD CB 01 7E         		bit	7, (ix+1)
    2379/     D51 : 20 31               		jr	nz, loc_D84
    2380/     D53 : CD F2 08            		call	SetMaxRelRate
    2381/     D56 : 1A                  		ld	a, (de)
    2382/     D57 : DD 77 08            		ld	(ix+8),	a
    2383/     D5A : B7                  		or	a
    2384/     D5B : F2 7A 0D            		jp	p, loc_D7A
    2385/     D5E : 13                  		inc	de
    2386/     D5F : 1A                  		ld	a, (de)
    2387/     D60 : DD 77 0F            		ld	(ix+0Fh), a
    2388/     D63 :                     
    2389/     D63 :                     ; =============== S U B	R O U T	I N E =======================================
    2390/     D63 :                     
    2391/     D63 :                     
    2392/     D63 :                     SetInsFromSong:				; CODE XREF: PlaySoundID+99Cp
    2393/     D63 : D5                  		push	de
    2394/     D64 : DD 7E 0F            		ld	a, (ix+0Fh)
    2395/     D67 : D6 81               		sub	81h
    2396/     D69 : 0E 04               		ld	c, 4
    2397/     D6B : CD EB 05            		call	GetListOfsROM	; get List 2 (Music Pointers)
    2398/     D6E : F7                  		rst	ReadPtrFromHL
    2399/     D6F : DD 7E 08            		ld	a, (ix+8)
    2400/     D72 : E6 7F               		and	7Fh
    2401/     D74 : 47                  		ld	b, a
    2402/     D75 : CD 97 04            		call	JumpToInsData
    2403/     D78 : 18 05               		jr	loc_D7F
    2404/     D7A :                     ; ---------------------------------------------------------------------------
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 43 - 5/8/2024 17:23:58


    2405/     D7A :                     
    2406/     D7A :                     loc_D7A:				; CODE XREF: RAM:0D5Bj
    2407/     D7A : D5                  		push	de
    2408/     D7B : 47                  		ld	b, a
    2409/     D7C : CD 88 04            		call	GetFMInsPtr
    2410/     D7F :                     
    2411/     D7F :                     loc_D7F:				; CODE XREF: SetInsFromSong+15j
    2412/     D7F : CD E6 04            		call	SendFMIns
    2413/     D82 : D1                  		pop	de
    2414/     D83 : C9                  		ret
    2415/     D84 :                     ; End of function SetInsFromSong
    2416/     D84 :                     
    2417/     D84 :                     ; ---------------------------------------------------------------------------
    2418/     D84 :                     
    2419/     D84 :                     loc_D84:				; CODE XREF: RAM:0D51j
    2420/     D84 : 1A                  		ld	a, (de)
    2421/     D85 : B7                  		or	a
    2422/     D86 : F0                  		ret	p
    2423/     D87 : 13                  		inc	de
    2424/     D88 : C9                  		ret
    2425/     D89 :                     
    2426/     D89 :                     ; =============== S U B	R O U T	I N E =======================================
    2427/     D89 :                     
    2428/     D89 :                     
    2429/     D89 :                     cfE0_Pan:				; CODE XREF: DoPanAnimation+3Dp
    2430/     D89 :                     					; DATA XREF: RAM:cfPtrTableo
    2431/     D89 : 0E 3F               		ld	c, 3Fh
    2432/     D8B :                     
    2433/     D8B :                     loc_D8B:				; CODE XREF: RAM:0DA1j
    2434/     D8B : DD 7E 0A            		ld	a, (ix+0Ah)
    2435/     D8E : A1                  		and	c
    2436/     D8F : EB                  		ex	de, hl
    2437/     D90 : B6                  		or	(hl)
    2438/     D91 : DD 77 0A            		ld	(ix+0Ah), a
    2439/     D94 : 4F                  		ld	c, a
    2440/     D95 : 3E B4               		ld	a, 0B4h
    2441/     D97 : D7                  		rst	WriteFMMain
    2442/     D98 : EB                  		ex	de, hl
    2443/     D99 : C9                  		ret
    2444/     D9A :                     ; End of function cfE0_Pan
    2445/     D9A :                     
    2446/     D9A :                     ; ---------------------------------------------------------------------------
    2447/     D9A :                     
    2448/     D9A :                     cfE9_SetLFO:				; DATA XREF: RAM:cfPtrTableo
    2449/     D9A : 4F                  		ld	c, a
    2450/     D9B : 3E 22               		ld	a, 22h
    2451/     D9D : DF                  		rst	WriteFMI
    2452/     D9E : 13                  		inc	de
    2453/     D9F : 0E C0               		ld	c, 0C0h
    2454/     DA1 : 18 E8               		jr	loc_D8B
    2455/     DA3 :                     
    2456/     DA3 :                     ; =============== S U B	R O U T	I N E =======================================
    2457/     DA3 :                     
    2458/     DA3 :                     
    2459/     DA3 :                     RefreshVolume:				; CODE XREF: SendFMIns+1Cj
    2460/     DA3 :                     					; DoFading+41p	...
    2461/     DA3 : D9                  		exx
    2462/     DA4 : 11 DE 04            		ld	de, Volume_Ops
    2463/     DA7 : DD 6E 1C            		ld	l, (ix+1Ch)
    2464/     DAA : DD 66 1D            		ld	h, (ix+1Dh)
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 44 - 5/8/2024 17:23:58


    2465/     DAD : 06 04               		ld	b, 4
    2466/     DAF :                     
    2467/     DAF :                     loc_DAF:				; CODE XREF: RefreshVolume+1Bj
    2468/     DAF : 7E                  		ld	a, (hl)
    2469/     DB0 : B7                  		or	a
    2470/     DB1 : F2 B7 0D            		jp	p, loc_DB7
    2471/     DB4 : DD 86 06            		add	a, (ix+6)
    2472/     DB7 :                     
    2473/     DB7 :                     loc_DB7:				; CODE XREF: RefreshVolume+Ej
    2474/     DB7 : E6 7F               		and	7Fh
    2475/     DB9 : 4F                  		ld	c, a
    2476/     DBA : 1A                  		ld	a, (de)
    2477/     DBB : D7                  		rst	WriteFMMain
    2478/     DBC : 13                  		inc	de
    2479/     DBD : 23                  		inc	hl
    2480/     DBE : 10 EF               		djnz	loc_DAF
    2481/     DC0 : D9                  		exx
    2482/     DC1 : C9                  		ret
    2483/     DC2 :                     ; End of function RefreshVolume
    2484/     DC2 :                     
    2485/     DC2 :                     ; ---------------------------------------------------------------------------
    2486/     DC2 :                     
    2487/     DC2 :                     cfE5_ChgPFMVol:				; DATA XREF: RAM:cfPtrTableo
    2488/     DC2 : 13                  		inc	de
    2489/     DC3 : DD 86 06            		add	a, (ix+6)
    2490/     DC6 : DD 77 06            		ld	(ix+6),	a
    2491/     DC9 : 1A                  		ld	a, (de)
    2492/     DCA :                     
    2493/     DCA :                     cfE6_ChgFMVol:				; DATA XREF: RAM:cfPtrTableo
    2494/     DCA : DD CB 01 7E         		bit	7, (ix+1)
    2495/     DCE : C0                  		ret	nz
    2496/     DCF : DD 86 06            		add	a, (ix+6)
    2497/     DD2 : DD 77 06            		ld	(ix+6),	a
    2498/     DD5 : 18 CC               		jr	RefreshVolume
    2499/     DD7 :                     ; ---------------------------------------------------------------------------
    2500/     DD7 :                     
    2501/     DD7 :                     cfFB_ChgTransp:				; DATA XREF: RAM:cfPtrTableo
    2502/     DD7 : DD 86 05            		add	a, (ix+5)
    2503/     DDA : DD 77 05            		ld	(ix+5),	a
    2504/     DDD : C9                  		ret
    2505/     DDE :                     ; ---------------------------------------------------------------------------
    2506/     DDE :                     
    2507/     DDE :                     cfFA_TickMult:				; DATA XREF: RAM:cfPtrTableo
    2508/     DDE : DD 77 02            		ld	(ix+2),	a
    2509/     DE1 : C9                  		ret
    2510/     DE2 :                     ; ---------------------------------------------------------------------------
    2511/     DE2 :                     
    2512/     DE2 :                     cfF3_PSGNoise:				; DATA XREF: RAM:cfPtrTableo
    2513/     DE2 : DD CB 01 56         		bit	2, (ix+1)
    2514/     DE6 : C0                  		ret	nz
    2515/     DE7 : 3E DF               		ld	a, 0DFh
    2516/     DE9 : 32 11 7F            		ld	(7F11h), a
    2517/     DEC : 1A                  		ld	a, (de)
    2518/     DED : DD 77 1A            		ld	(ix+1Ah), a
    2519/     DF0 : DD CB 00 C6         		set	0, (ix+0)
    2520/     DF4 : B7                  		or	a
    2521/     DF5 : 20 06               		jr	nz, loc_DFD
    2522/     DF7 : DD CB 00 86         		res	0, (ix+0)
    2523/     DFB : 3E FF               		ld	a, 0FFh
    2524/     DFD :                     
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 45 - 5/8/2024 17:23:58


    2525/     DFD :                     loc_DFD:				; CODE XREF: RAM:0DF5j
    2526/     DFD : 32 11 7F            		ld	(7F11h), a
    2527/     E00 : C9                  		ret
    2528/     E01 :                     ; ---------------------------------------------------------------------------
    2529/     E01 :                     
    2530/     E01 :                     cfF5_SetPSGIns:				; DATA XREF: RAM:cfPtrTableo
    2531/     E01 : DD CB 01 7E         		bit	7, (ix+1)
    2532/     E05 : C8                  		ret	z
    2533/     E06 : DD 77 08            		ld	(ix+8),	a
    2534/     E09 : C9                  		ret
    2535/     E0A :                     ; ---------------------------------------------------------------------------
    2536/     E0A :                     
    2537/     E0A :                     cfF1_ModTypePFM:			; DATA XREF: RAM:cfPtrTableo
    2538/     E0A : 13                  		inc	de
    2539/     E0B : DD CB 01 7E         		bit	7, (ix+1)
    2540/     E0F : 20 01               		jr	nz, cfF4_ModType
    2541/     E11 : 1A                  		ld	a, (de)
    2542/     E12 :                     
    2543/     E12 :                     cfF4_ModType:				; CODE XREF: RAM:0E0Fj
    2544/     E12 :                     					; DATA XREF: RAM:cfPtrTableo
    2545/     E12 : DD 77 07            		ld	(ix+7),	a
    2546/     E15 : C9                  		ret
    2547/     E16 :                     ; ---------------------------------------------------------------------------
    2548/     E16 :                     
    2549/     E16 :                     cfF6_GoTo:				; CODE XREF: RAM:0F19j
    2550/     E16 :                     					; DATA XREF: RAM:cfPtrTableo
    2551/     E16 : EB                  		ex	de, hl
    2552/     E17 : 5E                  		ld	e, (hl)
    2553/     E18 : 23                  		inc	hl
    2554/     E19 : 56                  		ld	d, (hl)
    2555/     E1A : 1B                  		dec	de
    2556/     E1B : C9                  		ret
    2557/     E1C :                     ; ---------------------------------------------------------------------------
    2558/     E1C :                     
    2559/     E1C :                     cfFC_PitchSlide:			; DATA XREF: RAM:cfPtrTableo
    2560/     E1C : FE 01               		cp	1
    2561/     E1E : 20 05               		jr	nz, loc_E25
    2562/     E20 : DD CB 00 EE         		set	5, (ix+0)
    2563/     E24 : C9                  		ret
    2564/     E25 :                     ; ---------------------------------------------------------------------------
    2565/     E25 :                     
    2566/     E25 :                     loc_E25:				; CODE XREF: RAM:0E1Ej
    2567/     E25 : DD CB 00 8E         		res	1, (ix+0)
    2568/     E29 : DD CB 00 AE         		res	5, (ix+0)
    2569/     E2D : AF                  		xor	a
    2570/     E2E : DD 77 10            		ld	(ix+10h), a
    2571/     E31 : C9                  		ret
    2572/     E32 :                     ; ---------------------------------------------------------------------------
    2573/     E32 :                     
    2574/     E32 :                     cfFD_RawFrqMode:			; DATA XREF: RAM:cfPtrTableo
    2575/     E32 : FE 01               		cp	1
    2576/     E34 : 20 05               		jr	nz, loc_E3B
    2577/     E36 : DD CB 00 DE         		set	3, (ix+0)
    2578/     E3A : C9                  		ret
    2579/     E3B :                     ; ---------------------------------------------------------------------------
    2580/     E3B :                     
    2581/     E3B :                     loc_E3B:				; CODE XREF: RAM:0E34j
    2582/     E3B : DD CB 00 9E         		res	3, (ix+0)
    2583/     E3F : C9                  		ret
    2584/     E40 :                     ; ---------------------------------------------------------------------------
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 46 - 5/8/2024 17:23:58


    2585/     E40 :                     ; START	OF FUNCTION CHUNK FOR PlaySoundID
    2586/     E40 :                     
    2587/     E40 :                     cfF2_StopTrk:				; CODE XREF: PlaySoundID+49j RAM:0CEAj
    2588/     E40 :                     					; DATA XREF: ...
    2589/     E40 : DD CB 00 BE         		res	7, (ix+0)
    2590/     E44 : 3E 1F               		ld	a, 1Fh
    2591/     E46 : 32 15 1C            		ld	(byte_1C15), a
    2592/     E49 : CD 24 04            		call	DoNoteOff
    2593/     E4C : DD 4E 01            		ld	c, (ix+1)
    2594/     E4F : DD E5               		push	ix
    2595/     E51 : CD A3 06            		call	GetSFXChnPtrs
    2596/     E54 : 3A 19 1C            		ld	a, (byte_1C19)
    2597/     E57 : B7                  		or	a
    2598/     E58 : 28 69               		jr	z, loc_EC3
    2599/     E5A : AF                  		xor	a
    2600/     E5B : 32 18 1C            		ld	(byte_1C18), a
    2601/     E5E : FD CB 00 7E         		bit	7, (iy+0)
    2602/     E62 : 28 12               		jr	z, loc_E76
    2603/     E64 : DD 7E 01            		ld	a, (ix+1)
    2604/     E67 : FD BE 01            		cp	(iy+1)
    2605/     E6A : 20 0A               		jr	nz, loc_E76
    2606/     E6C : FD E5               		push	iy
    2607/     E6E : FD 6E 2A            		ld	l, (iy+2Ah)
    2608/     E71 : FD 66 2B            		ld	h, (iy+2Bh)
    2609/     E74 : 18 04               		jr	loc_E7A
    2610/     E76 :                     ; ---------------------------------------------------------------------------
    2611/     E76 :                     
    2612/     E76 :                     loc_E76:				; CODE XREF: PlaySoundID+957j
    2613/     E76 :                     					; PlaySoundID+95Fj
    2614/     E76 : E5                  		push	hl
    2615/     E77 : 2A 37 1C            		ld	hl, (word_1C37)
    2616/     E7A :                     
    2617/     E7A :                     loc_E7A:				; CODE XREF: PlaySoundID+969j
    2618/     E7A : DD E1               		pop	ix
    2619/     E7C : DD CB 00 96         		res	2, (ix+0)
    2620/     E80 : DD CB 01 7E         		bit	7, (ix+1)
    2621/     E84 : 20 42               		jr	nz, loc_EC8
    2622/     E86 : DD CB 00 7E         		bit	7, (ix+0)
    2623/     E8A : 28 37               		jr	z, loc_EC3
    2624/     E8C : 3E 02               		ld	a, 2
    2625/     E8E : DD BE 01            		cp	(ix+1)
    2626/     E91 : 20 0D               		jr	nz, loc_EA0
    2627/     E93 : 3E 4F               		ld	a, 4Fh
    2628/     E95 : DD CB 00 46         		bit	0, (ix+0)
    2629/     E99 : 20 02               		jr	nz, loc_E9D
    2630/     E9B : E6 0F               		and	0Fh
    2631/     E9D :                     
    2632/     E9D :                     loc_E9D:				; CODE XREF: PlaySoundID+98Ej
    2633/     E9D : CD 39 0D            		call	SendFM3SpcMode
    2634/     EA0 :                     
    2635/     EA0 :                     loc_EA0:				; CODE XREF: PlaySoundID+986j
    2636/     EA0 : DD 7E 08            		ld	a, (ix+8)
    2637/     EA3 : B7                  		or	a
    2638/     EA4 : F2 AC 0E            		jp	p, loc_EAC
    2639/     EA7 : CD 63 0D            		call	SetInsFromSong
    2640/     EAA : 18 14               		jr	loc_EC0
    2641/     EAC :                     ; ---------------------------------------------------------------------------
    2642/     EAC :                     
    2643/     EAC :                     loc_EAC:				; CODE XREF: PlaySoundID+999j
    2644/     EAC : 47                  		ld	b, a
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 47 - 5/8/2024 17:23:58


    2645/     EAD : CD 97 04            		call	JumpToInsData
    2646/     EB0 : CD E6 04            		call	SendFMIns
    2647/     EB3 : DD 7E 18            		ld	a, (ix+18h)
    2648/     EB6 : B7                  		or	a
    2649/     EB7 : F2 C3 0E            		jp	p, loc_EC3
    2650/     EBA : DD 5E 19            		ld	e, (ix+19h)
    2651/     EBD : DD 56 1A            		ld	d, (ix+1Ah)
    2652/     EC0 :                     
    2653/     EC0 :                     loc_EC0:				; CODE XREF: PlaySoundID+99Fj
    2654/     EC0 : CD 09 0C            		call	SendSSGEG
    2655/     EC3 :                     
    2656/     EC3 :                     loc_EC3:				; CODE XREF: PlaySoundID+94Dj
    2657/     EC3 :                     					; PlaySoundID+97Fj ...
    2658/     EC3 : DD E1               		pop	ix
    2659/     EC5 : E1                  		pop	hl
    2660/     EC6 : E1                  		pop	hl
    2661/     EC7 : C9                  		ret
    2662/     EC8 :                     ; ---------------------------------------------------------------------------
    2663/     EC8 :                     
    2664/     EC8 :                     loc_EC8:				; CODE XREF: PlaySoundID+979j
    2665/     EC8 : DD CB 00 46         		bit	0, (ix+0)
    2666/     ECC : 28 F5               		jr	z, loc_EC3
    2667/     ECE : DD 7E 1A            		ld	a, (ix+1Ah)
    2668/     ED1 : B7                  		or	a
    2669/     ED2 : F2 D8 0E            		jp	p, loc_ED8
    2670/     ED5 : 32 11 7F            		ld	(7F11h), a
    2671/     ED8 :                     
    2672/     ED8 :                     loc_ED8:				; CODE XREF: PlaySoundID+9C7j
    2673/     ED8 : 18 E9               		jr	loc_EC3
    2674/     EDA :                     ; END OF FUNCTION CHUNK	FOR PlaySoundID
    2675/     EDA :                     ; ---------------------------------------------------------------------------
    2676/     EDA :                     
    2677/     EDA :                     cfF8_GoSub:				; DATA XREF: RAM:cfPtrTableo
    2678/     EDA : 4F                  		ld	c, a
    2679/     EDB : 13                  		inc	de
    2680/     EDC : 1A                  		ld	a, (de)
    2681/     EDD : 47                  		ld	b, a
    2682/     EDE : C5                  		push	bc
    2683/     EDF : DD E5               		push	ix
    2684/     EE1 : E1                  		pop	hl
    2685/     EE2 : DD 35 09            		dec	(ix+9)
    2686/     EE5 : DD 4E 09            		ld	c, (ix+9)
    2687/     EE8 : DD 35 09            		dec	(ix+9)
    2688/     EEB : 06 00               		ld	b, 0
    2689/     EED : 09                  		add	hl, bc
    2690/     EEE : 72                  		ld	(hl), d
    2691/     EEF : 2B                  		dec	hl
    2692/     EF0 : 73                  		ld	(hl), e
    2693/     EF1 : D1                  		pop	de
    2694/     EF2 : 1B                  		dec	de
    2695/     EF3 : C9                  		ret
    2696/     EF4 :                     ; ---------------------------------------------------------------------------
    2697/     EF4 :                     
    2698/     EF4 :                     cfF9_Return:				; DATA XREF: RAM:cfPtrTableo
    2699/     EF4 : DD E5               		push	ix
    2700/     EF6 : E1                  		pop	hl
    2701/     EF7 : DD 4E 09            		ld	c, (ix+9)
    2702/     EFA : 06 00               		ld	b, 0
    2703/     EFC : 09                  		add	hl, bc
    2704/     EFD : 5E                  		ld	e, (hl)
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 48 - 5/8/2024 17:23:58


    2705/     EFE : 23                  		inc	hl
    2706/     EFF : 56                  		ld	d, (hl)
    2707/     F00 : DD 34 09            		inc	(ix+9)
    2708/     F03 : DD 34 09            		inc	(ix+9)
    2709/     F06 : C9                  		ret
    2710/     F07 :                     ; ---------------------------------------------------------------------------
    2711/     F07 :                     
    2712/     F07 :                     cfF7_Loop:				; DATA XREF: RAM:cfPtrTableo
    2713/     F07 : 13                  		inc	de
    2714/     F08 : C6 28               		add	a, 28h
    2715/     F0A : 4F                  		ld	c, a
    2716/     F0B : 06 00               		ld	b, 0
    2717/     F0D : DD E5               		push	ix
    2718/     F0F : E1                  		pop	hl
    2719/     F10 : 09                  		add	hl, bc
    2720/     F11 : 7E                  		ld	a, (hl)
    2721/     F12 : B7                  		or	a
    2722/     F13 : 20 02               		jr	nz, loc_F17
    2723/     F15 : 1A                  		ld	a, (de)
    2724/     F16 : 77                  		ld	(hl), a
    2725/     F17 :                     
    2726/     F17 :                     loc_F17:				; CODE XREF: RAM:0F13j
    2727/     F17 : 13                  		inc	de
    2728/     F18 : 35                  		dec	(hl)
    2729/     F19 : C2 16 0E            		jp	nz, cfF6_GoTo
    2730/     F1C : 13                  		inc	de
    2731/     F1D : C9                  		ret
    2732/     F1E :                     ; ---------------------------------------------------------------------------
    2733/     F1E :                     ; START	OF FUNCTION CHUNK FOR UpdateTrack
    2734/     F1E :                     
    2735/     F1E :                     UpdatePSGTrk:				; CODE XREF: UpdateTrack+4j
    2736/     F1E : CD 04 03            		call	TrackTimeout
    2737/     F21 : 20 0D               		jr	nz, loc_F30
    2738/     F23 : CD D6 01            		call	TrkUpdate_Proc
    2739/     F26 : DD CB 00 66         		bit	4, (ix+0)
    2740/     F2A : C0                  		ret	nz
    2741/     F2B : CD 3A 03            		call	PrepareModulat
    2742/     F2E : 18 0C               		jr	loc_F3C
    2743/     F30 :                     ; ---------------------------------------------------------------------------
    2744/     F30 :                     
    2745/     F30 :                     loc_F30:				; CODE XREF: UpdateTrack+DE8j
    2746/     F30 : DD 7E 1E            		ld	a, (ix+1Eh)
    2747/     F33 : B7                  		or	a
    2748/     F34 : 28 06               		jr	z, loc_F3C
    2749/     F36 : DD 35 1E            		dec	(ix+1Eh)
    2750/     F39 : CA C8 0F            		jp	z, SetRest
    2751/     F3C :                     
    2752/     F3C :                     loc_F3C:				; CODE XREF: UpdateTrack+DF5j
    2753/     F3C :                     					; UpdateTrack+DFBj
    2754/     F3C : CD 34 04            		call	DoPitchSlide
    2755/     F3F : CD 65 03            		call	DoModulation
    2756/     F42 : DD CB 00 56         		bit	2, (ix+0)
    2757/     F46 : C0                  		ret	nz
    2758/     F47 : DD 4E 01            		ld	c, (ix+1)
    2759/     F4A : 7D                  		ld	a, l
    2760/     F4B : E6 0F               		and	0Fh
    2761/     F4D : B1                  		or	c
    2762/     F4E : 32 11 7F            		ld	(7F11h), a
    2763/     F51 : 7D                  		ld	a, l
    2764/     F52 : E6 F0               		and	0F0h
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 49 - 5/8/2024 17:23:58


    2765/     F54 : B4                  		or	h
    2766/     F55 : 0F                  		rrca
    2767/     F56 : 0F                  		rrca
    2768/     F57 : 0F                  		rrca
    2769/     F58 : 0F                  		rrca
    2770/     F59 : 32 11 7F            		ld	(7F11h), a
    2771/     F5C : DD 7E 08            		ld	a, (ix+8)
    2772/     F5F : B7                  		or	a
    2773/     F60 : 0E 00               		ld	c, 0
    2774/     F62 : 28 0C               		jr	z, loc_F70
    2775/     F64 : 3D                  		dec	a
    2776/     F65 : 0E 0A               		ld	c, 0Ah
    2777/     F67 : 06 80               		ld	b, 80h
    2778/     F69 : CD E7 05            		call	GetListOfsAB	; get List 5 (PSG envelopes)
    2779/     F6C : CD 97 0F            		call	DoPSGVolEnv
    2780/     F6F : 4F                  		ld	c, a
    2781/     F70 :                     
    2782/     F70 :                     loc_F70:				; CODE XREF: UpdateTrack+E29j
    2783/     F70 : DD CB 00 66         		bit	4, (ix+0)
    2784/     F74 : C0                  		ret	nz
    2785/     F75 : DD 7E 06            		ld	a, (ix+6)
    2786/     F78 : 81                  		add	a, c
    2787/     F79 : CB 67               		bit	4, a
    2788/     F7B : 28 02               		jr	z, loc_F7F
    2789/     F7D : 3E 0F               		ld	a, 0Fh
    2790/     F7F :                     
    2791/     F7F :                     loc_F7F:				; CODE XREF: UpdateTrack+E42j
    2792/     F7F : DD B6 01            		or	(ix+1)
    2793/     F82 : C6 10               		add	a, 10h
    2794/     F84 : DD CB 00 46         		bit	0, (ix+0)
    2795/     F88 : 20 04               		jr	nz, loc_F8E
    2796/     F8A : 32 11 7F            		ld	(7F11h), a
    2797/     F8D : C9                  		ret
    2798/     F8E :                     ; ---------------------------------------------------------------------------
    2799/     F8E :                     
    2800/     F8E :                     loc_F8E:				; CODE XREF: UpdateTrack+E4Fj
    2801/     F8E : C6 20               		add	a, 20h
    2802/     F90 : 32 11 7F            		ld	(7F11h), a
    2803/     F93 : C9                  		ret
    2804/     F94 :                     ; END OF FUNCTION CHUNK	FOR UpdateTrack
    2805/     F94 :                     ; ---------------------------------------------------------------------------
    2806/     F94 :                     ; START	OF FUNCTION CHUNK FOR DoPSGVolEnv
    2807/     F94 :                     
    2808/     F94 :                     loc_F94:				; CODE XREF: DoPSGVolEnv+1Aj
    2809/     F94 :                     					; DoPSGVolEnv+25j
    2810/     F94 : DD 77 17            		ld	(ix+17h), a
    2811/     F97 :                     ; END OF FUNCTION CHUNK	FOR DoPSGVolEnv
    2812/     F97 :                     
    2813/     F97 :                     ; =============== S U B	R O U T	I N E =======================================
    2814/     F97 :                     
    2815/     F97 :                     
    2816/     F97 :                     DoPSGVolEnv:				; CODE XREF: DoFMVolEnv+Ap
    2817/     F97 :                     					; UpdateTrack+E33p
    2818/     F97 :                     
    2819/     F97 :                     ; FUNCTION CHUNK AT 0F94 SIZE 00000003 BYTES
    2820/     F97 :                     
    2821/     F97 : E5                  		push	hl
    2822/     F98 : DD 4E 17            		ld	c, (ix+17h)
    2823/     F9B : CD 81 04            		call	GetEnvData	; BC = HL (base) + BC (index), A = (BC)
    2824/     F9E : E1                  		pop	hl
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 50 - 5/8/2024 17:23:58


    2825/     F9F : CB 7F               		bit	7, a
    2826/     FA1 : 28 21               		jr	z, VolEnv_Next
    2827/     FA3 : FE 83               		cp	83h
    2828/     FA5 : 28 0C               		jr	z, VolEnv_Off	; 83 - stop the	tone
    2829/     FA7 : FE 81               		cp	81h
    2830/     FA9 : 28 13               		jr	z, VolEnv_Hold	; 81 - hold the	envelope at current level
    2831/     FAB : FE 80               		cp	80h
    2832/     FAD : 28 0C               		jr	z, VolEnv_Reset	; 80 - loop back to beginning
    2833/     FAF : 03                  		inc	bc
    2834/     FB0 : 0A                  		ld	a, (bc)
    2835/     FB1 : 18 E1               		jr	loc_F94
    2836/     FB3 :                     ; ---------------------------------------------------------------------------
    2837/     FB3 :                     
    2838/     FB3 :                     VolEnv_Off:				; CODE XREF: DoPSGVolEnv+Ej
    2839/     FB3 : DD CB 00 E6         		set	4, (ix+0)
    2840/     FB7 : E1                  		pop	hl
    2841/     FB8 : C3 C8 0F            		jp	SetRest
    2842/     FBB :                     ; ---------------------------------------------------------------------------
    2843/     FBB :                     
    2844/     FBB :                     VolEnv_Reset:				; CODE XREF: DoPSGVolEnv+16j
    2845/     FBB : AF                  		xor	a
    2846/     FBC : 18 D6               		jr	loc_F94
    2847/     FBE :                     ; ---------------------------------------------------------------------------
    2848/     FBE :                     
    2849/     FBE :                     VolEnv_Hold:				; CODE XREF: DoPSGVolEnv+12j
    2850/     FBE : E1                  		pop	hl
    2851/     FBF : DD CB 00 E6         		set	4, (ix+0)
    2852/     FC3 : C9                  		ret
    2853/     FC4 :                     ; ---------------------------------------------------------------------------
    2854/     FC4 :                     
    2855/     FC4 :                     VolEnv_Next:				; CODE XREF: DoPSGVolEnv+Aj
    2856/     FC4 : DD 34 17            		inc	(ix+17h)
    2857/     FC7 : C9                  		ret
    2858/     FC8 :                     ; End of function DoPSGVolEnv
    2859/     FC8 :                     
    2860/     FC8 :                     
    2861/     FC8 :                     ; =============== S U B	R O U T	I N E =======================================
    2862/     FC8 :                     
    2863/     FC8 :                     
    2864/     FC8 :                     SetRest:				; CODE XREF: TrkUpdate_Proc+2Dp
    2865/     FC8 :                     					; UpdateTrack+E00j ...
    2866/     FC8 : DD CB 00 E6         		set	4, (ix+0)
    2867/     FCC : DD CB 00 56         		bit	2, (ix+0)
    2868/     FD0 : C0                  		ret	nz
    2869/     FD1 :                     ; End of function SetRest
    2870/     FD1 :                     
    2871/     FD1 :                     
    2872/     FD1 :                     ; =============== S U B	R O U T	I N E =======================================
    2873/     FD1 :                     
    2874/     FD1 :                     
    2875/     FD1 :                     SilencePSGChn:				; CODE XREF: GetSFXChnPtrs+Bp
    2876/     FD1 : 3E 1F               		ld	a, 1Fh
    2877/     FD3 : DD 86 01            		add	a, (ix+1)
    2878/     FD6 : B7                  		or	a
    2879/     FD7 : F0                  		ret	p
    2880/     FD8 : 32 11 7F            		ld	(7F11h), a
    2881/     FDB : DD CB 00 46         		bit	0, (ix+0)
    2882/     FDF : C8                  		ret	z
    2883/     FE0 : 3E FF               		ld	a, 0FFh
    2884/     FE2 : 32 11 7F            		ld	(7F11h), a
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 51 - 5/8/2024 17:23:58


    2885/     FE5 : C9                  		ret
    2886/     FE6 :                     ; End of function SilencePSGChn
    2887/     FE6 :                     
    2888/     FE6 :                     ; ---------------------------------------------------------------------------
    2889/     FE6 :                     
    2890/    1C00 :                     	phase 1C00h
    2891/    1C00 :                     byte_1C00:	ds 1			; DATA XREF: SetupBank+9r
    2892/    1C01 :                     byte_1C01:	ds 1			; DATA XREF: SetupBankr
    2893/    1C02 :                     word_1C02:	ds 2			; DATA XREF: GetListOfsr
    2894/    1C04 :                     					; DoOneSndQueue+6r
    2895/    1C04 :                     word_1C04:	ds 2			; DATA XREF: RefreshTimerAr
    2896/    1C06 :                     					; RAM:cfEA_SetUpdRateo	...
    2897/    1C06 :                     byte_1C06:	ds 1			; DATA XREF: RefreshTimerBr RAM:0C46o
    2898/    1C07 :                     byte_1C07:	ds 1			; DATA XREF: RAM:loc_46r RAM:0073r ...
    2899/    1C08 :                     unk_1C08:	ds 1			; DATA XREF: PlaySoundID+10Fo
    2900/    1C09 :                     byte_1C09:	ds 1			; DATA XREF: PlaySoundIDr
    2901/    1C0A :                     					; PlaySoundID+D8w ...
    2902/    1C0A :                     unk_1C0A:	ds 1			; DATA XREF: StopAllSound+3o
    2903/    1C0B :                     					; DoSoundQueue+5o ...
    2904/    1C0B :                     unk_1C0B:	ds 1			; DATA XREF: DoSoundQueue+Bo
    2905/    1C0C :                     unk_1C0C:	ds 1			; DATA XREF: DoSoundQueue+11o
    2906/    1C0D :                     byte_1C0D:	ds 1			; DATA XREF: DoPause+13r RAM:0794w ...
    2907/    1C0E :                     byte_1C0E:	ds 1			; DATA XREF: RAM:079Cw
    2908/    1C0F :                     					; DoFading:ApplyFadingr
    2909/    1C0F :                     byte_1C0F:	ds 1			; DATA XREF: RAM:0799w	DoFading+Br ...
    2910/    1C10 :                     unk_1C10:	ds 1			; DATA XREF: DoPauseo
    2911/    1C11 :                     byte_1C11:	ds 1			; DATA XREF: DoPause:loc_759r
    2912/    1C12 :                     					; RAM:cf03_MusPausew
    2913/    1C12 :                     byte_1C12:	ds 1			; DATA XREF: RefreshTimerB:ResetYMTimero
    2914/    1C13 :                     					; ResetSpcFM3Mode+2w ...
    2915/    1C13 :                     byte_1C13:	ds 1			; DATA XREF: PlaySoundID+67w DoTempoo
    2916/    1C14 :                     byte_1C14:	ds 1			; DATA XREF: PlaySoundID+6Aw
    2917/    1C15 :                     					; DoTempo+8r ...
    2918/    1C15 :                     byte_1C15:	ds 1			; DATA XREF: PlaySoundID+121w
    2919/    1C16 :                     					; PlaySoundID+93Bw
    2920/    1C16 :                     byte_1C16:	ds 1			; DATA XREF: RAM:cfE2_SetCommw
    2921/    1C17 :                     byte_1C17:	ds 1			; DATA XREF: DoSoundQueue+2w
    2922/    1C18 :                     byte_1C18:	ds 1			; DATA XREF: DoOneSndQueue:loc_8CFr
    2923/    1C19 :                     					; DoOneSndQueue+2Fw ...
    2924/    1C19 :                     byte_1C19:	ds 1			; DATA XREF: UpdateAll+14w
    2925/    1C1A :                     					; UpdateSFXTracks+2w ...
    2926/    1C1A :                     byte_1C1A:	ds 8			; DATA XREF: GetFM3FreqPtr+8o
    2927/    1C22 :                     byte_1C22:	ds 8			; DATA XREF: GetFM3FreqPtr+Co
    2928/    1C2A :                     byte_1C2A:	ds 8			; DATA XREF: GetFM3FreqPtro
    2929/    1C32 :                     byte_1C32:	ds 1			; DATA XREF: GetSFXChnPtrs:loc_6C2w
    2930/    1C33 :                     word_1C33:	ds 2			; DATA XREF: PlaySoundID+71w
    2931/    1C35 :                     					; PlaySoundID+90r ...
    2932/    1C35 :                     word_1C35:	ds 2			; DATA XREF: PlaySoundID+77w
    2933/    1C37 :                     					; PlaySoundID+84r ...
    2934/    1C37 :                     word_1C37:	ds 2			; DATA XREF: GetFMInsPtrr
    2935/    1C39 :                     					; PlaySoundID+5Ew ...
    2936/    1C39 :                     word_1C39:	ds 2			; DATA XREF: PlaySoundID+11Dw
    2937/    1C3B :                     					; PlaySoundID+178r
    2938/    1C3B :                     byte_1C3B:	ds 1			; DATA XREF: PlaySoundID+12Bw
    2939/    1C3C :                     					; PlaySoundID+155r
    2940/    1C3C :                     		ds 1
    2941/    1C3D :                     		ds 1
    2942/    1C3E :                     		ds 1
    2943/    1C3F :                     		ds 1
    2944/    1C40 :                     byte_1C40:	ds 1			; DATA XREF: UpdateAll+17o
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 52 - 5/8/2024 17:23:58


    2945/    1C41 :                     					; PlaySoundID+7Ao ...
    2946/    1C41 :                     		ds 1
    2947/    1C42 :                     byte_1C42:	ds 9			; DATA XREF: RAM:0C1Eo
    2948/    1C4B :                     byte_1C4B:	ds 25h			; DATA XREF: DoTempo+Co
    2949/    1C70 :                     byte_1C70:	ds 0F0h			; DATA XREF: UpdateAll+24o DoPause+1Ao
    2950/    1D60 :                     byte_1D60:	ds 5			; DATA XREF: StopDrumPSG+4w
    2951/    1D65 :                     					; DrumUpdate_Proc+1Eo
    2952/    1D65 :                     byte_1D65:	ds 1			; DATA XREF: DrumUpdate_Proc+45o
    2953/    1D66 :                     byte_1D66:	ds 2			; DATA XREF: DrumUpdate_Proc+54r
    2954/    1D68 :                     byte_1D68:	ds 28h			; DATA XREF: DrumUpdate_Proc+4Dr
    2955/    1D90 :                     byte_1D90:	ds 30h			; DATA XREF: PlaySoundID+B2o
    2956/    1DC0 :                     					; StopDrumPSG+Aw
    2957/    1DC0 :                     byte_1DC0:	ds 30h			; DATA XREF: StopDrumPSG+Dw
    2958/    1DF0 :                     byte_1DF0:	ds 30h			; DATA XREF: StopDrumPSG+7w
    2959/    1E20 :                     					; DrumUpdate_Proc:loc_A12o
    2960/    1E20 :                     byte_1E20:	ds 60h			; DATA XREF: UpdateSFXTracks+15o
    2961/    1E80 :                     					; PlaySoundID:StopSpcSFXo ...
    2962/    1E80 :                     byte_1E80:	ds 17Dh			; DATA XREF: UpdateSFXTracks+5o
    2963/    1FFD :                     unk_1FFD:	ds 1			; DATA XREF: RAM:InitDrivero
    2964/    1FFE :                     		ds 1
    2965/    1FFF :                     byte_1FFF:	ds 1			; DATA XREF: RAM:003Co	RAM:0058w ...
    2966/    13E6 :                     	dephase
    2967/    13E6 :                     ; end of 'RAM'
    2968/    13E6 :                     
    2969/    13E6 :                     
    2970/    13E6 :                     		end
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 53 - 5/8/2024 17:23:58


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :                                        "i386-unknown-win32" - |
 ApplyFading :                  7CA C |  BGMChnPtrs :                   716 C |
*BIGENDIAN :                      0 - | *BRANCHEXT :                      0 - |
*CASESENSITIVE :                  1 - | *COMPMODE :                       0 - |
*CONSTPI :        3.141592653589793 - | *CUSTOM :                         0 - |
 ClearSoundID :                 5E1 C |  CmdPtrTable :                  52E C |
*DATE :                  "5/8/2024" - |  DisableSSGEG :                 837 C |
 DoFMVolEnv :                   30C C |  DoFading :                     7B5 C |
 DoModEnv :                     3B6 C |  DoModulation :                 365 C |
 DoNoteOff :                    424 C |  DoNoteOn :                     40D C |
 DoOneSndQueue :                8AD C |  DoPSGVolEnv :                 0F97 C |
 DoPanAnimation :               2A8 C |  DoPause :                      739 C |
 DoPitchSlide :                 434 C |  DoRawFreqMode :                250 C |
 DoSoundQueue :                 899 C |  DoTempo :                      880 C |
 DrumUpdateTrack :              9A2 C |  DrumUpdate_Proc :              9A9 C |
 ExecPanAnim :                  2EE C | *FALSE :                          0 - |
 FM3_FreqVals :                0D45 C |  FMDrum81 :                    0A9A C |
 FMDrum82 :                    0ABC C |  FMDrum83 :                    0AC7 C |
 FMDrum84 :                    0AD0 C |  FMDrum85 :                    0AE4 C |
 FMDrum86 :                    0B06 C |  FMDrum87 :                    0ADB C |
 FMDrum88 :                    0B28 C |  FMDrum89 :                    0B4A C |
 FMDrum8A :                    0B71 C |  FMDrumInit :                  0A50 C |
 FMDrumIns00 :                 0AA3 C |  FMDrumIns01 :                 0AED C |
 FMDrumIns02 :                 0B0F C |  FMDrumIns03 :                 0B31 C |
 FMDrumIns04 :                 0B58 C |  FMDrumIns05 :                 0B7F C |
 FMDrumInsPtrs :               0A8E C |  FMDrumTrkList :               0A7A C |
 FMFreqs :                      98A C |  FMInitBytes :                  5F6 C |
 FMInsOperators :               4C9 C |  FMNoteOff :                    430 C |
*FULLPMMU :                       1 - |  FadeOutMusic :                 792 C |
 FinishFMTrkInit :              6DC C |  FinishTrkInit :                6E3 C |
 GetEnvData :                   481 C |  GetFM3FreqPtr :                1C6 C |
 GetFMInsPtr :                  488 C |  GetListOfs :                    20 C |
 GetListOfsAB :                 5E7 C |  GetListOfsROM :                5EB C |
 GetNote :                      208 C |  GetPtrListOfs :                47A C |
 GetSFXChnPtrs :                6A3 C | *HAS64 :                          1 - |
*HASDSP :                         0 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - | *INEXTMODE :                      0 - |
*INLWORDMODE :                    0 - | *INMAXMODE :                      0 - |
*INSRCMODE :                      0 - | *INSUPMODE :                      0 - |
 InitDriver :                    53 C |  JumpToInsData :                497 C |
*LISTON :                         1 - | *MACEXP :                         7 - |
*MOMCPU :                        80 - | *MOMCPUNAME :                 "Z80" - |
 ModEnv_ChgMult :               3EE C |  ModEnv_Jump2Idx :              3E7 C |
 ModEnv_Next :                  400 C |  ModEnv_Positive :              3FE C |
 ModEnv_Reset :                 3EB C | *NESTMAX :                      100 - |
*PACKING :                        0 - | *PADDING :                        1 - |
 PSGDrum90 :                   0A64 C |  PSGDrumA0 :                   0A6F C |
 PSGDrumInit :                 0A53 C |  PSGDrumTrkList :              0A60 C |
 PSGFreqs :                     900 C |  PSGInitBytes :                 604 C |
 PSGMuteVals :                  87C C |  PanAniPtrList :                2F6 C |
 PlayMusic :                    557 C |  PlaySFX :                      615 C |
*PlaySnd_Command :              527 C |  PlaySnd_JumpIn :               50E C |
 PlaySoundID :                  50B C |  PlaySpcSFX :                   60A C |
 PrepareModulat :               33A C | *RELAXED :                        0 - |
 ReadFMCommand :               0CD3 C |  ReadPtrFromHL :                 30 C |
 ReadPtrTable :                  28 C |  RefreshTimerA :                0B9 C |
 RefreshTimerB :                0D3 C |  RefreshVolume :               0DA3 C |
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 54 - 5/8/2024 17:23:58


 ResetSpcFM3Mode :              82B C |  ResetYMTimer :                 0DC C |
 SFXChnPtrs :                   706 C |  SSGEG_Ops :                    4E2 C |
 SendAllFMOps :                 8F6 C |  SendFM3SpcMode :              0D39 C |
 SendFMFreq :                   17E C |  SendFMIns :                    4E6 C |
 SendNoteOff :                  42A C |  SendSSGEG :                   0C09 C |
 SetDuration :                  276 C |  SetInsFromSong :              0D63 C |
 SetMaxRelRate :                8F2 C |  SetRest :                     0FC8 C |
 SetupBank :                    726 C |  SilenceAll :                   83E C |
 SilenceFMChn :                 8E2 C |  SilencePSG :                   869 C |
 SilencePSGChn :               0FD1 C |  SpcFM3Regs :                   1C2 C |
 SpcFM3_skip :                 0D41 C |  SpcSFXChnPtrs :                6F6 C |
 StopAllSound :                 801 C |  StopDrumPSG :                  79F C |
 StopSpcSFX :                   536 C | *TIME :                  "17:23:58" - |
*TRUE :                           1 - |  TickMultiplier :               29E C |
*TimerAB_Update :                7D C |  TimerB_Update :                0AA C |
 TrackTimeout :                 304 C |  TrkUpdateLoop :                128 C |
 TrkUpdate_Proc :               1D6 C |  UnpauseMusic :                 74A C |
 UpdateAll :                    0E5 C |  UpdatePSGTrk :                0F1E C |
 UpdateSFXTracks :              10F C |  UpdateTrack :                  139 C |
*VERSION :                     142F - | *VInt :                          38 C |
 VolEnv_Hold :                 0FBE C |  VolEnv_Next :                 0FC4 C |
 VolEnv_Off :                  0FB3 C |  VolEnv_Reset :                0FBB C |
 Volume_Ops :                   4DE C |  WaitForYM :                      8 C |
 WriteFMI :                      18 C |  WriteFMII :                    4C0 C |
 WriteFMIIPart :                4B6 C |  WriteFMIorII :                 4A2 C |
 WriteFMMain :                   10 C |  WriteInsReg :                  505 C |
*Z80SYNTAX :                      0 - |  byte_1C00 :                   1C00 C |
 byte_1C01 :                   1C01 C |  byte_1C06 :                   1C06 C |
 byte_1C07 :                   1C07 C |  byte_1C09 :                   1C09 C |
 byte_1C0D :                   1C0D C |  byte_1C0E :                   1C0E C |
 byte_1C0F :                   1C0F C |  byte_1C11 :                   1C11 C |
 byte_1C12 :                   1C12 C |  byte_1C13 :                   1C13 C |
 byte_1C14 :                   1C14 C |  byte_1C15 :                   1C15 C |
 byte_1C16 :                   1C16 C |  byte_1C17 :                   1C17 C |
 byte_1C18 :                   1C18 C |  byte_1C19 :                   1C19 C |
 byte_1C1A :                   1C1A C |  byte_1C22 :                   1C22 C |
 byte_1C2A :                   1C2A C |  byte_1C32 :                   1C32 C |
 byte_1C3B :                   1C3B C |  byte_1C40 :                   1C40 C |
 byte_1C42 :                   1C42 C |  byte_1C4B :                   1C4B C |
 byte_1C70 :                   1C70 C |  byte_1D60 :                   1D60 C |
 byte_1D65 :                   1D65 C |  byte_1D66 :                   1D66 C |
 byte_1D68 :                   1D68 C |  byte_1D90 :                   1D90 C |
 byte_1DC0 :                   1DC0 C |  byte_1DF0 :                   1DF0 C |
 byte_1E20 :                   1E20 C |  byte_1E80 :                   1E80 C |
 byte_1FFF :                   1FFF C |  byte_2FE :                     2FE C |
 byte_2FF :                     2FF C |  byte_300 :                     300 C |
 byte_301 :                     301 C |  byte_A6A :                    0A6A C |
 byte_A75 :                    0A75 C |  byte_AA0 :                    0AA0 C |
 byte_AC2 :                    0AC2 C |  byte_ACD :                    0ACD C |
 byte_AD6 :                    0AD6 C |  byte_AE1 :                    0AE1 C |
 byte_AEA :                    0AEA C |  byte_B0C :                    0B0C C |
 byte_B2E :                    0B2E C |  byte_B50 :                    0B50 C |
 byte_B77 :                    0B77 C |  cf00_TimingMode :             0C27 C |
 cf01_SetTempo :               0CAA C |  cf02_PlaySnd :                0C4C C |
 cf03_MusPause :               0C54 C |  cf04_CopyMem :                0C8F C |
 cf05_TickMulAll :             0C18 C |  cf06_SSGEG :                  0BFF C |
 cf07_FMVolEnv :               0CA1 C |  cfE0_Pan :                    0D89 C |
 cfE1_Detune :                 0C9D C |  cfE2_SetComm :                0CB2 C |
 cfE3_SilenceTrk :             0CE7 C |  cfE4_PanAnim :                0CF7 C |
 cfE5_ChgPFMVol :              0DC2 C |  cfE6_ChgFMVol :               0DCA C |
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 55 - 5/8/2024 17:23:58


 cfE7_Hold :                   0D0A C |  cfE8_NoteStop :               0CED C |
 cfE9_SetLFO :                 0D9A C |  cfEA_SetUpdRate :             0C2B C |
 cfEB_ChgUpdRate :             0C38 C |  cfEC_ChgPSGVol :              0CB6 C |
 cfED_FMChnWrite :             0CC9 C |  cfEE_FM1Write :               0CCE C |
 cfEF_SetIns :                 0D4D C |  cfF0_ModSetup :               0CD9 C |
 cfF1_ModTypePFM :             0E0A C |  cfF2_StopTrk :                0E40 C |
 cfF3_PSGNoise :               0DE2 C |  cfF4_ModType :                0E12 C |
 cfF5_SetPSGIns :              0E01 C |  cfF6_GoTo :                   0E16 C |
 cfF7_Loop :                   0F07 C |  cfF8_GoSub :                  0EDA C |
 cfF9_Return :                 0EF4 C |  cfFA_TickMult :               0DDE C |
 cfFB_ChgTransp :              0DD7 C |  cfFC_PitchSlide :             0E1C C |
 cfFD_RawFrqMode :             0E32 C |  cfFE_SpcFM3Mode :             0D10 C |
 cfHandler :                   0B98 C |  cfHandler_Drum :              0A56 C |
 cfMetaCoordFlag :             0BA8 C |  cfMetaPtrTable :              0BEF C |
 cfPtrTable :                  0BAF C |  cfReturn :                    0BA4 C |
 cfReturn_Drum :               0A5C C |  loc_15C :                      15C C |
 loc_173 :                      173 C |  loc_18A :                      18A C |
 loc_193 :                      193 C |  loc_1A3 :                      1A3 C |
 loc_1E4 :                      1E4 C |  loc_21E :                      21E C |
 loc_227 :                      227 C |  loc_230 :                      230 C |
 loc_236 :                      236 C |  loc_249 :                      249 C |
 loc_261 :                      261 C |  loc_263 :                      263 C |
 loc_274 :                      274 C |  loc_275 :                      275 C |
 loc_27C :                      27C C |  loc_2A4 :                      2A4 C |
 loc_2B4 :                      2B4 C |  loc_2E1 :                      2E1 C |
 loc_2EA :                      2EA C |  loc_327 :                      327 C |
 loc_333 :                      333 C |  loc_3A1 :                      3A1 C |
 loc_3C1 :                      3C1 C |  loc_3C4 :                      3C4 C |
 loc_406 :                      406 C |  loc_43E :                      43E C |
 loc_46 :                        46 C |  loc_460 :                      460 C |
 loc_46D :                      46D C |  loc_46E :                      46E C |
 loc_49E :                      49E C |  loc_4B2 :                      4B2 C |
 loc_4D :                        4D C |  loc_4F7 :                      4F7 C |
 loc_541 :                      541 C |  loc_552 :                      552 C |
 loc_58E :                      58E C |  loc_5B :                        5B C |
 loc_5C3 :                      5C3 C |  loc_5F3 :                      5F3 C |
 loc_5F4 :                      5F4 C |  loc_622 :                      622 C |
 loc_640 :                      640 C |  loc_654 :                      654 C |
 loc_682 :                      682 C |  loc_690 :                      690 C |
 loc_6AC :                      6AC C |  loc_6C2 :                      6C2 C |
 loc_6EE :                      6EE C |  loc_6F :                        6F C |
 loc_732 :                      732 C |  loc_759 :                      759 C |
 loc_765 :                      765 C |  loc_76B :                      76B C |
 loc_778 :                      778 C |  loc_78A :                      78A C |
 loc_7DF :                      7DF C |  loc_7EA :                      7EA C |
 loc_7F9 :                      7F9 C |  loc_814 :                      814 C |
 loc_849 :                      849 C |  loc_853 :                      853 C |
 loc_861 :                      861 C |  loc_870 :                      870 C |
 loc_894 :                      894 C |  loc_8CF :                      8CF C |
 loc_8D7 :                      8D7 C |  loc_8DF :                      8DF C |
 loc_8F8 :                      8F8 C |  loc_9AF :                      9AF C |
 loc_9B :                        9B C |  loc_9BE :                      9BE C |
 loc_A12 :                     0A12 C |  loc_A3F :                     0A3F C |
 loc_A40 :                     0A40 C | *loc_AD :                       0AD C |
 loc_B9B :                     0B9B C |  loc_C0E :                     0C0E C |
 loc_C21 :                     0C21 C |  loc_C66 :                     0C66 C |
 loc_C77 :                     0C77 C |  loc_C83 :                     0C83 C |
 loc_D21 :                     0D21 C |  loc_D7A :                     0D7A C |
 loc_D7F :                     0D7F C |  loc_D84 :                     0D84 C |
 loc_D8B :                     0D8B C |  loc_DAF :                     0DAF C |
 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 56 - 5/8/2024 17:23:58


 loc_DB7 :                     0DB7 C |  loc_DFD :                     0DFD C |
 loc_E25 :                     0E25 C |  loc_E3B :                     0E3B C |
 loc_E76 :                     0E76 C |  loc_E7A :                     0E7A C |
 loc_E9D :                     0E9D C |  loc_EA0 :                     0EA0 C |
 loc_EAC :                     0EAC C |  loc_EC0 :                     0EC0 C |
 loc_EC3 :                     0EC3 C |  loc_EC8 :                     0EC8 C |
 loc_ED8 :                     0ED8 C |  loc_F17 :                     0F17 C |
 loc_F30 :                     0F30 C |  loc_F3C :                     0F3C C |
 loc_F70 :                     0F70 C |  loc_F7F :                     0F7F C |
 loc_F8E :                     0F8E C |  loc_F94 :                     0F94 C |
 locret_4A1 :                   4A1 C |  unk_1C08 :                    1C08 C |
 unk_1C0A :                    1C0A C |  unk_1C0B :                    1C0B C |
 unk_1C0C :                    1C0C C |  unk_1C10 :                    1C10 C |
 unk_1FFD :                    1FFD C |  word_1C02 :                   1C02 C |
 word_1C04 :                   1C04 C |  word_1C33 :                   1C33 C |
 word_1C35 :                   1C35 C |  word_1C37 :                   1C37 C |
 word_1C39 :                   1C39 C |

    386 symbols
     35 unused symbols

 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 57 - 5/8/2024 17:23:58


  Defined Macros:
  ---------------

DrumHeader                            |

      1 macro

 AS V1.42 Beta [Bld 212] - Source File Z80 Sound Driver.asm - Page 58 - 5/8/2024 17:23:58


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.06 seconds assembly time

   2971 lines source file
   3031 lines incl. macro expansions
      2 passes
      0 errors
      0 warnings
